import{Ad as J,B as V,C as me,D as d,H as I,L as p,T as C,Y as l,Z as M,_c as he,ac as x,d as E,ed as be,f as v,h as A,i as L,l as ce,md as N,od as o,p as P,s as $,u as Re,w as D,xd as Ae,yd as Te,z as B,zd as f}from"./chunk-55AHIQTK.js";import{a as O,b as Ie}from"./chunk-EQDQRRRY.js";var z=class s{http=p(x);baseUrl="https://wakfu.cdn.ankama.com/gamedata/";getConfig(){return this.http.get(this.baseUrl+"config.json")}getItems(e){return this.http.get(this.baseUrl+e+"/items.json")}getActions(e){return this.http.get(this.baseUrl+e+"/actions.json")}getStates(e){return this.http.get(this.baseUrl+e+"/states.json")}getRecipesResult(e){return this.http.get(this.baseUrl+e+"/recipeResults.json")}getJobsItems(e){return this.http.get(this.baseUrl+e+"/jobsItems.json")}getRecipeIngredients(e){return this.http.get(this.baseUrl+e+"/recipeIngredients.json")}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var fe=(R=>(R[R.LE_DIANINE=24700]="LE_DIANINE",R[R.LE_DORRRRE=24610]="LE_DORRRRE",R[R.LE_JALM=24593]="LE_JALM",R[R.LA_FLOUFF=24607]="LA_FLOUFF",R[R.L_ATTENTIONNEE=24551]="L_ATTENTIONNEE",R[R.LA_GAINE=24566]="LA_GAINE",R[R.LA_ZEOR=24668]="LA_ZEOR",R[R.LE_CONDOTTIER=24513]="LE_CONDOTTIER",R[R.LES_OPRESSANTES=24524]="LES_OPRESSANTES",R[R.LE_FOUIP=24601]="LE_FOUIP",R[R.LE_FELDSPATH=24615]="LE_FELDSPATH",R[R.LES_MELLES=24538]="LES_MELLES",R[R.LE_FAINNE=24585]="LE_FAINNE",R[R.LA_PROMESSE=24537]="LA_PROMESSE",R[R.LE_LIEUTE=24505]="LE_LIEUTE",R[R.LE_PELO=24521]="LE_PELO",R[R.LE_TIG=24488]="LE_TIG",R[R.LE_CABOT=24426]="LE_CABOT",R[R.LA_BASTOS=24408]="LA_BASTOS",R))(fe||{}),_e=s=>Object.values(fe).includes(s);var ee=class s{ankamaCdnService=p(z);static MEDAILLE_BRAVOURE_ITEM_ID=24705;config=new E("");config$=this.config.asObservable().pipe(P(e=>e.length>0));action=new E([]);action$=this.action.asObservable().pipe(P(e=>e.length>0));item=new E([]);item$=this.item.asObservable().pipe(P(e=>e.length>0));states=new E([]);states$=this.states.asObservable().pipe(P(e=>e.length>0));recipes=new E([]);recipes$=this.recipes.asObservable().pipe(P(e=>e.length>0));idSiouperes=new E([]);idSiouperes$=this.idSiouperes.asObservable().pipe(P(e=>e.length>0));recipeIngredients=new E([]);recipeIngredients$=this.recipeIngredients.asObservable().pipe(P(e=>e.length>0));mapProductItemIdToRecipeResult=new Map;mapRecipeIdToRecipeIngredients=new Map;loadItems(e){this.ankamaCdnService.getItems(e).pipe(d(t=>this.item.next(t))).subscribe()}loadActions(e){this.ankamaCdnService.getActions(e).pipe(d(t=>this.action.next(t))).subscribe()}loadStates(e){this.ankamaCdnService.getStates(e).pipe(d(t=>this.states.next(t))).subscribe()}loadRecipeIngredients(e){this.ankamaCdnService.getRecipeIngredients(e).pipe(d(t=>this.recipeIngredients.next(t)),d(t=>{t.forEach(i=>{let r=this.mapRecipeIdToRecipeIngredients.get(i.recipeId)||[];r.push(i),this.mapRecipeIdToRecipeIngredients.set(i.recipeId,r)})})).subscribe()}loadRecipesResult(e){this.ankamaCdnService.getRecipesResult(e).pipe(d(t=>this.recipes.next(t)),d(t=>{t.forEach(i=>{this.mapProductItemIdToRecipeResult.set(i.productedItemId,i)})})).subscribe()}loadIdSioupere(e){this.ankamaCdnService.getJobsItems(e).pipe(A(t=>t.filter(i=>i.title.fr.toLowerCase().includes("sioup\xE8re"))),d(t=>this.idSiouperes.next(t))).subscribe()}load(){this.ankamaCdnService.getConfig().pipe(d(e=>this.config.next(e.version)),d(e=>this.loadItems(e.version)),d(e=>this.loadActions(e.version)),d(e=>this.loadStates(e.version)),d(e=>this.loadRecipesResult(e.version)),d(e=>this.loadIdSioupere(e.version)),d(e=>this.loadRecipeIngredients(e.version))).subscribe()}getActionList(){return this.action.getValue()}getStatesList(){return this.states.getValue()}isItemPvP(e){if(_e(e))return!0;let t=this.mapProductItemIdToRecipeResult.get(e);return t?(this.mapRecipeIdToRecipeIngredients.get(t.recipeId)||[]).some(r=>r.itemId===s.MEDAILLE_BRAVOURE_ITEM_ID):!1}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var W=class s{imageService=p(be);itemTypes=new Map([[1,{ids:[101,111,114,117,223,253]}],[2,{ids:[108,110,113,115,254]}],[3,{ids:[103]}],[4,{ids:[119]}],[5,{ids:[120]}],[6,{ids:[132]}],[7,{ids:[133]}],[8,{ids:[134]}],[9,{ids:[136]}],[10,{ids:[138]}],[11,{ids:[646]}],[12,{ids:[189]}],[13,{ids:[112]}],[14,{ids:[582]}]]);getItemTypes(){return this.itemTypes}getItemType(e){let t;return this.itemTypes.forEach((i,r)=>{i.ids.includes(e)&&(t=r)}),t}getLogo(e){return e?this.imageService.mapUrlItemType.get(e)??"":""}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var te=class s{http=p(x);monsterDrops=new E([]);monsterDrops$=this.monsterDrops.asObservable();loadPromise;load(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(e=>{this.http.get("/monstres_drops_gfx.json").pipe(d(t=>this.monsterDrops.next(t)),B(1)).subscribe({next:()=>e(),error:t=>{console.error("Failed to load monster drops:",t),this.monsterDrops.next([]),e()}})}),this.loadPromise)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};function ge(s){switch(s){case 1:return 1;case 2:return 3;case 3:return 4;case 4:return 6;case 5:return 7;case 6:return 10;case 7:return 15;case 8:return 19;case 9:return 24;case 10:return 30;case 11:return 33;default:return 0}}function Le(s){switch(s){case 1:return 2;case 2:return 5;case 3:return 7;case 4:return 10;case 5:return 12;case 6:return 15;case 7:return 17;case 8:return 20;case 9:return 22;case 10:return 25;case 11:return 27;default:return 0}}var Rt=[20,35,50,65,80,95,110,125,140,155,170,185,200,215,230,245],ue=[{maxLevel:36,ratio:F(1/2)},{maxLevel:51,ratio:F(3/5)},{maxLevel:66,ratio:F(4/7)},{maxLevel:81,ratio:F(6/10)},{maxLevel:96,ratio:F(7/12)},{maxLevel:126,ratio:F(10/15)},{maxLevel:141,ratio:F(15/17)},{maxLevel:171,ratio:F(19/20)},{maxLevel:186,ratio:F(24/22)},{maxLevel:216,ratio:F(30/25)}];function ht(s){let e=ue.findIndex(t=>s<t.maxLevel);return e===-1?11:e+1}function F(s){return Math.trunc(s*100)/100}function de(s){return s.normalize("NFKD").replace(/['''´’`]/g,"'").replace(/\s+/g," ").trim().toLowerCase()}var ie=class s{http=p(x);familiers=new E([]);familiers$=this.familiers.asObservable();loadPromise;load(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(e=>{this.http.get("/familiers_stats.json").pipe(d(t=>this.familiers.next(t)),B(1)).subscribe({next:()=>e(),error:t=>{console.error("Failed to load monster drops:",t),this.familiers.next([]),e()}})}),this.loadPromise)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Se=(U=>(U.POIDS="POIDS",U.MAITRISES="MAITRISES",U.RESISTANCES="RESISTANCES",U.EQUILIBRE="EQUILIBRE",U.PARADE_ARMURE_DONNEE="PARADE_ARMURE_DONNEE",U.POINT_DE_VIE="POINT_DE_VIE",U.TACLE="TACLE",U.ESQUIVE="ESQUIVE",U.TACLE_ESQUIVE="TACLE_ESQUIVE",U.CRITIQUE="CRITIQUE",U.PARADE="PARADE",U.CRITIQUE_PARADE="CRITIQUE_PARADE",U.PA="PA",U.PM="PM",U.PO="PO",U.PW="PW",U))(Se||{});var j=class s extends f{itemTypeServices=p(W);injector=p(C);selected=new E([]);selected$=this.selected.asObservable();keyEnum="KEY_ITEM_TYPE";signals={deuxMains:l(!1),uneMain:l(!1),anneau:l(!1),bottes:l(!1),amulette:l(!1),cape:l(!1),ceinture:l(!1),casque:l(!1),plastron:l(!1),epaulettes:l(!1),bouclier:l(!1),dague:l(!1),accessoires:l(!1),familier:l(!1)};form=new N({deuxMains:new o,uneMain:new o,anneau:new o,bottes:new o,amulette:new o,cape:new o,ceinture:new o,casque:new o,plastron:new o,epaulettes:new o,bouclier:new o,dague:new o,accessoires:new o,familier:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&(this.signals.deuxMains.set(e.deuxMains??!1),this.signals.uneMain.set(e.uneMain??!1),this.signals.anneau.set(e.anneau??!1),this.signals.bottes.set(e.bottes??!1),this.signals.amulette.set(e.amulette??!1),this.signals.cape.set(e.cape??!1),this.signals.ceinture.set(e.ceinture??!1),this.signals.casque.set(e.casque??!1),this.signals.plastron.set(e.plastron??!1),this.signals.epaulettes.set(e.epaulettes??!1),this.signals.bouclier.set(e.bouclier??!1),this.signals.dague.set(e.dague??!1),this.signals.accessoires.set(e.accessoires??!1),this.signals.familier.set(e.familier??!1)),M(()=>{let t={deuxMains:this.signals.deuxMains(),uneMain:this.signals.uneMain(),anneau:this.signals.anneau(),bottes:this.signals.bottes(),amulette:this.signals.amulette(),cape:this.signals.cape(),ceinture:this.signals.ceinture(),casque:this.signals.casque(),plastron:this.signals.plastron(),epaulettes:this.signals.epaulettes(),bouclier:this.signals.bouclier(),dague:this.signals.dague(),accessoires:this.signals.accessoires(),familier:this.signals.familier()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){let t=[];e.uneMain&&t.push(this.itemTypeServices.getItemTypes().get(2)?.ids),e.deuxMains&&t.push(this.itemTypeServices.getItemTypes().get(1)?.ids),e.anneau&&t.push(this.itemTypeServices.getItemTypes().get(3)?.ids),e.bottes&&t.push(this.itemTypeServices.getItemTypes().get(4)?.ids),e.amulette&&t.push(this.itemTypeServices.getItemTypes().get(5)?.ids),e.cape&&t.push(this.itemTypeServices.getItemTypes().get(6)?.ids),e.ceinture&&t.push(this.itemTypeServices.getItemTypes().get(7)?.ids),e.casque&&t.push(this.itemTypeServices.getItemTypes().get(8)?.ids),e.plastron&&t.push(this.itemTypeServices.getItemTypes().get(9)?.ids),e.epaulettes&&t.push(this.itemTypeServices.getItemTypes().get(10)?.ids),e.bouclier&&t.push(this.itemTypeServices.getItemTypes().get(12)?.ids),e.dague&&t.push(this.itemTypeServices.getItemTypes().get(13)?.ids),e.accessoires&&t.push(this.itemTypeServices.getItemTypes().get(11)?.ids),e.familier&&t.push(this.itemTypeServices.getItemTypes().get(14)?.ids),this.selected.next(t.flat())}setValue(e){this.signals.deuxMains.set(e?.deuxMains??!1),this.signals.uneMain.set(e?.uneMain??!1),this.signals.anneau.set(e?.anneau??!1),this.signals.bottes.set(e?.bottes??!1),this.signals.amulette.set(e?.amulette??!1),this.signals.cape.set(e?.cape??!1),this.signals.ceinture.set(e?.ceinture??!1),this.signals.casque.set(e?.casque??!1),this.signals.plastron.set(e?.plastron??!1),this.signals.epaulettes.set(e?.epaulettes??!1),this.signals.bouclier.set(e?.bouclier??!1),this.signals.dague.set(e?.dague??!1),this.signals.accessoires.set(e?.accessoires??!1),this.signals.familier.set(e?.familier??!1)}setDefaultValue(){this.setItemType()}setItemType(...e){this.signals.deuxMains.set(e.includes(1)),this.signals.uneMain.set(e.includes(2)),this.signals.anneau.set(e.includes(3)),this.signals.bottes.set(e.includes(4)),this.signals.amulette.set(e.includes(5)),this.signals.cape.set(e.includes(6)),this.signals.ceinture.set(e.includes(7)),this.signals.casque.set(e.includes(8)),this.signals.plastron.set(e.includes(9)),this.signals.epaulettes.set(e.includes(10)),this.signals.bouclier.set(e.includes(12)),this.signals.dague.set(e.includes(13)),this.signals.accessoires.set(e.includes(11)),this.signals.familier.set(e.includes(14))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var se=class s extends f{static DEFAULT_VALUE="MAITRISES";sort=new E(s.DEFAULT_VALUE);sort$=this.sort.asObservable();keyEnum="KEY_SORT_CHOICE";form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(e){this.sort.next(e)}setValue(e){this.form.setValue(e??s.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var q=class s extends f{static DEFAULT_VALUE=!1;onlyNoSecondary=new E(!1);onlyNoSecondary$=this.onlyNoSecondary.asObservable();keyEnum="KEY_ONLY_NO_SECONDARY";form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(e){this.onlyNoSecondary.next(e??!1)}setValue(e){this.form.setValue(e??s.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Q=class s extends f{injector=p(C);idMajor=new E([]);idMajor$=this.idMajor.asObservable();keyEnum="KEY_MAJOR_PRESENT";signals={PA:l(!1),PM:l(!1),PW:l(!1),PO:l(!1),CONTROLE:l(!1),ARMURE_DONNEE:l(!1),ARMURE_RECUE:l(!1),CRITIQUE:l(!1),PARADE:l(!1),RESISTANCE_DOS:l(!1),RESISTANCE_CRITIQUE:l(!1),PERTE_PA:l(!1),PERTE_PM:l(!1),PERTE_PW:l(!1),PERTE_PO:l(!1),PERTE_CONTROLE:l(!1),PERTE_ARMURE_DONNEE:l(!1),PERTE_ARMURE_RECUE:l(!1),PERTE_CRITIQUE:l(!1),PERTE_PARADE:l(!1),PERTE_RESISTANCE_DOS:l(!1),PERTE_RESISTANCE_CRITIQUE:l(!1),PERTE_MAITRISES_MELEE:l(!1),PERTE_MAITRISES_DISTANCE:l(!1),PERTE_MAITRISES_CRITIQUE:l(!1),PERTE_MAITRISES_DOS:l(!1),PERTE_MAITRISES_SOIN:l(!1),PERTE_MAITRISES_BERZERK:l(!1)};form=new N({PA:new o,PM:new o,PW:new o,PO:new o,CONTROLE:new o,ARMURE_DONNEE:new o,ARMURE_RECUE:new o,CRITIQUE:new o,PARADE:new o,RESISTANCE_DOS:new o,RESISTANCE_CRITIQUE:new o,PERTE_PA:new o,PERTE_PM:new o,PERTE_PW:new o,PERTE_PO:new o,PERTE_CONTROLE:new o,PERTE_ARMURE_DONNEE:new o,PERTE_ARMURE_RECUE:new o,PERTE_CRITIQUE:new o,PERTE_PARADE:new o,PERTE_RESISTANCE_DOS:new o,PERTE_RESISTANCE_CRITIQUE:new o,PERTE_MAITRISES_MELEE:new o,PERTE_MAITRISES_DISTANCE:new o,PERTE_MAITRISES_CRITIQUE:new o,PERTE_MAITRISES_DOS:new o,PERTE_MAITRISES_SOIN:new o,PERTE_MAITRISES_BERZERK:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&Object.keys(this.signals).forEach(t=>{this.signals[t].set(e[t]??!1)}),M(()=>{let t={PA:this.signals.PA(),PM:this.signals.PM(),PW:this.signals.PW(),PO:this.signals.PO(),CONTROLE:this.signals.CONTROLE(),ARMURE_DONNEE:this.signals.ARMURE_DONNEE(),ARMURE_RECUE:this.signals.ARMURE_RECUE(),CRITIQUE:this.signals.CRITIQUE(),PARADE:this.signals.PARADE(),RESISTANCE_DOS:this.signals.RESISTANCE_DOS(),RESISTANCE_CRITIQUE:this.signals.RESISTANCE_CRITIQUE(),PERTE_PA:this.signals.PERTE_PA(),PERTE_PM:this.signals.PERTE_PM(),PERTE_PW:this.signals.PERTE_PW(),PERTE_PO:this.signals.PERTE_PO(),PERTE_CONTROLE:this.signals.PERTE_CONTROLE(),PERTE_ARMURE_DONNEE:this.signals.PERTE_ARMURE_DONNEE(),PERTE_ARMURE_RECUE:this.signals.PERTE_ARMURE_RECUE(),PERTE_CRITIQUE:this.signals.PERTE_CRITIQUE(),PERTE_PARADE:this.signals.PERTE_PARADE(),PERTE_RESISTANCE_DOS:this.signals.PERTE_RESISTANCE_DOS(),PERTE_RESISTANCE_CRITIQUE:this.signals.PERTE_RESISTANCE_CRITIQUE(),PERTE_MAITRISES_MELEE:this.signals.PERTE_MAITRISES_MELEE(),PERTE_MAITRISES_DISTANCE:this.signals.PERTE_MAITRISES_DISTANCE(),PERTE_MAITRISES_CRITIQUE:this.signals.PERTE_MAITRISES_CRITIQUE(),PERTE_MAITRISES_DOS:this.signals.PERTE_MAITRISES_DOS(),PERTE_MAITRISES_SOIN:this.signals.PERTE_MAITRISES_SOIN(),PERTE_MAITRISES_BERZERK:this.signals.PERTE_MAITRISES_BERZERK()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){let t=[];e.PA&&t.push({id:31}),e.PM&&t.push({id:41}),e.PW&&t.push({id:191}),e.PO&&t.push({id:160}),e.CONTROLE&&t.push({id:184}),e.ARMURE_DONNEE&&t.push({id:39,parameter:120}),e.ARMURE_RECUE&&t.push({id:39,parameter:121}),e.CRITIQUE&&t.push({id:150}),e.PARADE&&t.push({id:875}),e.RESISTANCE_DOS&&t.push({id:71}),e.RESISTANCE_CRITIQUE&&t.push({id:988}),e.PERTE_PA&&t.push({id:56}),e.PERTE_PM&&t.push({id:57}),e.PERTE_PW&&t.push({id:192}),e.PERTE_PO&&t.push({id:161}),e.PERTE_CONTROLE&&t.push({id:-1}),e.PERTE_ARMURE_DONNEE&&t.push({id:40,parameter:120}),e.PERTE_ARMURE_RECUE&&t.push({id:40,parameter:121}),e.PERTE_CRITIQUE&&t.push({id:168}),e.PERTE_PARADE&&t.push({id:876}),e.PERTE_RESISTANCE_DOS&&t.push({id:1063}),e.PERTE_RESISTANCE_CRITIQUE&&t.push({id:1062}),e.PERTE_MAITRISES_MELEE&&t.push({id:1059}),e.PERTE_MAITRISES_DISTANCE&&t.push({id:1060}),e.PERTE_MAITRISES_CRITIQUE&&t.push({id:1056}),e.PERTE_MAITRISES_DOS&&t.push({id:181}),e.PERTE_MAITRISES_SOIN&&t.push({id:-1}),e.PERTE_MAITRISES_BERZERK&&t.push({id:1061}),this.idMajor.next(t)}setValue(e){this.signals.PA.set(e?.PA??!1),this.signals.PM.set(e?.PM??!1),this.signals.PW.set(e?.PW??!1),this.signals.PO.set(e?.PO??!1),this.signals.CONTROLE.set(e?.CONTROLE??!1),this.signals.ARMURE_DONNEE.set(e?.ARMURE_DONNEE??!1),this.signals.ARMURE_RECUE.set(e?.ARMURE_RECUE??!1),this.signals.CRITIQUE.set(e?.CRITIQUE??!1),this.signals.PARADE.set(e?.PARADE??!1),this.signals.RESISTANCE_DOS.set(e?.RESISTANCE_DOS??!1),this.signals.RESISTANCE_CRITIQUE.set(e?.RESISTANCE_CRITIQUE??!1),this.signals.PERTE_PA.set(e?.PERTE_PA??!1),this.signals.PERTE_PM.set(e?.PERTE_PM??!1),this.signals.PERTE_PW.set(e?.PERTE_PW??!1),this.signals.PERTE_PO.set(e?.PERTE_PO??!1),this.signals.PERTE_CONTROLE.set(e?.PERTE_CONTROLE??!1),this.signals.PERTE_ARMURE_DONNEE.set(e?.PERTE_ARMURE_DONNEE??!1),this.signals.PERTE_ARMURE_RECUE.set(e?.PERTE_ARMURE_RECUE??!1),this.signals.PERTE_CRITIQUE.set(e?.PERTE_CRITIQUE??!1),this.signals.PERTE_PARADE.set(e?.PERTE_PARADE??!1),this.signals.PERTE_RESISTANCE_DOS.set(e?.PERTE_RESISTANCE_DOS??!1),this.signals.PERTE_RESISTANCE_CRITIQUE.set(e?.PERTE_RESISTANCE_CRITIQUE??!1),this.signals.PERTE_MAITRISES_MELEE.set(e?.PERTE_MAITRISES_MELEE??!1),this.signals.PERTE_MAITRISES_DISTANCE.set(e?.PERTE_MAITRISES_DISTANCE??!1),this.signals.PERTE_MAITRISES_CRITIQUE.set(e?.PERTE_MAITRISES_CRITIQUE??!1),this.signals.PERTE_MAITRISES_DOS.set(e?.PERTE_MAITRISES_DOS??!1),this.signals.PERTE_MAITRISES_SOIN.set(e?.PERTE_MAITRISES_SOIN??!1),this.signals.PERTE_MAITRISES_BERZERK.set(e?.PERTE_MAITRISES_BERZERK??!1)}setDefaultValue(){this.setMajor()}setMajor(...e){this.signals.PA.set(e.some(t=>t.id===31)),this.signals.PM.set(e.some(t=>t.id===41)),this.signals.PW.set(e.some(t=>t.id===191)),this.signals.PO.set(e.some(t=>t.id===160)),this.signals.CONTROLE.set(e.some(t=>t.id===184)),this.signals.ARMURE_DONNEE.set(e.some(t=>t.id===39&&t.parameter===120)),this.signals.ARMURE_RECUE.set(e.some(t=>t.id===39&&t.parameter===121)),this.signals.CRITIQUE.set(e.some(t=>t.id===150)),this.signals.PARADE.set(e.some(t=>t.id===875)),this.signals.RESISTANCE_DOS.set(e.some(t=>t.id===71)),this.signals.RESISTANCE_CRITIQUE.set(e.some(t=>t.id===988)),this.signals.PERTE_PA.set(e.some(t=>t.id===56)),this.signals.PERTE_PM.set(e.some(t=>t.id===57)),this.signals.PERTE_PW.set(e.some(t=>t.id===192)),this.signals.PERTE_PO.set(e.some(t=>t.id===161)),this.signals.PERTE_CONTROLE.set(e.some(t=>t.id===-1)),this.signals.PERTE_ARMURE_DONNEE.set(e.some(t=>t.id===40&&t.parameter===120)),this.signals.PERTE_ARMURE_RECUE.set(e.some(t=>t.id===40&&t.parameter===121)),this.signals.PERTE_CRITIQUE.set(e.some(t=>t.id===168)),this.signals.PERTE_PARADE.set(e.some(t=>t.id===876)),this.signals.PERTE_RESISTANCE_DOS.set(e.some(t=>t.id===1063)),this.signals.PERTE_RESISTANCE_CRITIQUE.set(e.some(t=>t.id===1062)),this.signals.PERTE_MAITRISES_MELEE.set(e.some(t=>t.id===1059)),this.signals.PERTE_MAITRISES_DISTANCE.set(e.some(t=>t.id===1060)),this.signals.PERTE_MAITRISES_CRITIQUE.set(e.some(t=>t.id===1056)),this.signals.PERTE_MAITRISES_DOS.set(e.some(t=>t.id===181)),this.signals.PERTE_MAITRISES_SOIN.set(e.some(t=>t.id===-1)),this.signals.PERTE_MAITRISES_BERZERK.set(e.some(t=>t.id===1061))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ue=(r=>(r.COEUR_HUPPERMAGE="COEUR_HUPPERMAGE",r.DENOUEMENT="DENOUEMENT",r.DEMESURE="DEMESURE",r.CHAOS="CHAOS",r))(Ue||{});var k=class s extends f{static DEFAULT_VALUE=[];multiplicateurElem=new E(1);multiplicateurElem$=this.multiplicateurElem.asObservable();denouement=new E(!1);denouement$=this.denouement.asObservable();demesure=new E(!1);demesure$=this.demesure.asObservable();chaos=new E(!1);chaos$=this.chaos.asObservable();keyEnum="KEY_MODIFIER_MECANISM";form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(e){let t=1;e?.includes("COEUR_HUPPERMAGE".valueOf())&&(t*=1.2),this.multiplicateurElem.next(t),this.denouement.next(e?.includes("DENOUEMENT".valueOf())??!1),this.demesure.next(e?.includes("DEMESURE".valueOf())??!1),this.chaos.next(e?.includes("CHAOS".valueOf())??!1)}setValue(e){this.form.setValue(e??s.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var H=class s extends f{static DEFAULT_LEVEL_MIN=200;static DEFAULT_LEVEL_MAX=245;selected=new E([]);selected$=this.selected.asObservable();levelMin=new E(s.DEFAULT_LEVEL_MIN);levelMin$=this.levelMin.asObservable();levelMax=new E(s.DEFAULT_LEVEL_MAX);levelMax$=this.levelMax.asObservable();keyEnum="KEY_ITEM_LEVEL";form=new N({levelMin:new o(s.DEFAULT_LEVEL_MIN,{nonNullable:!0}),levelMax:new o(s.DEFAULT_LEVEL_MAX,{nonNullable:!0})});constructor(){super(),this.init()}handleChanges(e){this.levelMin.next(e.levelMin??s.DEFAULT_LEVEL_MIN),this.levelMax.next(e.levelMax??s.DEFAULT_LEVEL_MAX)}setValue(e){this.form.setValue({levelMin:e?.levelMin??s.DEFAULT_LEVEL_MIN,levelMax:e?.levelMax??s.DEFAULT_LEVEL_MAX})}setDefaultValue(){this.form.setValue({levelMin:s.DEFAULT_LEVEL_MIN,levelMax:s.DEFAULT_LEVEL_MAX})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var K=class s extends f{injector=p(C);selected=new E([]);selected$=this.selected.asObservable();rarity=new E([]);rarity$=this.rarity.asObservable();keyEnum="KEY_RARETE_ITEM";signals={normal:l(!1),rare:l(!1),mythique:l(!1),legendaire:l(!1),souvenir:l(!1),relique:l(!1),epique:l(!1)};form=new N({normal:new o,rare:new o,mythique:new o,legendaire:new o,souvenir:new o,relique:new o,epique:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&(this.signals.normal.set(e.normal??!1),this.signals.rare.set(e.rare??!1),this.signals.mythique.set(e.mythique??!1),this.signals.legendaire.set(e.legendaire??!1),this.signals.souvenir.set(e.souvenir??!1),this.signals.relique.set(e.relique??!1),this.signals.epique.set(e.epique??!1)),M(()=>{let t={normal:this.signals.normal(),rare:this.signals.rare(),mythique:this.signals.mythique(),legendaire:this.signals.legendaire(),souvenir:this.signals.souvenir(),relique:this.signals.relique(),epique:this.signals.epique()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){let t=[];e.normal&&t.push(1),e.rare&&t.push(2),e.mythique&&t.push(3),e.legendaire&&t.push(4),e.relique&&t.push(5),e.souvenir&&t.push(6),e.epique&&t.push(7),this.rarity.next(t)}setValue(e){this.signals.normal.set(e?.normal??!1),this.signals.rare.set(e?.rare??!1),this.signals.mythique.set(e?.mythique??!1),this.signals.legendaire.set(e?.legendaire??!1),this.signals.souvenir.set(e?.souvenir??!1),this.signals.relique.set(e?.relique??!1),this.signals.epique.set(e?.epique??!1)}setRarity(...e){this.signals.normal.set(e.includes(1)),this.signals.rare.set(e.includes(2)),this.signals.mythique.set(e.includes(3)),this.signals.legendaire.set(e.includes(4)),this.signals.relique.set(e.includes(5)),this.signals.souvenir.set(e.includes(6)),this.signals.epique.set(e.includes(7))}setDefaultValue(){this.setRarity()}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var ne=class s extends f{rareteItemFormServices=p(K);itemTypeFormServices=p(j);itemTypeService=p(W);itemLevelFormService=p(H);majorPresentFormService=p(Q);static DEFAULT_VALUE="";itemName=new E("");itemName$=this.itemName.asObservable();keyEnum="KEY_SEARCH_ITEM_NAME";form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(e){this.itemName.next(e??s.DEFAULT_VALUE)}setValue(e){this.form.setValue(e??s.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE)}setFilter(e){this.rareteItemFormServices.setDefaultValue(),this.majorPresentFormService.setDefaultValue();let t=this.itemTypeService.getItemType(e.itemTypeId);if(t)if(this.itemTypeFormServices.setItemType(t),e.level<=20)this.itemLevelFormService.setValue({levelMin:0,levelMax:20});else{let i=Math.ceil((e.level-20)/15);this.itemLevelFormService.setValue({levelMin:(i-1)*15+20+1,levelMax:i*15+20})}}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var G=class s extends f{injector=p(C);idResistances=new E([]);idResistances$=this.idResistances.asObservable();keyEnum="KEY_RESISTANCES";signals={feu:l(!1),eau:l(!1),terre:l(!1),air:l(!1)};form=new N({feu:new o,eau:new o,terre:new o,air:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&(this.signals.feu.set(e.feu??!1),this.signals.eau.set(e.eau??!1),this.signals.terre.set(e.terre??!1),this.signals.air.set(e.air??!1)),M(()=>{let t={feu:this.signals.feu(),eau:this.signals.eau(),terre:this.signals.terre(),air:this.signals.air()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){let t=[];e.feu&&t.push(82),e.eau&&t.push(83),e.terre&&t.push(84),e.air&&t.push(85),this.idResistances.next(t)}setValue(e){this.signals.feu.set(e?.feu??!1),this.signals.eau.set(e?.eau??!1),this.signals.terre.set(e?.terre??!1),this.signals.air.set(e?.air??!1)}setResistances(...e){this.signals.feu.set(e.includes(82)),this.signals.eau.set(e.includes(83)),this.signals.terre.set(e.includes(84)),this.signals.air.set(e.includes(85))}setDefaultValue(){this.setResistances()}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Y=class s extends f{injector=p(C);nbElements=new E(0);nbElements$=this.nbElements.asObservable();idMaitrises=new E([]);idMaitrises$=this.idMaitrises.asObservable();keyEnum="KEY_MAITRISES";signals={feu:l(!1),eau:l(!1),terre:l(!1),air:l(!1),critique:l(!1),dos:l(!1),melee:l(!1),distance:l(!1),soin:l(!1),berzerk:l(!1)};form=new N({feu:new o,eau:new o,terre:new o,air:new o,critique:new o,dos:new o,melee:new o,distance:new o,soin:new o,berzerk:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&(this.signals.feu.set(e.feu??!1),this.signals.eau.set(e.eau??!1),this.signals.terre.set(e.terre??!1),this.signals.air.set(e.air??!1),this.signals.critique.set(e.critique??!1),this.signals.dos.set(e.dos??!1),this.signals.melee.set(e.melee??!1),this.signals.distance.set(e.distance??!1),this.signals.soin.set(e.soin??!1),this.signals.berzerk.set(e.berzerk??!1)),M(()=>{let t={feu:this.signals.feu(),eau:this.signals.eau(),terre:this.signals.terre(),air:this.signals.air(),critique:this.signals.critique(),dos:this.signals.dos(),melee:this.signals.melee(),distance:this.signals.distance(),soin:this.signals.soin(),berzerk:this.signals.berzerk()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){let t=0,i=[];e.feu&&(t++,i.push(122)),e.eau&&(t++,i.push(124)),e.terre&&(t++,i.push(123)),e.air&&(t++,i.push(125)),this.nbElements.next(t),e.critique&&i.push(149),e.dos&&i.push(180),e.melee&&i.push(1052),e.distance&&i.push(1053),e.soin&&i.push(26),e.berzerk&&i.push(1055),this.idMaitrises.next(i)}setValue(e){this.signals.feu.set(e?.feu??!1),this.signals.eau.set(e?.eau??!1),this.signals.terre.set(e?.terre??!1),this.signals.air.set(e?.air??!1),this.signals.critique.set(e?.critique??!1),this.signals.dos.set(e?.dos??!1),this.signals.melee.set(e?.melee??!1),this.signals.distance.set(e?.distance??!1),this.signals.soin.set(e?.soin??!1),this.signals.berzerk.set(e?.berzerk??!1)}setDefaultValue(){this.setMaitrises()}setMaitrises(...e){this.signals.feu.set(e.includes(122)),this.signals.eau.set(e.includes(124)),this.signals.terre.set(e.includes(123)),this.signals.air.set(e.includes(125)),this.signals.critique.set(e.includes(149)),this.signals.dos.set(e.includes(180)),this.signals.melee.set(e.includes(1052)),this.signals.distance.set(e.includes(1053)),this.signals.soin.set(e.includes(26)),this.signals.berzerk.set(e.includes(1055))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Z=class s extends f{static DEFAULT_VALUE=!1;onlyNoElem=new E(!1);onlyNoElem$=this.onlyNoElem.asObservable();keyEnum="KEY_ONLY_NO_ELEM";form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(e){this.onlyNoElem.next(e??!1)}setValue(e){this.form.setValue(e??s.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var ae=class s extends f{injector=p(C);static DEFAULT_VALUE=!1;reverse=new E(s.DEFAULT_VALUE);reverse$=this.reverse.asObservable();keyEnum="KEY_REVERSE";signal=l(s.DEFAULT_VALUE);form=new o(s.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.initSignal(),this.init()}initSignal(){let e=this.localStorageService.getItem(this.keyEnum);e!=null&&this.signal.set(e),M(()=>{let t=this.signal();this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){this.reverse.next(e??s.DEFAULT_VALUE)}setValue(e){this.signal.set(e??s.DEFAULT_VALUE)}setDefaultValue(){this.signal.set(s.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var oe=class s extends f{injector=p(C);static DEFAULT_VALUE_DROP=!0;static DEFAULT_VALUE_CRAFTABLE=!0;static DEFAULT_VALUE_BOSS=!0;static DEFAULT_VALUE_ARCHI=!0;static DEFAULT_VALUE_PVP=!0;drop=new E(s.DEFAULT_VALUE_DROP);drop$=this.drop.asObservable();craftable=new E(s.DEFAULT_VALUE_CRAFTABLE);craftable$=this.craftable.asObservable();boss=new E(s.DEFAULT_VALUE_BOSS);boss$=this.boss.asObservable();archi=new E(s.DEFAULT_VALUE_ARCHI);archi$=this.archi.asObservable();pvp=new E(s.DEFAULT_VALUE_PVP);pvp$=this.pvp.asObservable();keyEnum="KEY_OBTENTION";signals={DROP:l(s.DEFAULT_VALUE_DROP),CRAFTABLE:l(s.DEFAULT_VALUE_CRAFTABLE),BOSS:l(s.DEFAULT_VALUE_BOSS),ARCHI:l(s.DEFAULT_VALUE_ARCHI),PVP:l(s.DEFAULT_VALUE_PVP)};form=new N({DROP:new o,CRAFTABLE:new o,BOSS:new o,ARCHI:new o,PVP:new o});constructor(){super(),this.initSignals(),this.init()}initSignals(){let e=this.localStorageService.getItem(this.keyEnum);e&&(this.signals.DROP.set(e.DROP??s.DEFAULT_VALUE_DROP),this.signals.CRAFTABLE.set(e.CRAFTABLE??s.DEFAULT_VALUE_CRAFTABLE),this.signals.BOSS.set(e.BOSS??s.DEFAULT_VALUE_BOSS),this.signals.ARCHI.set(e.ARCHI??s.DEFAULT_VALUE_ARCHI),this.signals.PVP.set(e.PVP??s.DEFAULT_VALUE_PVP)),M(()=>{let t={DROP:this.signals.DROP(),CRAFTABLE:this.signals.CRAFTABLE(),BOSS:this.signals.BOSS(),ARCHI:this.signals.ARCHI(),PVP:this.signals.PVP()};this.handleChanges(t),this.localStorageService.setItem(this.keyEnum,t)},{injector:this.injector,allowSignalWrites:!0})}handleChanges(e){this.drop.next(!e.DROP),this.craftable.next(!e.CRAFTABLE),this.boss.next(!e.BOSS),this.archi.next(!e.ARCHI),this.pvp.next(!e.PVP)}setValue(e){this.signals.DROP.set(e?.DROP??s.DEFAULT_VALUE_DROP),this.signals.CRAFTABLE.set(e?.CRAFTABLE??s.DEFAULT_VALUE_CRAFTABLE),this.signals.BOSS.set(e?.BOSS??s.DEFAULT_VALUE_BOSS),this.signals.ARCHI.set(e?.ARCHI??s.DEFAULT_VALUE_ARCHI),this.signals.PVP.set(e?.PVP??s.DEFAULT_VALUE_PVP)}setDefaultValue(){this.signals.DROP.set(s.DEFAULT_VALUE_DROP),this.signals.CRAFTABLE.set(s.DEFAULT_VALUE_CRAFTABLE),this.signals.BOSS.set(s.DEFAULT_VALUE_BOSS),this.signals.ARCHI.set(s.DEFAULT_VALUE_ARCHI),this.signals.PVP.set(s.DEFAULT_VALUE_PVP)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Pe=(c=>(c[c.EMBLEME_SHUSHU_1=18670]="EMBLEME_SHUSHU_1",c[c.EMBLEME_SHUSHU_2=18671]="EMBLEME_SHUSHU_2",c[c.EMBLEME_SHUSHU_3=18672]="EMBLEME_SHUSHU_3",c[c.EMBLEME_SHUSHU_4=18673]="EMBLEME_SHUSHU_4",c[c.EMBLEME_SHUSHU_5=18674]="EMBLEME_SHUSHU_5",c[c.EMBLEME_SHUSHU_6=18675]="EMBLEME_SHUSHU_6",c[c.EMBLEME_SHUSHU_7=18676]="EMBLEME_SHUSHU_7",c[c.EMBLEME_SHUSHU_8=18677]="EMBLEME_SHUSHU_8",c[c.EMBLEME_SHUSHU_9=18678]="EMBLEME_SHUSHU_9",c[c.EMBLEME_SHUSHU_10=18679]="EMBLEME_SHUSHU_10",c[c.EMBLEME_SHUSHU_11=18680]="EMBLEME_SHUSHU_11",c[c.EMBLEME_SHUSHU_12=18681]="EMBLEME_SHUSHU_12",c))(Pe||{}),Ce=s=>Object.values(Pe).includes(s);var le=class s{itemTypeFormServices=p(j);translateService=p(he);onlyNoSecondaryFormService=p(q);sortChoiceFormService=p(se);majorPresentFormService=p(Q);modifierElemMaitrisesFormService=p(k);searchItemNameFormService=p(ne);rareteItemFormService=p(K);itemLevelFormService=p(H);resistanceFormService=p(G);maitrisesFormService=p(Y);ankamaCdnFacade=p(ee);onlyNoElemFormService=p(Z);reverseFormService=p(ae);obtentionFormService=p(oe);monsterDropService=p(te);familiersService=p(ie);static ARMURE_DONNEE_RECUE_LIST=[39,40];static RESISTANCE_ELEM_IDS=[85,83,84,82];static MALUS_RESIS_ELEM_IDS=[97,96,98];static MAITRISES_ELEM_IDS=[122,123,124,125];static PERTE_MAITRISES_IDS=[130,132];static EQUILIBRE_RESISTANCE_MULTIPLIER=1.2;static DEFAULT_NB_ELEMENTS=4;idPierresList=[29847,29848,29849,29850,29851];items=[];fullItems$=new E([]);items$;itemsFilterByItemName$;itemsFilters$;recipesByProductId=new Map;itemsByName=new Map;monsterDropsByItemId=new Map;archiIds=new Set;sublimations=new E([]);sublimations$=this.sublimations.asObservable();isLoading=l(!0);init(){this.initItemsList(),this.initFilter();let e=L([this.itemsFilters$,this.maitrisesFormService.nbElements$,this.maitrisesFormService.idMaitrises$,this.sortChoiceFormService.sort$,this.modifierElemMaitrisesFormService.multiplicateurElem$,this.modifierElemMaitrisesFormService.denouement$,this.resistanceFormService.idResistances$,this.onlyNoElemFormService.onlyNoElem$,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.chaos$]).pipe(d(([t,i,r,n,a,m,h,u,S,b])=>this.fillItemWeightMap(t,i,r,n,a,h,m,u,S,b)),A(([t])=>t));this.items$=L([e,this.reverseFormService.reverse$]).pipe(A(([t,i])=>{let r=t.sort(this.sortItems());return i?r.reverse():r}),d(()=>this.isLoading.set(!1)),B(1)),this.items$.pipe($(1)).subscribe()}initFamiliers(){this.familiersService.familiers$.pipe($(1)).subscribe(e=>{let t=new Map;this.items.forEach(i=>{t.set(i.id,i)}),e.forEach(i=>{let r=t.get(i.id);r&&i.statsList.forEach((n,a)=>{a<r.equipEffects.length&&(r.equipEffects[a].params[0]=n)})})})}sortItems(){return(e,t)=>t.weightForSort>e.weightForSort?1:t.weightForSort===e.weightForSort?t.weight-e.weight:-1}isNotWIP(e){return!!e.title}filterObtention(e,t,i,r,n,a){let m=e.isCraftable&&!i;return m=m||e.mobDropable.length>0&&!t,m=m||e.bossDropable.length>0&&!r,m=m||e.archiDropable.length>0&&!n,m=m||e.isPvP&&!a,m=m||e.mobDropable.length===0&&e.bossDropable.length===0&&e.archiDropable.length===0&&!e.isCraftable&&!e.isPvP,m}loadSublimations(){let t=this.items.filter(i=>i.itemTypeId===812).filter(i=>i.enchantement.isEpic||i.enchantement.isRelic||["I","II","III"].includes(i.title.fr.split(" ").pop()||"")).sort((i,r)=>i.title.fr.localeCompare(r.title.fr));this.sublimations.next(t),this.prepareJsonSublimations(t)}prepareJsonSublimations(e){let t=[],i=new Map;e.forEach(r=>{if(r.enchantement.isEpic||r.enchantement.isRelic)i.set(r.title.fr,[r]);else{let n=r.title.fr.replace(/ I{1,3}$| II$| III$/,"").trim();i.has(n)||i.set(n,[]),i.get(n)?.push(r)}}),i.forEach(r=>{let n=[];r.forEach(S=>{if(S.enchantement.isEpic||S.enchantement.isRelic)n.push({id:S.id,level:1});else{let b=S.title.fr.endsWith(" III")?3:S.title.fr.endsWith(" II")?2:1;n.push({id:S.id,level:b})}});let a=0,m=r[0];if(!m.enchantement.isEpic&&!m.enchantement.isRelic){let S=m.description.fr.slice(m.description.fr.length-2,m.description.fr.length-1);a=Number.parseInt(S||"0")}let h=m.enchantement.isEpic||m.enchantement.isRelic,u=[];t.push({linkSublimation:n,title:{fr:h?r[0].title.fr:r[0].title.fr.replace(/ I{1,3}$| II$| III$/,"").trim(),en:h?r[0].title.en:r[0].title.en.replace(/ I{1,3}$| II$| III$/,"").trim(),es:h?r[0].title.es:r[0].title.es.replace(/ I{1,3}$| II$| III$/,"").trim(),pt:h?r[0].title.pt:r[0].title.pt.replace(/ I{1,3}$| II$| III$/,"").trim()},description:{fr:"",en:"",es:"",pt:""},levelMax:a,baseEffect:u,id:n[0].id,gfxId:m.idImage,isEpic:m.enchantement.isEpic,isRelic:m.enchantement.isRelic,slotColorPattern:m.enchantement.slotColorPattern,bossDropable:[],isCraftable:!1})})}initFilter(){this.items=this.items.filter(u=>![480,811,812].includes(u.itemTypeId)).filter(u=>this.isNotWIP(u)),this.initFamiliers(),this.fullItems$.next(this.items),this.itemsFilterByItemName$=L([this.fullItems$,this.searchItemNameFormService.itemName$]).pipe(A(([u,S])=>u.filter(b=>de(b.title[this.translateService.currentLang].toString()).includes(de(S)))));let e=L([this.itemsFilterByItemName$,this.obtentionFormService.drop$,this.obtentionFormService.craftable$,this.obtentionFormService.boss$,this.obtentionFormService.archi$,this.obtentionFormService.pvp$]).pipe(A(([u,S,b,c,T,_])=>u.filter(w=>this.filterObtention(w,S,b,c,T,_)))),t=L([e,this.itemLevelFormService.levelMin$]).pipe(A(([u,S])=>u.filter(b=>b.level>=S||b.itemTypeId===582))),i=L([t,this.itemLevelFormService.levelMax$]).pipe(A(([u,S])=>u.filter(b=>b.level<=S||b.itemTypeId===582))),r=L([i,this.rareteItemFormService.rarity$]).pipe(A(([u,S])=>u.filter(b=>S.length===0||S.includes(b.rarity)||b.itemTypeId===582))),n=L([r,this.onlyNoElemFormService.onlyNoElem$]).pipe(A(([u,S])=>u.filter(b=>!S||!b.equipEffects.find(c=>[122,124,123,125,120,1068].includes(c.actionId))))),a=L([n,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.denouement$,this.onlyNoElemFormService.onlyNoElem$]).pipe(A(([u,S,b,c])=>u.filter(T=>!S||!T.equipEffects.find(_=>[180,1052,1053,26,1055].includes(_.actionId))&&(b&&!c||!T.equipEffects.find(_=>_.actionId===149))))),m=L([a,this.majorPresentFormService.idMajor$]).pipe(A(([u,S])=>u.filter(b=>this.majorIsPresent(S,b)))),h=L([m,this.modifierElemMaitrisesFormService.demesure$]).pipe(A(([u,S])=>u.filter(b=>!S||b.equipEffects.find(c=>[875,150].includes(c.actionId)))));this.itemsFilters$=L([h,this.itemTypeFormServices.selected$]).pipe(A(([u,S])=>u.filter(b=>S.length===0||S.includes(b.itemTypeId))))}fillItemWeightMap(e,t,i,r,n,a,m,h,u,S){let b=0,c=0;e.forEach(T=>{T.resistance=Math.trunc(this.calculResistancesForAnItem(T,a)),T.maitrise=Math.trunc(this.calculMaitrisesForAnItem(T,t,i,n,m,h,u,S)),T.weight=this.calculWeight(T.resistance,T.maitrise,T.level),T.weightForSort=0}),r==="EQUILIBRE"&&e.length&&(b=e.sort((T,_)=>_.maitrise-T.maitrise)[0].maitrise,c=e.sort((T,_)=>_.resistance-T.resistance)[0].resistance),e.forEach(T=>{let _=this.createEffectsMap(T);T.weightForSort=this.calculateWeightForSort(T,r,_,b,c)})}createEffectsMap(e){let t=new Map;return e.equipEffects.forEach(i=>{t.set(i.actionId,i.params[0])}),t}calculateWeightForSort(e,t,i,r,n){switch(t){case"POIDS":return e.weight;case"MAITRISES":return e.maitrise;case"EQUILIBRE":return e.maitrise/r+s.EQUILIBRE_RESISTANCE_MULTIPLIER*(e.resistance/n);case"POINT_DE_VIE":return this.calculateNetEffect(i,20,21);case"PARADE_ARMURE_DONNEE":return this.calculateParadeArmureDonnee(e,i);case"TACLE":return this.calculateNetEffect(i,173,174);case"ESQUIVE":return this.calculateNetEffect(i,175,176);case"TACLE_ESQUIVE":return this.calculateNetEffect(i,173,174)+this.calculateNetEffect(i,175,176);case"CRITIQUE":return this.calculateNetEffect(i,150,168);case"PARADE":return this.calculateNetEffect(i,875,876);case"CRITIQUE_PARADE":return this.calculateNetEffect(i,150,168)+this.calculateNetEffect(i,875,876);case"PA":return this.calculateNetEffect(i,31,56);case"PM":return this.calculateNetEffect(i,41,57);case"PO":return this.calculateNetEffect(i,160,161);case"PW":return this.calculateNetEffect(i,193,194)+this.calculateNetEffect(i,191,192);default:return e.resistance}}calculateParadeArmureDonnee(e,t){let i=t.get(875)??0;return e.equipEffects.forEach(r=>{r.actionId===39&&r.params[4]===120&&(i+=r.params[0])}),i}getEffectValue(e,t){return e.get(t)??0}calculateNetEffect(e,t,i){return this.getEffectValue(e,t)-this.getEffectValue(e,i)}calculWeight(e,t,i){return Math.trunc(this.ratioWeightByLevel(i)*e+t)}ratioWeightByLevel(e){return ue.find(i=>e<i.maxLevel)?.ratio??F(33/27)}initItemsList(){L([this.ankamaCdnFacade.item$,this.ankamaCdnFacade.recipes$,this.ankamaCdnFacade.idSiouperes$,this.monsterDropService.monsterDrops$]).pipe($(1),d(([e,t,i,r])=>{e.filter(n=>!Ce(n.definition.item.id)).forEach(n=>this.items.push({id:n.definition.item.id,level:n.definition.item.level,rarity:n.definition.item.baseParameters.rarity,itemTypeId:n.definition.item.baseParameters.itemTypeId,equipEffects:n.definition.equipEffects.map(a=>({id:a.effect.definition.id,actionId:a.effect.definition.actionId,params:a.effect.definition.params})),title:{fr:n.title.fr.trim(),en:n.title.en.trim(),es:n.title.es.trim(),pt:n.title.pt.trim()},description:n.description,idImage:n.definition.item.graphicParameters.gfxId,weightForSort:0,weight:0,maitrise:0,resistance:0,isCraftable:!1,mobDropable:[],bossDropable:[],archiDropable:[],isPvP:!1,enchantement:{slotColorPattern:n.definition.item.sublimationParameters?.slotColorPattern??[],isEpic:n.definition.item.sublimationParameters?.isEpic??!1,isRelic:n.definition.item.sublimationParameters?.isRelic??!1}})),this.buildIndexes(t,r,i),this.items.forEach(n=>this.calculItemIsCraftable(n)),this.items.forEach(n=>this.calculItemIsDropable(n)),this.items.forEach(n=>this.calculIsItemPvP(n))})).subscribe()}buildIndexes(e,t,i){for(let r of e)this.recipesByProductId.set(r.productedItemId,r);for(let r of this.items)this.itemsByName.has(r.title.fr)||this.itemsByName.set(r.title.fr,[]),this.itemsByName.get(r.title.fr).push(r);for(let r of t)for(let n of r.idsDrop)this.monsterDropsByItemId.has(n)||this.monsterDropsByItemId.set(n,[]),this.monsterDropsByItemId.get(n).push(r);for(let r of i)this.archiIds.add(r.definition.id)}calculIsItemPvP(e){if(!this.ankamaCdnFacade.isItemPvP(e.id))return;let i=this.itemsByName.get(e.title.fr);i&&i.forEach(r=>r.isPvP=!0)}calculItemIsCraftable(e){if(e.isCraftable||!this.recipesByProductId.get(e.id))return;if(e.rarity===6){e.isCraftable=!0;return}let i=this.itemsByName.get(e.title.fr);if(!(!i||i.some(n=>e.level<=35?n.rarity<e.rarity:n.rarity<e.rarity&&n.level>=35)))for(let n of i)n.isCraftable=!0}calculItemIsDropable(e){if(e.mobDropable.length)return;let t=this.monsterDropsByItemId.get(e.id);if(!t||t.length===0)return;let i=t.filter(a=>a.idsDrop.some(m=>this.idPierresList.includes(m))),r=t.filter(a=>a.idsDrop.some(m=>this.archiIds.has(m))).filter(a=>!i.includes(a));if(t=t.filter(a=>!i.includes(a)&&!r.includes(a)),e.rarity===6){t.length&&(e.mobDropable=t),i.length&&(e.bossDropable=i),r.length&&(e.archiDropable=r);return}let n=this.itemsByName.get(e.title.fr);if(n)for(let a of n)a.rarity!==6&&((a.rarity!==1||a.level<=35)&&a.level>=e.level&&t.length&&(a.mobDropable=t),i.length&&(a.bossDropable=i),r.length&&(a.archiDropable=r))}searchItem(e){return this.fullItems$.pipe(P(t=>t.length>0),A(t=>t.find(i=>i.id===e)))}getItem(e){return this.fullItems$.value.find(t=>t.id===e)}majorIsPresent(e,t){return!e.find(i=>!s.ARMURE_DONNEE_RECUE_LIST.includes(i.id)&&!t.equipEffects.map(r=>r.actionId).includes(i.id)||i.id===39&&!t.equipEffects.find(r=>r.actionId===39&&r.params[4]===i.parameter)||i.id===40&&!t.equipEffects.find(r=>r.actionId===40&&r.params[4]===i.parameter))}calculResistancesForAnItem(e,t){let i=0,r=t.length===0?s.DEFAULT_NB_ELEMENTS:t.length;return e.equipEffects.forEach(n=>{n.actionId===1069&&n.params[2]>=t.length?i+=n.params[0]*Math.min(n.params[2],r):n.actionId===80?i+=n.params[0]*r:n.actionId===90||n.actionId===100?i-=n.params[0]*r:s.RESISTANCE_ELEM_IDS.includes(n.actionId)&&(r===s.DEFAULT_NB_ELEMENTS||t.includes(n.actionId))?i+=n.params[0]:(r===s.DEFAULT_NB_ELEMENTS&&s.MALUS_RESIS_ELEM_IDS.includes(n.actionId)||n.actionId===97&&t.includes(82)||n.actionId===96&&t.includes(84)||n.actionId===98&&t.includes(83))&&(i-=n.params[0])}),i}calculMaitrisesForAnItem(e,t,i,r,n,a,m,h){let u=0,S=[...i].filter(c=>!s.MAITRISES_ELEM_IDS.includes(c));e.equipEffects.forEach(c=>{!a&&!h&&(c.actionId===120||c.actionId===1068&&c.params[2]>=t||c.actionId===149&&n)?u+=c.params[0]*r:!m&&S.includes(c.actionId)?u+=c.params[0]:(!a&&!h&&s.PERTE_MAITRISES_IDS.includes(c.actionId)||!m&&(c.actionId===1056&&i.includes(149)||c.actionId===181&&i.includes(180)||c.actionId===1059&&i.includes(1052)||c.actionId===1060&&i.includes(1053)||c.actionId===1061&&i.includes(1055)))&&(u-=c.params[0])});let b=e.equipEffects.find(c=>s.MAITRISES_ELEM_IDS.includes(c.actionId)&&(t===0||t===1&&i.includes(c.actionId)));return!a&&!h&&b&&(u+=b.params[0]*r),u}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ee=class s{sublimations=new Map;sublimationsClassique=[];sublimationsEpiqueRelique=[];http=p(x);loadPromise;load(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(e=>{this.http.get("/sublimations.json").pipe(d(t=>t.forEach(i=>this.sublimations.set(i.title.fr,i))),d(t=>this.sublimationsClassique.push(...t.filter(i=>!i.isEpic&&!i.isRelic))),d(t=>this.sublimationsEpiqueRelique.push(...t.filter(i=>i.isEpic||i.isRelic))),B(1)).subscribe({next:()=>e(),error:t=>{console.error("Failed to load sublimations:",t),e()}})}),this.loadPromise)}getSublimations(){return this.sublimationsClassique}getSublimationsEpiqueRelique(){return this.sublimationsEpiqueRelique}getSublimationById(e){for(let t of this.sublimations.values())if(t.id===e)return t}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};function X(){let s=[];for(let e=0;e<4;e++)s.push({color:-1,lvl:0});return{chasses:s,sublimation:void 0}}function Me(s){switch(s){case 1:return 3;case 2:return 6;case 3:return 9;case 4:return 12;case 5:return 15;case 6:return 21;case 7:return 30;case 8:return 39;case 9:return 48;case 10:return 60;case 11:return 66;default:return 0}}function Ne(s){switch(s){case 1:return 2;case 2:return 4;case 3:return 6;case 4:return 8;case 5:return 10;case 6:return 14;case 7:return 20;case 8:return 26;case 9:return 32;case 10:return 40;case 11:return 44;default:return 0}}function ye(s){switch(s){case 1:return 4;case 2:return 8;case 3:return 12;case 4:return 16;case 5:return 20;case 6:return 28;case 7:return 40;case 8:return 52;case 9:return 64;case 10:return 80;case 11:return 88;default:return 0}}function Oe(s){switch(s){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 7;case 7:return 10;case 8:return 13;case 9:return 16;case 10:return 20;case 11:return 22;default:return 0}}var Fe=class s extends f{static DEFAULT_VALUE=()=>{let e=[];for(let t=0;t<10;t++)e.push(X());return{chasseCombinaison:e}};recapChassesEffect=new E([]);recapChassesEffect$=this.recapChassesEffect.asObservable();enchantement=new E(s.DEFAULT_VALUE());enchantement$=this.enchantement.asObservable();sublimationsIdToLevel=new E(new Map);sublimationsIdToLevel$=this.sublimationsIdToLevel.asObservable();keyEnum="KEY_ENCHANTEMENT";form=new o(s.DEFAULT_VALUE(),{nonNullable:!0});sublimationService=p(Ee);urlServices=p(J);isLoadingFromUrl=!1;indexToItemType=new Map([[0,8],[1,5],[2,9],[3,3],[4,3],[5,4],[6,6],[7,10],[8,7],[9,2]]);doubleEffect=new Map([[120,[9,6]],[26,[5,10]],[1052,[8,6]],[1053,[7,2]],[1055,[5,6]],[149,[10,2]],[180,[7,4]],[173,[3,3]],[175,[3,3]],[171,[5,6]],[82,[9,7]],[83,[9,10]],[85,[9,6]],[84,[9,4]],[20,[8,2]]]);constructor(){super();let e=this.urlServices.getEnchantementFromUrl();this.init(),e&&this.sublimationService.load().then(()=>{this.isLoadingFromUrl=!0,this.decodeAndSaveCodeBuild(e),this.isLoadingFromUrl=!1,this.enchantement.next(this.form.value),this.handleChanges(this.form.value)})}generateCodeBuild(e){let t=[];e.chasseCombinaison.forEach(r=>{let n=[];r.chasses.forEach(m=>{if(m.color===-1)n.push("0");else{let h=m.joker?"1":"0",u=m.idAction||0;n.push(`${m.color}.${m.lvl}.${u}.${h}`)}});let a=n.join("-");r.sublimation&&(a+=`_${r.sublimation.id}.${r.sublimation.level}`),t.push(a)});let i=t.join("|");return e.epique&&(i+=`|E${e.epique.id}`),e.relique&&(i+=`|R${e.relique.id}`),i}decodeAndSaveCodeBuild(e){try{let t={chasseCombinaison:[],epique:void 0,relique:void 0};for(let a=0;a<10;a++)t.chasseCombinaison.push(X());let i=e.split("|"),r=[],n=[];for(let a of i)a.startsWith("E")||a.startsWith("R")?n.push(a):a.trim()&&r.push(a);for(let a=0;a<Math.min(10,r.length);a++){let m=r[a],[h,u]=m.split("_"),S=h.split("-"),b=X();for(let c=0;c<Math.min(4,S.length);c++){let T=S[c];if(T==="0"||!T)continue;let _=T.split(".");if(_.length>=4){let[w,U,De,we]=_.map(R=>parseInt(R,10));b.chasses[c]={color:w,lvl:U,idAction:De,joker:we===1}}}if(u){let[c,T]=u.split(".").map(w=>parseInt(w,10)),_=this.sublimationService.getSublimationById(c);_?b.sublimation={id:c,title:O({},_.title),slotColorPattern:_.slotColorPattern,level:T,isValid:!0}:console.warn(`Sublimation ${c} not found in database`)}t.chasseCombinaison[a]=b}for(let a of n)if(a.startsWith("E")){let m=parseInt(a.substring(1),10),h=this.sublimationService.getSublimationById(m);h&&(t.epique={id:h.id,idImage:h.gfxId,title:O({},h.title),epique:!0,relique:!1})}else if(a.startsWith("R")){let m=parseInt(a.substring(1),10),h=this.sublimationService.getSublimationById(m);h&&(t.relique={id:h.id,idImage:h.gfxId,title:O({},h.title),epique:!1,relique:!0})}this.setValue(t)}catch(t){console.error("Error decoding enchantement from URL:",t)}}equalChasses(e,t){return e.color===t.color&&e.lvl===t.lvl&&e.idAction===t.idAction}removeEpic(){let e=this.getValue();e.epique=void 0,this.setValue(e)}removeRelic(){let e=this.getValue();e.relique=void 0,this.setValue(e)}applySublimationEpicRelic(e){let t=this.getValue();e.epique?(t.epique={id:e.id,idImage:e.idImage,title:O({},e.title),epique:!0,relique:!1},this.setValue(t)):e.relique&&(t.relique={id:e.id,idImage:e.idImage,title:O({},e.title),epique:!1,relique:!0},this.setValue(t))}applySumblimation(e,t){let i=this.getValue(),n=i.chasseCombinaison[e];n.sublimation=t,n.sublimation.isValid=this.canApplySublimation(n,t),this.setValue(i)}removeSublimation(e){let t=this.getValue(),r=t.chasseCombinaison[e];r.sublimation=void 0,this.setValue(t)}applyEffect(e,t,i){let r=this.getValue(),a=r.chasseCombinaison[t];this.equalChasses(a.chasses[e],i)?this.clearEffect(e,t):a.chasses[e]=i,a.sublimation&&(a.sublimation.isValid=this.canApplySublimation(a,a.sublimation)),this.setValue(r)}clearChasseCombinaison(e){let t=this.getValue(),i=t.chasseCombinaison;i[e]=X(),this.setValue(t)}clearEffect(e,t){let i=this.getValue(),n=i.chasseCombinaison[t];n.chasses[e]=X().chasses[0],n.sublimation&&(n.sublimation.isValid=this.canApplySublimation(n,n.sublimation)),this.setValue(i)}changeJokerState(e,t){let i=this.getValue(),r=[...i.chasseCombinaison],n=O({},r[t]),a=[...n.chasses],m=O({},a[e]);m.idAction&&(m.joker=!m.joker,a[e]=m,n.chasses=a,r[t]=n,n.sublimation&&(n.sublimation.isValid=this.canApplySublimation(n,n.sublimation)),this.setValue(Ie(O({},i),{chasseCombinaison:r})))}getChasseEffectValue(e){return e.idAction?[173,175].includes(e.idAction)?Me(e.lvl):[171].includes(e.idAction)?Ne(e.lvl):[20].includes(e.idAction)?ye(e.lvl):[120].includes(e.idAction)?Oe(e.lvl):[26,1052,1053,1055,149,180].includes(e.idAction)?ge(e.lvl):[82,83,85,84].includes(e.idAction)?Le(e.lvl):0:0}handleChanges(e){if(this.isLoadingFromUrl)return;let t=[];e.chasseCombinaison.forEach((a,m)=>{a.chasses.forEach(h=>{if(!h.idAction)return;let u=this.indexToItemType.get(m);if(!u)return;let S=this.doubleEffect.get(h.idAction)?.includes(u)?2:1;t.push({id:h.idAction,value:S*this.getChasseEffectValue(h),params:[]})})});let i=e.chasseCombinaison.filter(a=>!!a.sublimation).map(a=>a.sublimation),r=this.calculMaxSublimationLevel(i);e.epique&&r.set(e.epique.id,1),e.relique&&r.set(e.relique.id,1),this.sublimationsIdToLevel.next(r),this.enchantement.next(e),this.recapChassesEffect.next(t);let n=this.generateCodeBuild(e);this.urlServices.setEnchantementInUrl(n)}calculMaxSublimationLevel(e){let t=new Map;return e.forEach(i=>{let r=t.get(i.id);r===void 0?t.set(i.id,i.level):t.set(i.id,r+i.level)}),t.forEach((i,r)=>{let n=this.sublimationService.getSublimationById(r)?.levelMax;n!==void 0&&i>n&&t.set(r,Math.min(i,n))}),t}setValue(e){let t=e??s.DEFAULT_VALUE(),i={chasseCombinaison:t.chasseCombinaison.map(r=>({chasses:[...r.chasses],sublimation:r.sublimation?O({},r.sublimation):void 0})),epique:t.epique?O({},t.epique):void 0,relique:t.relique?O({},t.relique):void 0};this.form.setValue(i,{emitEvent:!this.isLoadingFromUrl}),this.isLoadingFromUrl||this.enchantement.next(i)}setDefaultValue(){this.form.setValue(s.DEFAULT_VALUE())}getValue(){return this.enchantement.getValue()}canApplySublimationWithItem(e,t){return this.canApplySublimation(e,{id:t.id,title:O({},t.title),slotColorPattern:t.slotColorPattern,isValid:!1,level:t.linkSublimation[0].level})}canApplySublimation(e,t){let i=e.chasses,r=t.slotColorPattern;if(r.length>i.length)return!1;if(i.filter(a=>a.color===-1).length>=2)return!0;for(let a=0;a<=i.length-r.length;a++)if(this.matchPattern(i,r,a))return!0;return!1}matchPattern(e,t,i){for(let r=0;r<t.length;r++){let n=e[i+r],a=t[r];if(n.color===-1)return!1;if(!(n.joker&&this.isValidJokerReplacement(a))&&n.color!==a)return!1}return!0}isValidJokerReplacement(e){return e===3||e===1||e===2}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ve=class s extends Te{itemTypeService=p(W);itemService=p(le);localStorageService=p(Ae);modifierElemMaitrisesFormService=p(k);resistancesFormService=p(G);maitrisesFormService=p(Y);onlyNoElemFormService=p(Z);onlyNoSecondaryFormService=p(q);urlServices=p(J);mapItem=new Map([[2,new E([void 0])],[3,new E([void 0,void 0])],[4,new E([void 0])],[5,new E([void 0])],[6,new E([void 0])],[7,new E([void 0])],[8,new E([void 0])],[9,new E([void 0])],[10,new E([void 0])],[11,new E([void 0])],[12,new E([void 0])],[14,new E([void 0])]]);idItems=new E("");idItems$=this.idItems.asObservable();totalWeight=new E(0);totalWeight$=this.totalWeight.asObservable();listItem=new E([]);listItem$=this.listItem.asObservable();totalMaitrises=new E(0);totalMaitrises$=this.totalMaitrises.asObservable();totalResistances=new E(0);totalResistances$=this.totalResistances.asObservable();indexAnneau=0;constructor(){super(),this.initItemsDirectly(),this.handleCalculTotal()}handleCalculTotal(){L([this.listItem$,this.maitrisesFormService.nbElements$,this.maitrisesFormService.idMaitrises$,this.modifierElemMaitrisesFormService.multiplicateurElem$,this.modifierElemMaitrisesFormService.denouement$,this.resistancesFormService.idResistances$,this.onlyNoElemFormService.onlyNoElem$,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.chaos$]).pipe(me(this.destroy$),d(([e,t,i,r,n,a,m,h,u])=>this.calculTotal(e,t,i,r,a,n,m,h,u))).subscribe()}updateUrl(){L([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(me(this.destroy$),A(e=>e.flat()),A(e=>e.filter(t=>t!=null)),d(e=>this.listItem.next([...new Set(e)])),A(e=>e.map(t=>t?.id)),A(e=>e.filter(t=>t).join(",")),Re(),d(e=>this.setIdItems(e))).subscribe(e=>{this.localStorageService.setItem("KEY_BUILD",e),this.urlServices.setItemsIdInUrl(e)})}initItemsDirectly(){let e="";if(typeof window<"u"){let t=window.location.hash.substring(1);!t&&window.location.search&&(t=window.location.search.substring(1)),e=new URLSearchParams(t).get("itemsId")||""}e||(e=this.localStorageService.getItem("KEY_BUILD")||""),e&&e.trim()!==""&&e.split(",").forEach(i=>{let r=parseInt(i);isNaN(r)||this.setItemWithIdItem(r)}),this.updateUrl()}initItemChooses(){return this.urlServices.itemsId$.pipe($(1),A(e=>e&&e.trim()!==""?e.split(","):[]),d(e=>e.forEach(t=>{let i=parseInt(t);isNaN(i)||this.setItemWithIdItem(i)})),A(()=>null))}calculTotal(e,t,i,r,n,a,m,h,u){let S=0,b=0,c=0;e.forEach(T=>{let _=this.itemService.calculResistancesForAnItem(T,n),w=this.itemService.calculMaitrisesForAnItem(T,t,i,r,a,m,h,u);b+=_,c+=w,S+=this.itemService.calculWeight(_,w,T.level)}),this.totalWeight.next(Math.trunc(S)),this.totalMaitrises.next(Math.trunc(c)),this.totalResistances.next(Math.trunc(b))}setItemWithIdItem(e){this.itemService.searchItem(e).pipe(D(),P(t=>t!==void 0)).subscribe(t=>{let i=this.itemTypeService.getItemType(t.itemTypeId);i&&this.setItem(i,t,!1)})}cleanItemChoosen(){this.indexAnneau=0,this.mapItem.forEach((e,t)=>{e.next(t===3?[void 0,void 0]:[void 0])})}setIdItemsFromBuild(e){this.cleanItemChoosen(),this.idItems.next(e);let t=e.split(",");t&&t.forEach(i=>{let r=this.itemService.getItem(parseInt(i));if(!r)return;let n=this.itemTypeService.getItemType(r.itemTypeId);n&&this.setItem(n,r,!1)})}setIdItems(e){this.idItems.next(e)}getObsItem(e){return this.mapItem.get(e)?.asObservable()??v()}deleteItem(e,t){this.getObsItem(e).pipe(D(),V(i=>ce(()=>i!==void 0&&!!i[0]?.itemTypeId&&this.itemTypeService.getItemType(i[0]?.itemTypeId)===1,v(i).pipe(d(()=>{this.mapItem.get(12)?.next([void 0]),this.mapItem.get(2)?.next([void 0])})),v(i).pipe(A(r=>(r[t]=void 0,r)),d(r=>this.mapItem.get(e)?.next(r)))))).subscribe()}setItem(e,t,i=!0){v(null).pipe(D(),V(()=>ce(()=>i,this.deleteItemInBuild(t).pipe(P(r=>!r)),v(null))),V(()=>this.ensureUniqueRelic(t)),V(()=>this.ensureCompatibleWithSecondHand(e,t)),V(()=>this.ensureCompatibleWithFirstHand(e,t)),V(()=>this.handleRings(e,t)),V(()=>this.handleDeuxMains(e,t)),V(()=>this.finalEquip(e,t))).subscribe()}ensureUniqueRelic(e){return[7,5].includes(e.rarity)?this.deleteFirstItemOnRarity(e.rarity):v(null)}ensureCompatibleWithSecondHand(e,t){return[13,12].includes(e)?this.getObsItem(2).pipe(D(),d(()=>this.mapItem.get(12)?.next([t])),A(i=>i[0]),P(i=>i!==void 0&&this.itemTypeService.getItemType(i.itemTypeId)===1),d(()=>this.mapItem.get(2)?.next([void 0])),A(()=>null)):v(null)}ensureCompatibleWithFirstHand(e,t){return e!==2?v(null):this.getObsItem(12).pipe(D(),d(()=>this.mapItem.get(2)?.next([t])),A(i=>i[0]),P(i=>i!==void 0&&this.itemTypeService.getItemType(i.itemTypeId)===1),d(()=>this.mapItem.get(12)?.next([void 0])),A(()=>null))}handleRings(e,t){return e!==3?v(null):this.getObsItem(3).pipe(D(),V(i=>i.find(r=>r?.title===t.title)?v(null):v(i).pipe(A(r=>{let n=[...r];return n[this.indexAnneau]=t,n}),d(r=>this.mapItem.get(3)?.next(r)),d(()=>this.indexAnneau=this.indexAnneau===0?1:0))),A(()=>null))}handleDeuxMains(e,t){return e!==1?v(null):v(null).pipe(d(()=>{this.mapItem.get(12)?.next([t]),this.mapItem.get(2)?.next([t])}))}finalEquip(e,t){return e===3?v(null):v(null).pipe(d(()=>this.mapItem.get(e)?.next([t])))}deleteFirstItemOnRarity(e){return L([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(D(),A(t=>t.filter(i=>i.find(r=>r?.rarity===e))),d(t=>t.forEach(i=>{let r=i.find(a=>a!==void 0)?.itemTypeId;if(!r)return;let n=this.itemTypeService.getItemType(r);if(n===1)this.mapItem.get(2)?.next([void 0]),this.mapItem.get(12)?.next([void 0]);else if(n===13)this.mapItem.get(12)?.next([void 0]);else if(n===3){let a=i.findIndex(m=>m?.rarity===e);this.indexAnneau=a,i[a]=void 0,this.mapItem.get(3)?.next(i)}else n!==void 0&&this.mapItem.get(n)?.next([void 0])})),A(()=>null))}deleteItemInBuild(e){let t=!1;return L([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(D(),A(i=>i.filter(r=>r.find(n=>n?.id===e.id))),d(i=>i.forEach(r=>{let n=r.find(m=>m!==void 0)?.itemTypeId;if(!n)return;t=!0;let a=this.itemTypeService.getItemType(n);if(a===1)this.mapItem.get(2)?.next([void 0]),this.mapItem.get(12)?.next([void 0]);else if(a===13)this.mapItem.get(12)?.next([void 0]);else if(a===3){let m=r.findIndex(h=>h?.id===e.id);r[m]=void 0,this.indexAnneau=m,this.mapItem.get(3)?.next(r)}else a!==void 0&&this.mapItem.get(a)?.next([void 0])})),A(()=>t))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};export{ee as a,Se as b,W as c,j as d,se as e,q as f,Q as g,Ue as h,k as i,H as j,K as k,ne as l,G as m,Y as n,Z as o,ae as p,oe as q,te as r,Rt as s,ht as t,de as u,ie as v,le as w,Ve as x,Ee as y,Fe as z};
