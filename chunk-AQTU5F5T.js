import{$d as j,C as Vt,E as Li,G as se,K as de,M as te,Md as yi,N as kt,O as g,Rd as Ui,S as A,Uc as gi,X as b,be as _,e as p,i as Ai,j as z,ke as ft,le as wi,me as x,n as v,na as vi,o as V,s as Ti,t as Dt,x as Z}from"./chunk-QGR4IWNQ.js";import{a as K,b as Ri}from"./chunk-25N2FLV6.js";function Mi(e){switch(e){case 1:return 1;case 2:return 3;case 3:return 4;case 4:return 6;case 5:return 7;case 6:return 10;case 7:return 15;case 8:return 19;case 9:return 24;case 10:return 30;case 11:return 33;default:return 0}}function Ni(e){switch(e){case 1:return 2;case 2:return 5;case 3:return 7;case 4:return 10;case 5:return 12;case 6:return 15;case 7:return 17;case 8:return 20;case 9:return 22;case 10:return 25;case 11:return 27;default:return 0}}var ls=[20,35,50,65,80,95,110,125,140,155,170,185,200,215,230,245],Ci=-5e4,Oi=-6e4,mn="no-build",G="https://raw.githubusercontent.com/Naquos/Gearfu-resources/main/",xi=[{maxLevel:36,ratio:ee(1/2)},{maxLevel:51,ratio:ee(3/5)},{maxLevel:66,ratio:ee(4/7)},{maxLevel:81,ratio:ee(6/10)},{maxLevel:96,ratio:ee(7/12)},{maxLevel:126,ratio:ee(10/15)},{maxLevel:141,ratio:ee(15/17)},{maxLevel:171,ratio:ee(19/20)},{maxLevel:186,ratio:ee(24/22)},{maxLevel:216,ratio:ee(30/25)}],Es=new Map([[31,0],[56,1],[41,2],[57,3],[193,4],[191,4],[192,5],[184,6],[160,7],[161,8],[20,9],[21,10],[173,11],[175,12],[172,13],[875,14],[174,15],[176,16],[876,17],[120,18],[1068,19],[122,19],[124,20],[123,21],[125,22],[149,23],[180,24],[26,25],[1055,26],[1053,27],[1052,28],[1056,29],[181,30],[1061,31],[1060,32],[1059,33],[150,34],[39,35],[168,36],[40,37],[988,38],[71,39],[80,40],[1069,41],[82,42],[83,43],[85,44],[84,45],[1062,46],[1063,47],[90,48],[97,49],[98,50],[96,51]]);function cs(e){let i=xi.findIndex(t=>e<t.maxLevel);return i===-1?11:i+1}function ee(e){return Math.trunc(e*100)/100}function _t(e,i,t){return Math.trunc(pn(t)*e+i)}function pn(e){return xi.find(t=>e<t.maxLevel)?.ratio??ee(33/27)}function Bt(e){return e.replace(/['''´’`]/g,"'").replace(/[ûù]/g,"u").replace(/[ô]/g,"o").replace(/\s+/g," ").normalize("NFKD").trim().toLowerCase()}function Pi(e){switch(e){case 1:return 1;case 2:return 3;case 3:return 7;case 4:return 15;case 5:return 31;case 6:return 63;case 7:return 127;case 8:return 319;case 9:return 895;case 10:return 3199;case 11:return 12415;default:return 0}}function ds(e){return e.match(/\/Gearfu\/(.*)/)?.[1].split("/")[0]??mn}function Ce(e){let i=e.length;for(;--i>=0;)e[i]=0}var hn=0,br=1,In=2,Sn=3,bn=258,ci=29,ot=256,Xe=ot+1+ci,we=30,di=19,Rr=2*Xe+1,Se=15,$t=16,Rn=7,fi=256,Ar=16,Tr=17,Lr=18,ti=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),St=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),An=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tn=512,Ee=new Array((Xe+2)*2);Ce(Ee);var Ge=new Array(we*2);Ce(Ge);var Je=new Array(Tn);Ce(Je);var et=new Array(bn-Sn+1);Ce(et);var _i=new Array(ci);Ce(_i);var bt=new Array(we);Ce(bt);function zt(e,i,t,r,n){this.static_tree=e,this.extra_bits=i,this.extra_base=t,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}var gr,yr,Ur;function Zt(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}var wr=e=>e<256?Je[e]:Je[256+(e>>>7)],tt=(e,i)=>{e.pending_buf[e.pending++]=i&255,e.pending_buf[e.pending++]=i>>>8&255},q=(e,i,t)=>{e.bi_valid>$t-t?(e.bi_buf|=i<<e.bi_valid&65535,tt(e,e.bi_buf),e.bi_buf=i>>$t-e.bi_valid,e.bi_valid+=t-$t):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=t)},re=(e,i,t)=>{q(e,t[i*2],t[i*2+1])},Mr=(e,i)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--i>0);return t>>>1},Ln=e=>{e.bi_valid===16?(tt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},vn=(e,i)=>{let t=i.dyn_tree,r=i.max_code,n=i.stat_desc.static_tree,a=i.stat_desc.has_stree,o=i.stat_desc.extra_bits,s=i.stat_desc.extra_base,f=i.stat_desc.max_length,l,E,h,c,d,u,y=0;for(c=0;c<=Se;c++)e.bl_count[c]=0;for(t[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<Rr;l++)E=e.heap[l],c=t[t[E*2+1]*2+1]+1,c>f&&(c=f,y++),t[E*2+1]=c,!(E>r)&&(e.bl_count[c]++,d=0,E>=s&&(d=o[E-s]),u=t[E*2],e.opt_len+=u*(c+d),a&&(e.static_len+=u*(n[E*2+1]+d)));if(y!==0){do{for(c=f-1;e.bl_count[c]===0;)c--;e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[f]--,y-=2}while(y>0);for(c=f;c!==0;c--)for(E=e.bl_count[c];E!==0;)h=e.heap[--l],!(h>r)&&(t[h*2+1]!==c&&(e.opt_len+=(c-t[h*2+1])*t[h*2],t[h*2+1]=c),E--)}},Nr=(e,i,t)=>{let r=new Array(Se+1),n=0,a,o;for(a=1;a<=Se;a++)n=n+t[a-1]<<1,r[a]=n;for(o=0;o<=i;o++){let s=e[o*2+1];s!==0&&(e[o*2]=Mr(r[s]++,s))}},gn=()=>{let e,i,t,r,n,a=new Array(Se+1);for(t=0,r=0;r<ci-1;r++)for(_i[r]=t,e=0;e<1<<ti[r];e++)et[t++]=r;for(et[t-1]=r,n=0,r=0;r<16;r++)for(bt[r]=n,e=0;e<1<<St[r];e++)Je[n++]=r;for(n>>=7;r<we;r++)for(bt[r]=n<<7,e=0;e<1<<St[r]-7;e++)Je[256+n++]=r;for(i=0;i<=Se;i++)a[i]=0;for(e=0;e<=143;)Ee[e*2+1]=8,e++,a[8]++;for(;e<=255;)Ee[e*2+1]=9,e++,a[9]++;for(;e<=279;)Ee[e*2+1]=7,e++,a[7]++;for(;e<=287;)Ee[e*2+1]=8,e++,a[8]++;for(Nr(Ee,Xe+1,a),e=0;e<we;e++)Ge[e*2+1]=5,Ge[e*2]=Mr(e,5);gr=new zt(Ee,ti,ot+1,Xe,Se),yr=new zt(Ge,St,0,we,Se),Ur=new zt(new Array(0),An,0,di,Rn)},Cr=e=>{let i;for(i=0;i<Xe;i++)e.dyn_ltree[i*2]=0;for(i=0;i<we;i++)e.dyn_dtree[i*2]=0;for(i=0;i<di;i++)e.bl_tree[i*2]=0;e.dyn_ltree[fi*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Or=e=>{e.bi_valid>8?tt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Fi=(e,i,t,r)=>{let n=i*2,a=t*2;return e[n]<e[a]||e[n]===e[a]&&r[i]<=r[t]},Qt=(e,i,t)=>{let r=e.heap[t],n=t<<1;for(;n<=e.heap_len&&(n<e.heap_len&&Fi(i,e.heap[n+1],e.heap[n],e.depth)&&n++,!Fi(i,r,e.heap[n],e.depth));)e.heap[t]=e.heap[n],t=n,n<<=1;e.heap[t]=r},Di=(e,i,t)=>{let r,n,a=0,o,s;if(e.sym_next!==0)do r=e.pending_buf[e.sym_buf+a++]&255,r+=(e.pending_buf[e.sym_buf+a++]&255)<<8,n=e.pending_buf[e.sym_buf+a++],r===0?re(e,n,i):(o=et[n],re(e,o+ot+1,i),s=ti[o],s!==0&&(n-=_i[o],q(e,n,s)),r--,o=wr(r),re(e,o,t),s=St[o],s!==0&&(r-=bt[o],q(e,r,s)));while(a<e.sym_next);re(e,fi,i)},ii=(e,i)=>{let t=i.dyn_tree,r=i.stat_desc.static_tree,n=i.stat_desc.has_stree,a=i.stat_desc.elems,o,s,f=-1,l;for(e.heap_len=0,e.heap_max=Rr,o=0;o<a;o++)t[o*2]!==0?(e.heap[++e.heap_len]=f=o,e.depth[o]=0):t[o*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=f<2?++f:0,t[l*2]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=r[l*2+1]);for(i.max_code=f,o=e.heap_len>>1;o>=1;o--)Qt(e,t,o);l=a;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Qt(e,t,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,t[l*2]=t[o*2]+t[s*2],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,t[o*2+1]=t[s*2+1]=l,e.heap[1]=l++,Qt(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],vn(e,i),Nr(t,f,e.bl_count)},Vi=(e,i,t)=>{let r,n=-1,a,o=i[1],s=0,f=7,l=4;for(o===0&&(f=138,l=3),i[(t+1)*2+1]=65535,r=0;r<=t;r++)a=o,o=i[(r+1)*2+1],!(++s<f&&a===o)&&(s<l?e.bl_tree[a*2]+=s:a!==0?(a!==n&&e.bl_tree[a*2]++,e.bl_tree[Ar*2]++):s<=10?e.bl_tree[Tr*2]++:e.bl_tree[Lr*2]++,s=0,n=a,o===0?(f=138,l=3):a===o?(f=6,l=3):(f=7,l=4))},ki=(e,i,t)=>{let r,n=-1,a,o=i[1],s=0,f=7,l=4;for(o===0&&(f=138,l=3),r=0;r<=t;r++)if(a=o,o=i[(r+1)*2+1],!(++s<f&&a===o)){if(s<l)do re(e,a,e.bl_tree);while(--s!==0);else a!==0?(a!==n&&(re(e,a,e.bl_tree),s--),re(e,Ar,e.bl_tree),q(e,s-3,2)):s<=10?(re(e,Tr,e.bl_tree),q(e,s-3,3)):(re(e,Lr,e.bl_tree),q(e,s-11,7));s=0,n=a,o===0?(f=138,l=3):a===o?(f=6,l=3):(f=7,l=4)}},yn=e=>{let i;for(Vi(e,e.dyn_ltree,e.l_desc.max_code),Vi(e,e.dyn_dtree,e.d_desc.max_code),ii(e,e.bl_desc),i=di-1;i>=3&&e.bl_tree[vr[i]*2+1]===0;i--);return e.opt_len+=3*(i+1)+5+5+4,i},Un=(e,i,t,r)=>{let n;for(q(e,i-257,5),q(e,t-1,5),q(e,r-4,4),n=0;n<r;n++)q(e,e.bl_tree[vr[n]*2+1],3);ki(e,e.dyn_ltree,i-1),ki(e,e.dyn_dtree,t-1)},wn=e=>{let i=4093624447,t;for(t=0;t<=31;t++,i>>>=1)if(i&1&&e.dyn_ltree[t*2]!==0)return 0;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return 1;for(t=32;t<ot;t++)if(e.dyn_ltree[t*2]!==0)return 1;return 0},Bi=!1,Mn=e=>{Bi||(gn(),Bi=!0),e.l_desc=new Zt(e.dyn_ltree,gr),e.d_desc=new Zt(e.dyn_dtree,yr),e.bl_desc=new Zt(e.bl_tree,Ur),e.bi_buf=0,e.bi_valid=0,Cr(e)},xr=(e,i,t,r)=>{q(e,(hn<<1)+(r?1:0),3),Or(e),tt(e,t),tt(e,~t),t&&e.pending_buf.set(e.window.subarray(i,i+t),e.pending),e.pending+=t},Nn=e=>{q(e,br<<1,3),re(e,fi,Ee),Ln(e)},Cn=(e,i,t,r)=>{let n,a,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=wn(e)),ii(e,e.l_desc),ii(e,e.d_desc),o=yn(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=n&&(n=a)):n=a=t+5,t+4<=n&&i!==-1?xr(e,i,t,r):e.strategy===4||a===n?(q(e,(br<<1)+(r?1:0),3),Di(e,Ee,Ge)):(q(e,(In<<1)+(r?1:0),3),Un(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Di(e,e.dyn_ltree,e.dyn_dtree)),Cr(e),r&&Or(e)},On=(e,i,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=i,e.pending_buf[e.sym_buf+e.sym_next++]=i>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,i===0?e.dyn_ltree[t*2]++:(e.matches++,i--,e.dyn_ltree[(et[t]+ot+1)*2]++,e.dyn_dtree[wr(i)*2]++),e.sym_next===e.sym_end),xn=Mn,Pn=xr,Fn=Cn,Dn=On,Vn=Nn,kn={_tr_init:xn,_tr_stored_block:Pn,_tr_flush_block:Fn,_tr_tally:Dn,_tr_align:Vn},Bn=(e,i,t,r)=>{let n=e&65535|0,a=e>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do n=n+i[r++]|0,a=a+n|0;while(--o);n%=65521,a%=65521}return n|a<<16|0},it=Bn,$n=()=>{let e,i=[];for(var t=0;t<256;t++){e=t;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;i[t]=e}return i},zn=new Uint32Array($n()),Zn=(e,i,t,r)=>{let n=zn,a=r+t;e^=-1;for(let o=r;o<a;o++)e=e>>>8^n[(e^i[o])&255];return e^-1},B=Zn,Ae={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Oe={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Qn,_tr_stored_block:ri,_tr_flush_block:Hn,_tr_tally:ue,_tr_align:jn}=kn,{Z_NO_FLUSH:me,Z_PARTIAL_FLUSH:qn,Z_FULL_FLUSH:Kn,Z_FINISH:X,Z_BLOCK:$i,Z_OK:$,Z_STREAM_END:zi,Z_STREAM_ERROR:ne,Z_DATA_ERROR:Gn,Z_BUF_ERROR:Ht,Z_DEFAULT_COMPRESSION:Wn,Z_FILTERED:Yn,Z_HUFFMAN_ONLY:ut,Z_RLE:Xn,Z_FIXED:Jn,Z_DEFAULT_STRATEGY:ea,Z_UNKNOWN:ta,Z_DEFLATED:Tt}=Oe,ia=9,ra=15,na=8,aa=29,oa=256,ni=oa+1+aa,sa=30,la=19,Ea=2*ni+1,ca=15,w=3,_e=258,ae=_e+w+1,da=32,Me=42,ui=57,ai=69,oi=73,si=91,li=103,be=113,qe=666,Q=1,xe=2,Te=3,Pe=4,fa=3,Re=(e,i)=>(e.msg=Ae[i],i),Zi=e=>e*2-(e>4?9:0),fe=e=>{let i=e.length;for(;--i>=0;)e[i]=0},_a=e=>{let i,t,r,n=e.w_size;i=e.hash_size,r=i;do t=e.head[--r],e.head[r]=t>=n?t-n:0;while(--i);i=n,r=i;do t=e.prev[--r],e.prev[r]=t>=n?t-n:0;while(--i)},ua=(e,i,t)=>(i<<e.hash_shift^t)&e.hash_mask,pe=ua,W=e=>{let i=e.state,t=i.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),e.next_out),e.next_out+=t,i.pending_out+=t,e.total_out+=t,e.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},Y=(e,i)=>{Hn(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,i),e.block_start=e.strstart,W(e.strm)},O=(e,i)=>{e.pending_buf[e.pending++]=i},je=(e,i)=>{e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=i&255},Ei=(e,i,t,r)=>{let n=e.avail_in;return n>r&&(n=r),n===0?0:(e.avail_in-=n,i.set(e.input.subarray(e.next_in,e.next_in+n),t),e.state.wrap===1?e.adler=it(e.adler,i,n,t):e.state.wrap===2&&(e.adler=B(e.adler,i,n,t)),e.next_in+=n,e.total_in+=n,n)},Pr=(e,i)=>{let t=e.max_chain_length,r=e.strstart,n,a,o=e.prev_length,s=e.nice_match,f=e.strstart>e.w_size-ae?e.strstart-(e.w_size-ae):0,l=e.window,E=e.w_mask,h=e.prev,c=e.strstart+_e,d=l[r+o-1],u=l[r+o];e.prev_length>=e.good_match&&(t>>=2),s>e.lookahead&&(s=e.lookahead);do if(n=i,!(l[n+o]!==u||l[n+o-1]!==d||l[n]!==l[r]||l[++n]!==l[r+1])){r+=2,n++;do;while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<c);if(a=_e-(c-r),r=c-_e,a>o){if(e.match_start=i,o=a,a>=s)break;d=l[r+o-1],u=l[r+o]}}while((i=h[i&E])>f&&--t!==0);return o<=e.lookahead?o:e.lookahead},Ne=e=>{let i=e.w_size,t,r,n;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-ae)&&(e.window.set(e.window.subarray(i,i+i-r),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),_a(e),r+=i),e.strm.avail_in===0)break;if(t=Ei(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=t,e.lookahead+e.insert>=w)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=pe(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=pe(e,e.ins_h,e.window[n+w-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<w)););}while(e.lookahead<ae&&e.strm.avail_in!==0)},Fr=(e,i)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r,n,a,o=0,s=e.strm.avail_in;do{if(r=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>a&&(r=a),r<t&&(r===0&&i!==X||i===me||r!==n+e.strm.avail_in)))break;o=i===X&&r===n+e.strm.avail_in?1:0,ri(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,W(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(Ei(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(o===0);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?Pe:i!==me&&i!==X&&e.strm.avail_in===0&&e.strstart===e.block_start?xe:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(Ei(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,t=a>e.w_size?e.w_size:a,n=e.strstart-e.block_start,(n>=t||(n||i===X)&&i!==me&&e.strm.avail_in===0&&n<=a)&&(r=n>a?a:n,o=i===X&&e.strm.avail_in===0&&r===n?1:0,ri(e,e.block_start,r,o),e.block_start+=r,W(e.strm)),o?Te:Q)},jt=(e,i)=>{let t,r;for(;;){if(e.lookahead<ae){if(Ne(e),e.lookahead<ae&&i===me)return Q;if(e.lookahead===0)break}if(t=0,e.lookahead>=w&&(e.ins_h=pe(e,e.ins_h,e.window[e.strstart+w-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-ae&&(e.match_length=Pr(e,t)),e.match_length>=w)if(r=ue(e,e.strstart-e.match_start,e.match_length-w),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=w){e.match_length--;do e.strstart++,e.ins_h=pe(e,e.ins_h,e.window[e.strstart+w-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=pe(e,e.ins_h,e.window[e.strstart+1]);else r=ue(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Y(e,!1),e.strm.avail_out===0))return Q}return e.insert=e.strstart<w-1?e.strstart:w-1,i===X?(Y(e,!0),e.strm.avail_out===0?Te:Pe):e.sym_next&&(Y(e,!1),e.strm.avail_out===0)?Q:xe},ye=(e,i)=>{let t,r,n;for(;;){if(e.lookahead<ae){if(Ne(e),e.lookahead<ae&&i===me)return Q;if(e.lookahead===0)break}if(t=0,e.lookahead>=w&&(e.ins_h=pe(e,e.ins_h,e.window[e.strstart+w-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=w-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-ae&&(e.match_length=Pr(e,t),e.match_length<=5&&(e.strategy===Yn||e.match_length===w&&e.strstart-e.match_start>4096)&&(e.match_length=w-1)),e.prev_length>=w&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-w,r=ue(e,e.strstart-1-e.prev_match,e.prev_length-w),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=pe(e,e.ins_h,e.window[e.strstart+w-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=w-1,e.strstart++,r&&(Y(e,!1),e.strm.avail_out===0))return Q}else if(e.match_available){if(r=ue(e,0,e.window[e.strstart-1]),r&&Y(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Q}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=ue(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<w-1?e.strstart:w-1,i===X?(Y(e,!0),e.strm.avail_out===0?Te:Pe):e.sym_next&&(Y(e,!1),e.strm.avail_out===0)?Q:xe},ma=(e,i)=>{let t,r,n,a,o=e.window;for(;;){if(e.lookahead<=_e){if(Ne(e),e.lookahead<=_e&&i===me)return Q;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=w&&e.strstart>0&&(n=e.strstart-1,r=o[n],r===o[++n]&&r===o[++n]&&r===o[++n])){a=e.strstart+_e;do;while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a);e.match_length=_e-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=w?(t=ue(e,1,e.match_length-w),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=ue(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(Y(e,!1),e.strm.avail_out===0))return Q}return e.insert=0,i===X?(Y(e,!0),e.strm.avail_out===0?Te:Pe):e.sym_next&&(Y(e,!1),e.strm.avail_out===0)?Q:xe},pa=(e,i)=>{let t;for(;;){if(e.lookahead===0&&(Ne(e),e.lookahead===0)){if(i===me)return Q;break}if(e.match_length=0,t=ue(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(Y(e,!1),e.strm.avail_out===0))return Q}return e.insert=0,i===X?(Y(e,!0),e.strm.avail_out===0?Te:Pe):e.sym_next&&(Y(e,!1),e.strm.avail_out===0)?Q:xe};function ie(e,i,t,r,n){this.good_length=e,this.max_lazy=i,this.nice_length=t,this.max_chain=r,this.func=n}var Ke=[new ie(0,0,0,0,Fr),new ie(4,4,8,4,jt),new ie(4,5,16,8,jt),new ie(4,6,32,32,jt),new ie(4,4,16,16,ye),new ie(8,16,32,32,ye),new ie(8,16,128,128,ye),new ie(8,32,128,256,ye),new ie(32,128,258,1024,ye),new ie(32,258,258,4096,ye)],ha=e=>{e.window_size=2*e.w_size,fe(e.head),e.max_lazy_match=Ke[e.level].max_lazy,e.good_match=Ke[e.level].good_length,e.nice_match=Ke[e.level].nice_length,e.max_chain_length=Ke[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=w-1,e.match_available=0,e.ins_h=0};function Ia(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Tt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Ea*2),this.dyn_dtree=new Uint16Array((2*sa+1)*2),this.bl_tree=new Uint16Array((2*la+1)*2),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ca+1),this.heap=new Uint16Array(2*ni+1),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ni+1),fe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var st=e=>{if(!e)return 1;let i=e.state;return!i||i.strm!==e||i.status!==Me&&i.status!==ui&&i.status!==ai&&i.status!==oi&&i.status!==si&&i.status!==li&&i.status!==be&&i.status!==qe?1:0},Dr=e=>{if(st(e))return Re(e,ne);e.total_in=e.total_out=0,e.data_type=ta;let i=e.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?ui:i.wrap?Me:be,e.adler=i.wrap===2?0:1,i.last_flush=-2,Qn(i),$},Vr=e=>{let i=Dr(e);return i===$&&ha(e.state),i},Sa=(e,i)=>st(e)||e.state.wrap!==2?ne:(e.state.gzhead=i,$),kr=(e,i,t,r,n,a)=>{if(!e)return ne;let o=1;if(i===Wn&&(i=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),n<1||n>ia||t!==Tt||r<8||r>15||i<0||i>9||a<0||a>Jn||r===8&&o!==1)return Re(e,ne);r===8&&(r=9);let s=new Ia;return e.state=s,s.strm=e,s.status=Me,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+w-1)/w),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=i,s.strategy=a,s.method=t,Vr(e)},ba=(e,i)=>kr(e,i,Tt,ra,na,ea),Ra=(e,i)=>{if(st(e)||i>$i||i<0)return e?Re(e,ne):ne;let t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===qe&&i!==X)return Re(e,e.avail_out===0?Ht:ne);let r=t.last_flush;if(t.last_flush=i,t.pending!==0){if(W(e),e.avail_out===0)return t.last_flush=-1,$}else if(e.avail_in===0&&Zi(i)<=Zi(r)&&i!==X)return Re(e,Ht);if(t.status===qe&&e.avail_in!==0)return Re(e,Ht);if(t.status===Me&&t.wrap===0&&(t.status=be),t.status===Me){let n=Tt+(t.w_bits-8<<4)<<8,a=-1;if(t.strategy>=ut||t.level<2?a=0:t.level<6?a=1:t.level===6?a=2:a=3,n|=a<<6,t.strstart!==0&&(n|=da),n+=31-n%31,je(t,n),t.strstart!==0&&(je(t,e.adler>>>16),je(t,e.adler&65535)),e.adler=1,t.status=be,W(e),t.pending!==0)return t.last_flush=-1,$}if(t.status===ui){if(e.adler=0,O(t,31),O(t,139),O(t,8),t.gzhead)O(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),O(t,t.gzhead.time&255),O(t,t.gzhead.time>>8&255),O(t,t.gzhead.time>>16&255),O(t,t.gzhead.time>>24&255),O(t,t.level===9?2:t.strategy>=ut||t.level<2?4:0),O(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(O(t,t.gzhead.extra.length&255),O(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=B(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=ai;else if(O(t,0),O(t,0),O(t,0),O(t,0),O(t,0),O(t,t.level===9?2:t.strategy>=ut||t.level<2?4:0),O(t,fa),t.status=be,W(e),t.pending!==0)return t.last_flush=-1,$}if(t.status===ai){if(t.gzhead.extra){let n=t.pending,a=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+a>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex+=s,W(e),t.pending!==0)return t.last_flush=-1,$;n=0,a-=s}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending+=a,t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=oi}if(t.status===oi){if(t.gzhead.name){let n=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n)),W(e),t.pending!==0)return t.last_flush=-1,$;n=0}t.gzindex<t.gzhead.name.length?a=t.gzhead.name.charCodeAt(t.gzindex++)&255:a=0,O(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=si}if(t.status===si){if(t.gzhead.comment){let n=t.pending,a;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n)),W(e),t.pending!==0)return t.last_flush=-1,$;n=0}t.gzindex<t.gzhead.comment.length?a=t.gzhead.comment.charCodeAt(t.gzindex++)&255:a=0,O(t,a)}while(a!==0);t.gzhead.hcrc&&t.pending>n&&(e.adler=B(e.adler,t.pending_buf,t.pending-n,n))}t.status=li}if(t.status===li){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(W(e),t.pending!==0))return t.last_flush=-1,$;O(t,e.adler&255),O(t,e.adler>>8&255),e.adler=0}if(t.status=be,W(e),t.pending!==0)return t.last_flush=-1,$}if(e.avail_in!==0||t.lookahead!==0||i!==me&&t.status!==qe){let n=t.level===0?Fr(t,i):t.strategy===ut?pa(t,i):t.strategy===Xn?ma(t,i):Ke[t.level].func(t,i);if((n===Te||n===Pe)&&(t.status=qe),n===Q||n===Te)return e.avail_out===0&&(t.last_flush=-1),$;if(n===xe&&(i===qn?jn(t):i!==$i&&(ri(t,0,0,!1),i===Kn&&(fe(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),W(e),e.avail_out===0))return t.last_flush=-1,$}return i!==X?$:t.wrap<=0?zi:(t.wrap===2?(O(t,e.adler&255),O(t,e.adler>>8&255),O(t,e.adler>>16&255),O(t,e.adler>>24&255),O(t,e.total_in&255),O(t,e.total_in>>8&255),O(t,e.total_in>>16&255),O(t,e.total_in>>24&255)):(je(t,e.adler>>>16),je(t,e.adler&65535)),W(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?$:zi)},Aa=e=>{if(st(e))return ne;let i=e.state.status;return e.state=null,i===be?Re(e,Gn):$},Ta=(e,i)=>{let t=i.length;if(st(e))return ne;let r=e.state,n=r.wrap;if(n===2||n===1&&r.status!==Me||r.lookahead)return ne;if(n===1&&(e.adler=it(e.adler,i,t,0)),r.wrap=0,t>=r.w_size){n===0&&(fe(r.head),r.strstart=0,r.block_start=0,r.insert=0);let f=new Uint8Array(r.w_size);f.set(i.subarray(t-r.w_size,t),0),i=f,t=r.w_size}let a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=t,e.next_in=0,e.input=i,Ne(r);r.lookahead>=w;){let f=r.strstart,l=r.lookahead-(w-1);do r.ins_h=pe(r,r.ins_h,r.window[f+w-1]),r.prev[f&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=f,f++;while(--l);r.strstart=f,r.lookahead=w-1,Ne(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=w-1,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=n,$},La=ba,va=kr,ga=Vr,ya=Dr,Ua=Sa,wa=Ra,Ma=Aa,Na=Ta,Ca="pako deflate (from Nodeca project)",We={deflateInit:La,deflateInit2:va,deflateReset:ga,deflateResetKeep:ya,deflateSetHeader:Ua,deflate:wa,deflateEnd:Ma,deflateSetDictionary:Na,deflateInfo:Ca},Oa=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),xa=function(e){let i=Array.prototype.slice.call(arguments,1);for(;i.length;){let t=i.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let r in t)Oa(t,r)&&(e[r]=t[r])}}return e},Pa=e=>{let i=0;for(let r=0,n=e.length;r<n;r++)i+=e[r].length;let t=new Uint8Array(i);for(let r=0,n=0,a=e.length;r<a;r++){let o=e[r];t.set(o,n),n+=o.length}return t},Lt={assign:xa,flattenChunks:Pa},Br=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Br=!1}var rt=new Uint8Array(256);for(let e=0;e<256;e++)rt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;rt[254]=rt[254]=1;var Fa=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let i,t,r,n,a,o=e.length,s=0;for(n=0;n<o;n++)t=e.charCodeAt(n),(t&64512)===55296&&n+1<o&&(r=e.charCodeAt(n+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),n++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(i=new Uint8Array(s),a=0,n=0;a<s;n++)t=e.charCodeAt(n),(t&64512)===55296&&n+1<o&&(r=e.charCodeAt(n+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),n++)),t<128?i[a++]=t:t<2048?(i[a++]=192|t>>>6,i[a++]=128|t&63):t<65536?(i[a++]=224|t>>>12,i[a++]=128|t>>>6&63,i[a++]=128|t&63):(i[a++]=240|t>>>18,i[a++]=128|t>>>12&63,i[a++]=128|t>>>6&63,i[a++]=128|t&63);return i},Da=(e,i)=>{if(i<65534&&e.subarray&&Br)return String.fromCharCode.apply(null,e.length===i?e:e.subarray(0,i));let t="";for(let r=0;r<i;r++)t+=String.fromCharCode(e[r]);return t},Va=(e,i)=>{let t=i||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,i));let r,n,a=new Array(t*2);for(n=0,r=0;r<t;){let o=e[r++];if(o<128){a[n++]=o;continue}let s=rt[o];if(s>4){a[n++]=65533,r+=s-1;continue}for(o&=s===2?31:s===3?15:7;s>1&&r<t;)o=o<<6|e[r++]&63,s--;if(s>1){a[n++]=65533;continue}o<65536?a[n++]=o:(o-=65536,a[n++]=55296|o>>10&1023,a[n++]=56320|o&1023)}return Da(a,n)},ka=(e,i)=>{i=i||e.length,i>e.length&&(i=e.length);let t=i-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?i:t+rt[e[t]]>i?t:i},nt={string2buf:Fa,buf2string:Va,utf8border:ka};function Ba(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var $r=Ba,zr=Object.prototype.toString,{Z_NO_FLUSH:$a,Z_SYNC_FLUSH:za,Z_FULL_FLUSH:Za,Z_FINISH:Qa,Z_OK:Rt,Z_STREAM_END:Ha,Z_DEFAULT_COMPRESSION:ja,Z_DEFAULT_STRATEGY:qa,Z_DEFLATED:Ka}=Oe;function lt(e){this.options=Lt.assign({level:ja,method:Ka,chunkSize:16384,windowBits:15,memLevel:8,strategy:qa},e||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $r,this.strm.avail_out=0;let t=We.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(t!==Rt)throw new Error(Ae[t]);if(i.header&&We.deflateSetHeader(this.strm,i.header),i.dictionary){let r;if(typeof i.dictionary=="string"?r=nt.string2buf(i.dictionary):zr.call(i.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(i.dictionary):r=i.dictionary,t=We.deflateSetDictionary(this.strm,r),t!==Rt)throw new Error(Ae[t]);this._dict_set=!0}}lt.prototype.push=function(e,i){let t=this.strm,r=this.options.chunkSize,n,a;if(this.ended)return!1;for(i===~~i?a=i:a=i===!0?Qa:$a,typeof e=="string"?t.input=nt.string2buf(e):zr.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),(a===za||a===Za)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(n=We.deflate(t,a),n===Ha)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),n=We.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Rt;if(t.avail_out===0){this.onData(t.output);continue}if(a>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};lt.prototype.onData=function(e){this.chunks.push(e)};lt.prototype.onEnd=function(e){e===Rt&&(this.result=Lt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function mi(e,i){let t=new lt(i);if(t.push(e,!0),t.err)throw t.msg||Ae[t.err];return t.result}function Ga(e,i){return i=i||{},i.raw=!0,mi(e,i)}function Wa(e,i){return i=i||{},i.gzip=!0,mi(e,i)}var Ya=lt,Xa=mi,Ja=Ga,eo=Wa,to=Oe,io={Deflate:Ya,deflate:Xa,deflateRaw:Ja,gzip:eo,constants:to},mt=16209,ro=16191,no=function(i,t){let r,n,a,o,s,f,l,E,h,c,d,u,y,S,L,N,m,I,C,k,R,P,M,T,U=i.state;r=i.next_in,M=i.input,n=r+(i.avail_in-5),a=i.next_out,T=i.output,o=a-(t-i.avail_out),s=a+(i.avail_out-257),f=U.dmax,l=U.wsize,E=U.whave,h=U.wnext,c=U.window,d=U.hold,u=U.bits,y=U.lencode,S=U.distcode,L=(1<<U.lenbits)-1,N=(1<<U.distbits)-1;e:do{u<15&&(d+=M[r++]<<u,u+=8,d+=M[r++]<<u,u+=8),m=y[d&L];t:for(;;){if(I=m>>>24,d>>>=I,u-=I,I=m>>>16&255,I===0)T[a++]=m&65535;else if(I&16){C=m&65535,I&=15,I&&(u<I&&(d+=M[r++]<<u,u+=8),C+=d&(1<<I)-1,d>>>=I,u-=I),u<15&&(d+=M[r++]<<u,u+=8,d+=M[r++]<<u,u+=8),m=S[d&N];i:for(;;){if(I=m>>>24,d>>>=I,u-=I,I=m>>>16&255,I&16){if(k=m&65535,I&=15,u<I&&(d+=M[r++]<<u,u+=8,u<I&&(d+=M[r++]<<u,u+=8)),k+=d&(1<<I)-1,k>f){i.msg="invalid distance too far back",U.mode=mt;break e}if(d>>>=I,u-=I,I=a-o,k>I){if(I=k-I,I>E&&U.sane){i.msg="invalid distance too far back",U.mode=mt;break e}if(R=0,P=c,h===0){if(R+=l-I,I<C){C-=I;do T[a++]=c[R++];while(--I);R=a-k,P=T}}else if(h<I){if(R+=l+h-I,I-=h,I<C){C-=I;do T[a++]=c[R++];while(--I);if(R=0,h<C){I=h,C-=I;do T[a++]=c[R++];while(--I);R=a-k,P=T}}}else if(R+=h-I,I<C){C-=I;do T[a++]=c[R++];while(--I);R=a-k,P=T}for(;C>2;)T[a++]=P[R++],T[a++]=P[R++],T[a++]=P[R++],C-=3;C&&(T[a++]=P[R++],C>1&&(T[a++]=P[R++]))}else{R=a-k;do T[a++]=T[R++],T[a++]=T[R++],T[a++]=T[R++],C-=3;while(C>2);C&&(T[a++]=T[R++],C>1&&(T[a++]=T[R++]))}}else if((I&64)===0){m=S[(m&65535)+(d&(1<<I)-1)];continue i}else{i.msg="invalid distance code",U.mode=mt;break e}break}}else if((I&64)===0){m=y[(m&65535)+(d&(1<<I)-1)];continue t}else if(I&32){U.mode=ro;break e}else{i.msg="invalid literal/length code",U.mode=mt;break e}break}}while(r<n&&a<s);C=u>>3,r-=C,u-=C<<3,d&=(1<<u)-1,i.next_in=r,i.next_out=a,i.avail_in=r<n?5+(n-r):5-(r-n),i.avail_out=a<s?257+(s-a):257-(a-s),U.hold=d,U.bits=u},Ue=15,Qi=852,Hi=592,ji=0,qt=1,qi=2,ao=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),oo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),so=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Eo=(e,i,t,r,n,a,o,s)=>{let f=s.bits,l=0,E=0,h=0,c=0,d=0,u=0,y=0,S=0,L=0,N=0,m,I,C,k,R,P=null,M,T=new Uint16Array(Ue+1),U=new Uint16Array(Ue+1),Ie=null,bi,ct,dt;for(l=0;l<=Ue;l++)T[l]=0;for(E=0;E<r;E++)T[i[t+E]]++;for(d=f,c=Ue;c>=1&&T[c]===0;c--);if(d>c&&(d=c),c===0)return n[a++]=1<<24|64<<16|0,n[a++]=1<<24|64<<16|0,s.bits=1,0;for(h=1;h<c&&T[h]===0;h++);for(d<h&&(d=h),S=1,l=1;l<=Ue;l++)if(S<<=1,S-=T[l],S<0)return-1;if(S>0&&(e===ji||c!==1))return-1;for(U[1]=0,l=1;l<Ue;l++)U[l+1]=U[l]+T[l];for(E=0;E<r;E++)i[t+E]!==0&&(o[U[i[t+E]]++]=E);if(e===ji?(P=Ie=o,M=20):e===qt?(P=ao,Ie=oo,M=257):(P=so,Ie=lo,M=0),N=0,E=0,l=h,R=a,u=d,y=0,C=-1,L=1<<d,k=L-1,e===qt&&L>Qi||e===qi&&L>Hi)return 1;for(;;){bi=l-y,o[E]+1<M?(ct=0,dt=o[E]):o[E]>=M?(ct=Ie[o[E]-M],dt=P[o[E]-M]):(ct=96,dt=0),m=1<<l-y,I=1<<u,h=I;do I-=m,n[R+(N>>y)+I]=bi<<24|ct<<16|dt|0;while(I!==0);for(m=1<<l-1;N&m;)m>>=1;if(m!==0?(N&=m-1,N+=m):N=0,E++,--T[l]===0){if(l===c)break;l=i[t+o[E]]}if(l>d&&(N&k)!==C){for(y===0&&(y=d),R+=h,u=l-y,S=1<<u;u+y<c&&(S-=T[u+y],!(S<=0));)u++,S<<=1;if(L+=1<<u,e===qt&&L>Qi||e===qi&&L>Hi)return 1;C=N&k,n[C]=d<<24|u<<16|R-a|0}}return N!==0&&(n[R+N]=l-y<<24|64<<16|0),s.bits=d,0},Ye=Eo,co=0,Zr=1,Qr=2,{Z_FINISH:Ki,Z_BLOCK:fo,Z_TREES:pt,Z_OK:Le,Z_STREAM_END:_o,Z_NEED_DICT:uo,Z_STREAM_ERROR:J,Z_DATA_ERROR:Hr,Z_MEM_ERROR:jr,Z_BUF_ERROR:mo,Z_DEFLATED:Gi}=Oe,vt=16180,Wi=16181,Yi=16182,Xi=16183,Ji=16184,er=16185,tr=16186,ir=16187,rr=16188,nr=16189,At=16190,le=16191,Kt=16192,ar=16193,Gt=16194,or=16195,sr=16196,lr=16197,Er=16198,ht=16199,It=16200,cr=16201,dr=16202,fr=16203,_r=16204,ur=16205,Wt=16206,mr=16207,pr=16208,F=16209,qr=16210,Kr=16211,po=852,ho=592,Io=15,So=Io,hr=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function bo(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var ve=e=>{if(!e)return 1;let i=e.state;return!i||i.strm!==e||i.mode<vt||i.mode>Kr?1:0},Gr=e=>{if(ve(e))return J;let i=e.state;return e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=i.wrap&1),i.mode=vt,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(po),i.distcode=i.distdyn=new Int32Array(ho),i.sane=1,i.back=-1,Le},Wr=e=>{if(ve(e))return J;let i=e.state;return i.wsize=0,i.whave=0,i.wnext=0,Gr(e)},Yr=(e,i)=>{let t;if(ve(e))return J;let r=e.state;return i<0?(t=0,i=-i):(t=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?J:(r.window!==null&&r.wbits!==i&&(r.window=null),r.wrap=t,r.wbits=i,Wr(e))},Xr=(e,i)=>{if(!e)return J;let t=new bo;e.state=t,t.strm=e,t.window=null,t.mode=vt;let r=Yr(e,i);return r!==Le&&(e.state=null),r},Ro=e=>Xr(e,So),Ir=!0,Yt,Xt,Ao=e=>{if(Ir){Yt=new Int32Array(512),Xt=new Int32Array(32);let i=0;for(;i<144;)e.lens[i++]=8;for(;i<256;)e.lens[i++]=9;for(;i<280;)e.lens[i++]=7;for(;i<288;)e.lens[i++]=8;for(Ye(Zr,e.lens,0,288,Yt,0,e.work,{bits:9}),i=0;i<32;)e.lens[i++]=5;Ye(Qr,e.lens,0,32,Xt,0,e.work,{bits:5}),Ir=!1}e.lencode=Yt,e.lenbits=9,e.distcode=Xt,e.distbits=5},Jr=(e,i,t,r)=>{let n,a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(i.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>r&&(n=r),a.window.set(i.subarray(t-r,t-r+n),a.wnext),r-=n,r?(a.window.set(i.subarray(t-r,t),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0},To=(e,i)=>{let t,r,n,a,o,s,f,l,E,h,c,d,u,y,S=0,L,N,m,I,C,k,R,P,M=new Uint8Array(4),T,U,Ie=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ve(e)||!e.output||!e.input&&e.avail_in!==0)return J;t=e.state,t.mode===le&&(t.mode=Kt),o=e.next_out,n=e.output,f=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=t.hold,E=t.bits,h=s,c=f,P=Le;e:for(;;)switch(t.mode){case vt:if(t.wrap===0){t.mode=Kt;break}for(;E<16;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(t.wrap&2&&l===35615){t.wbits===0&&(t.wbits=15),t.check=0,M[0]=l&255,M[1]=l>>>8&255,t.check=B(t.check,M,2,0),l=0,E=0,t.mode=Wi;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",t.mode=F;break}if((l&15)!==Gi){e.msg="unknown compression method",t.mode=F;break}if(l>>>=4,E-=4,R=(l&15)+8,t.wbits===0&&(t.wbits=R),R>15||R>t.wbits){e.msg="invalid window size",t.mode=F;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=l&512?nr:le,l=0,E=0;break;case Wi:for(;E<16;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(t.flags=l,(t.flags&255)!==Gi){e.msg="unknown compression method",t.mode=F;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=F;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&t.wrap&4&&(M[0]=l&255,M[1]=l>>>8&255,t.check=B(t.check,M,2,0)),l=0,E=0,t.mode=Yi;case Yi:for(;E<32;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.head&&(t.head.time=l),t.flags&512&&t.wrap&4&&(M[0]=l&255,M[1]=l>>>8&255,M[2]=l>>>16&255,M[3]=l>>>24&255,t.check=B(t.check,M,4,0)),l=0,E=0,t.mode=Xi;case Xi:for(;E<16;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&t.wrap&4&&(M[0]=l&255,M[1]=l>>>8&255,t.check=B(t.check,M,2,0)),l=0,E=0,t.mode=Ji;case Ji:if(t.flags&1024){for(;E<16;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&t.wrap&4&&(M[0]=l&255,M[1]=l>>>8&255,t.check=B(t.check,M,2,0)),l=0,E=0}else t.head&&(t.head.extra=null);t.mode=er;case er:if(t.flags&1024&&(d=t.length,d>s&&(d=s),d&&(t.head&&(R=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(r.subarray(a,a+d),R)),t.flags&512&&t.wrap&4&&(t.check=B(t.check,r,d,a)),s-=d,a+=d,t.length-=d),t.length))break e;t.length=0,t.mode=tr;case tr:if(t.flags&2048){if(s===0)break e;d=0;do R=r[a+d++],t.head&&R&&t.length<65536&&(t.head.name+=String.fromCharCode(R));while(R&&d<s);if(t.flags&512&&t.wrap&4&&(t.check=B(t.check,r,d,a)),s-=d,a+=d,R)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=ir;case ir:if(t.flags&4096){if(s===0)break e;d=0;do R=r[a+d++],t.head&&R&&t.length<65536&&(t.head.comment+=String.fromCharCode(R));while(R&&d<s);if(t.flags&512&&t.wrap&4&&(t.check=B(t.check,r,d,a)),s-=d,a+=d,R)break e}else t.head&&(t.head.comment=null);t.mode=rr;case rr:if(t.flags&512){for(;E<16;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(t.wrap&4&&l!==(t.check&65535)){e.msg="header crc mismatch",t.mode=F;break}l=0,E=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=le;break;case nr:for(;E<32;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}e.adler=t.check=hr(l),l=0,E=0,t.mode=At;case At:if(t.havedict===0)return e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,t.hold=l,t.bits=E,uo;e.adler=t.check=1,t.mode=le;case le:if(i===fo||i===pt)break e;case Kt:if(t.last){l>>>=E&7,E-=E&7,t.mode=Wt;break}for(;E<3;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}switch(t.last=l&1,l>>>=1,E-=1,l&3){case 0:t.mode=ar;break;case 1:if(Ao(t),t.mode=ht,i===pt){l>>>=2,E-=2;break e}break;case 2:t.mode=sr;break;case 3:e.msg="invalid block type",t.mode=F}l>>>=2,E-=2;break;case ar:for(l>>>=E&7,E-=E&7;E<32;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",t.mode=F;break}if(t.length=l&65535,l=0,E=0,t.mode=Gt,i===pt)break e;case Gt:t.mode=or;case or:if(d=t.length,d){if(d>s&&(d=s),d>f&&(d=f),d===0)break e;n.set(r.subarray(a,a+d),o),s-=d,a+=d,f-=d,o+=d,t.length-=d;break}t.mode=le;break;case sr:for(;E<14;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(t.nlen=(l&31)+257,l>>>=5,E-=5,t.ndist=(l&31)+1,l>>>=5,E-=5,t.ncode=(l&15)+4,l>>>=4,E-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=F;break}t.have=0,t.mode=lr;case lr:for(;t.have<t.ncode;){for(;E<3;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.lens[Ie[t.have++]]=l&7,l>>>=3,E-=3}for(;t.have<19;)t.lens[Ie[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,T={bits:t.lenbits},P=Ye(co,t.lens,0,19,t.lencode,0,t.work,T),t.lenbits=T.bits,P){e.msg="invalid code lengths set",t.mode=F;break}t.have=0,t.mode=Er;case Er:for(;t.have<t.nlen+t.ndist;){for(;S=t.lencode[l&(1<<t.lenbits)-1],L=S>>>24,N=S>>>16&255,m=S&65535,!(L<=E);){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(m<16)l>>>=L,E-=L,t.lens[t.have++]=m;else{if(m===16){for(U=L+2;E<U;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(l>>>=L,E-=L,t.have===0){e.msg="invalid bit length repeat",t.mode=F;break}R=t.lens[t.have-1],d=3+(l&3),l>>>=2,E-=2}else if(m===17){for(U=L+3;E<U;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}l>>>=L,E-=L,R=0,d=3+(l&7),l>>>=3,E-=3}else{for(U=L+7;E<U;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}l>>>=L,E-=L,R=0,d=11+(l&127),l>>>=7,E-=7}if(t.have+d>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=F;break}for(;d--;)t.lens[t.have++]=R}}if(t.mode===F)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=F;break}if(t.lenbits=9,T={bits:t.lenbits},P=Ye(Zr,t.lens,0,t.nlen,t.lencode,0,t.work,T),t.lenbits=T.bits,P){e.msg="invalid literal/lengths set",t.mode=F;break}if(t.distbits=6,t.distcode=t.distdyn,T={bits:t.distbits},P=Ye(Qr,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,T),t.distbits=T.bits,P){e.msg="invalid distances set",t.mode=F;break}if(t.mode=ht,i===pt)break e;case ht:t.mode=It;case It:if(s>=6&&f>=258){e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,t.hold=l,t.bits=E,no(e,c),o=e.next_out,n=e.output,f=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=t.hold,E=t.bits,t.mode===le&&(t.back=-1);break}for(t.back=0;S=t.lencode[l&(1<<t.lenbits)-1],L=S>>>24,N=S>>>16&255,m=S&65535,!(L<=E);){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(N&&(N&240)===0){for(I=L,C=N,k=m;S=t.lencode[k+((l&(1<<I+C)-1)>>I)],L=S>>>24,N=S>>>16&255,m=S&65535,!(I+L<=E);){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}l>>>=I,E-=I,t.back+=I}if(l>>>=L,E-=L,t.back+=L,t.length=m,N===0){t.mode=ur;break}if(N&32){t.back=-1,t.mode=le;break}if(N&64){e.msg="invalid literal/length code",t.mode=F;break}t.extra=N&15,t.mode=cr;case cr:if(t.extra){for(U=t.extra;E<U;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,E-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=dr;case dr:for(;S=t.distcode[l&(1<<t.distbits)-1],L=S>>>24,N=S>>>16&255,m=S&65535,!(L<=E);){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if((N&240)===0){for(I=L,C=N,k=m;S=t.distcode[k+((l&(1<<I+C)-1)>>I)],L=S>>>24,N=S>>>16&255,m=S&65535,!(I+L<=E);){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}l>>>=I,E-=I,t.back+=I}if(l>>>=L,E-=L,t.back+=L,N&64){e.msg="invalid distance code",t.mode=F;break}t.offset=m,t.extra=N&15,t.mode=fr;case fr:if(t.extra){for(U=t.extra;E<U;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,E-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=F;break}t.mode=_r;case _r:if(f===0)break e;if(d=c-f,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=F;break}d>t.wnext?(d-=t.wnext,u=t.wsize-d):u=t.wnext-d,d>t.length&&(d=t.length),y=t.window}else y=n,u=o-t.offset,d=t.length;d>f&&(d=f),f-=d,t.length-=d;do n[o++]=y[u++];while(--d);t.length===0&&(t.mode=It);break;case ur:if(f===0)break e;n[o++]=t.length,f--,t.mode=It;break;case Wt:if(t.wrap){for(;E<32;){if(s===0)break e;s--,l|=r[a++]<<E,E+=8}if(c-=f,e.total_out+=c,t.total+=c,t.wrap&4&&c&&(e.adler=t.check=t.flags?B(t.check,n,c,o-c):it(t.check,n,c,o-c)),c=f,t.wrap&4&&(t.flags?l:hr(l))!==t.check){e.msg="incorrect data check",t.mode=F;break}l=0,E=0}t.mode=mr;case mr:if(t.wrap&&t.flags){for(;E<32;){if(s===0)break e;s--,l+=r[a++]<<E,E+=8}if(t.wrap&4&&l!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=F;break}l=0,E=0}t.mode=pr;case pr:P=_o;break e;case F:P=Hr;break e;case qr:return jr;case Kr:default:return J}return e.next_out=o,e.avail_out=f,e.next_in=a,e.avail_in=s,t.hold=l,t.bits=E,(t.wsize||c!==e.avail_out&&t.mode<F&&(t.mode<Wt||i!==Ki))&&Jr(e,e.output,e.next_out,c-e.avail_out),h-=e.avail_in,c-=e.avail_out,e.total_in+=h,e.total_out+=c,t.total+=c,t.wrap&4&&c&&(e.adler=t.check=t.flags?B(t.check,n,c,e.next_out-c):it(t.check,n,c,e.next_out-c)),e.data_type=t.bits+(t.last?64:0)+(t.mode===le?128:0)+(t.mode===ht||t.mode===Gt?256:0),(h===0&&c===0||i===Ki)&&P===Le&&(P=mo),P},Lo=e=>{if(ve(e))return J;let i=e.state;return i.window&&(i.window=null),e.state=null,Le},vo=(e,i)=>{if(ve(e))return J;let t=e.state;return(t.wrap&2)===0?J:(t.head=i,i.done=!1,Le)},go=(e,i)=>{let t=i.length,r,n,a;return ve(e)||(r=e.state,r.wrap!==0&&r.mode!==At)?J:r.mode===At&&(n=1,n=it(n,i,t,0),n!==r.check)?Hr:(a=Jr(e,i,t,t),a?(r.mode=qr,jr):(r.havedict=1,Le))},yo=Wr,Uo=Yr,wo=Gr,Mo=Ro,No=Xr,Co=To,Oo=Lo,xo=vo,Po=go,Fo="pako inflate (from Nodeca project)",ce={inflateReset:yo,inflateReset2:Uo,inflateResetKeep:wo,inflateInit:Mo,inflateInit2:No,inflate:Co,inflateEnd:Oo,inflateGetHeader:xo,inflateSetDictionary:Po,inflateInfo:Fo};function Do(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Vo=Do,en=Object.prototype.toString,{Z_NO_FLUSH:ko,Z_FINISH:Bo,Z_OK:at,Z_STREAM_END:Jt,Z_NEED_DICT:ei,Z_STREAM_ERROR:$o,Z_DATA_ERROR:Sr,Z_MEM_ERROR:zo}=Oe;function Et(e){this.options=Lt.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});let i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(e&&e.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15)===0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $r,this.strm.avail_out=0;let t=ce.inflateInit2(this.strm,i.windowBits);if(t!==at)throw new Error(Ae[t]);if(this.header=new Vo,ce.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=nt.string2buf(i.dictionary):en.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(t=ce.inflateSetDictionary(this.strm,i.dictionary),t!==at)))throw new Error(Ae[t])}Et.prototype.push=function(e,i){let t=this.strm,r=this.options.chunkSize,n=this.options.dictionary,a,o,s;if(this.ended)return!1;for(i===~~i?o=i:o=i===!0?Bo:ko,en.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),a=ce.inflate(t,o),a===ei&&n&&(a=ce.inflateSetDictionary(t,n),a===at?a=ce.inflate(t,o):a===Sr&&(a=ei));t.avail_in>0&&a===Jt&&t.state.wrap>0&&e[t.next_in]!==0;)ce.inflateReset(t),a=ce.inflate(t,o);switch(a){case $o:case Sr:case ei:case zo:return this.onEnd(a),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||a===Jt))if(this.options.to==="string"){let f=nt.utf8border(t.output,t.next_out),l=t.next_out-f,E=nt.buf2string(t.output,f);t.next_out=l,t.avail_out=r-l,l&&t.output.set(t.output.subarray(f,f+l),0),this.onData(E)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(a===at&&s===0)){if(a===Jt)return a=ce.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Et.prototype.onData=function(e){this.chunks.push(e)};Et.prototype.onEnd=function(e){e===at&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Lt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function pi(e,i){let t=new Et(i);if(t.push(e),t.err)throw t.msg||Ae[t.err];return t.result}function Zo(e,i){return i=i||{},i.raw=!0,pi(e,i)}var Qo=Et,Ho=pi,jo=Zo,qo=pi,Ko=Oe,Go={Inflate:Qo,inflate:Ho,inflateRaw:jo,ungzip:qo,constants:Ko},{Deflate:_s,deflate:us,deflateRaw:ms,gzip:ps}=io,{Inflate:hs,inflate:Wo,inflateRaw:Is,ungzip:Ss}=Go;var tn=Wo;var oe=class e{decompressGzip(i){try{let t=new Uint8Array(i);return t[0]===31&&t[1]===139?tn(t,{to:"string"}):new TextDecoder().decode(t)}catch(t){throw console.error("Erreur lors de la d\xE9compression gzip:",t),t}}decompressGzipJson(i){let t=fetch(i).then(r=>r.arrayBuffer()).then(r=>this.decompressGzip(r));return Ai(t).pipe(v(r=>JSON.parse(r)))}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var gt=class e{http=b(gi);baseUrl="https://wakfu.cdn.ankama.com/gamedata/";compressionService=b(oe);getConfig(){return this.http.get(this.baseUrl+"config.json")}getItems(){return this.compressionService.decompressGzipJson(G+"items.json.gz")}getActions(){return this.compressionService.decompressGzipJson(G+"actions.json.gz")}getStates(){return this.compressionService.decompressGzipJson(G+"states.json.gz")}getRecipesResult(){return this.compressionService.decompressGzipJson(G+"recipeResults.json.gz")}getJobsItems(){return this.compressionService.decompressGzipJson(G+"jobsItems.json.gz")}getRecipeIngredients(){return this.compressionService.decompressGzipJson(G+"recipeIngredients.json.gz")}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var rn=(m=>(m[m.LE_DIANINE=24700]="LE_DIANINE",m[m.LE_DORRRRE=24610]="LE_DORRRRE",m[m.LE_JALM=24593]="LE_JALM",m[m.LA_FLOUFF=24607]="LA_FLOUFF",m[m.L_ATTENTIONNEE=24551]="L_ATTENTIONNEE",m[m.LA_GAINE=24566]="LA_GAINE",m[m.LA_ZEOR=24668]="LA_ZEOR",m[m.LE_CONDOTTIER=24513]="LE_CONDOTTIER",m[m.LES_OPRESSANTES=24524]="LES_OPRESSANTES",m[m.LE_FOUIP=24601]="LE_FOUIP",m[m.LE_FELDSPATH=24615]="LE_FELDSPATH",m[m.LES_MELLES=24538]="LES_MELLES",m[m.LE_FAINNE=24585]="LE_FAINNE",m[m.LA_PROMESSE=24537]="LA_PROMESSE",m[m.LE_LIEUTE=24505]="LE_LIEUTE",m[m.LE_PELO=24521]="LE_PELO",m[m.LE_TIG=24488]="LE_TIG",m[m.LE_CABOT=24426]="LE_CABOT",m[m.LA_BASTOS=24408]="LA_BASTOS",m))(rn||{}),nn=e=>Object.values(rn).includes(e);var yt=class e{ankamaCdnService=b(gt);static MEDAILLE_BRAVOURE_ITEM_ID=24705;config=new p("");config$=this.config.asObservable().pipe(Z(i=>i.length>0));action=new p([]);action$=this.action.asObservable().pipe(Z(i=>i.length>0));item=new p([]);item$=this.item.asObservable().pipe(Z(i=>i.length>0));states=new p([]);states$=this.states.asObservable().pipe(Z(i=>i.length>0));recipes=new p([]);recipes$=this.recipes.asObservable().pipe(Z(i=>i.length>0));idSiouperes=new p([]);idSiouperes$=this.idSiouperes.asObservable().pipe(Z(i=>i.length>0));recipeIngredients=new p([]);recipeIngredients$=this.recipeIngredients.asObservable().pipe(Z(i=>i.length>0));mapProductItemIdToRecipeResult=new Map;mapRecipeIdToRecipeIngredients=new Map;loadItems(){return this.ankamaCdnService.getItems().pipe(g(i=>this.item.next(i)))}loadActions(){return this.ankamaCdnService.getActions().pipe(g(i=>this.action.next(i)))}loadStates(){return this.ankamaCdnService.getStates().pipe(g(i=>this.states.next(i)))}loadRecipeIngredients(){return this.ankamaCdnService.getRecipeIngredients().pipe(g(i=>this.recipeIngredients.next(i)),g(i=>{i.forEach(t=>{let r=this.mapRecipeIdToRecipeIngredients.get(t.recipeId)||[];r.push(t),this.mapRecipeIdToRecipeIngredients.set(t.recipeId,r)})}))}loadRecipesResult(){return this.ankamaCdnService.getRecipesResult().pipe(g(i=>this.recipes.next(i)),g(i=>{i.forEach(t=>{this.mapProductItemIdToRecipeResult.set(t.productedItemId,t)})}))}loadIdSioupere(){return this.ankamaCdnService.getJobsItems().pipe(v(i=>i.filter(t=>t.title.fr.toLowerCase().includes("sioup\xE8re"))),g(i=>this.idSiouperes.next(i)))}load(){return Ti([this.loadItems(),this.loadActions(),this.loadStates(),this.loadRecipesResult(),this.loadIdSioupere(),this.loadRecipeIngredients()]).pipe(v(()=>{}))}getActionList(){return this.action.getValue()}getStatesList(){return this.states.getValue()}isItemPvP(i){if(nn(i))return!0;let t=this.mapProductItemIdToRecipeResult.get(i);return t?(this.mapRecipeIdToRecipeIngredients.get(t.recipeId)||[]).some(n=>n.itemId===e.MEDAILLE_BRAVOURE_ITEM_ID):!1}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var he=class e{imageService=b(Ui);itemTypes=new Map([[1,{ids:[101,111,114,117,223,253]}],[2,{ids:[108,110,113,115,254]}],[3,{ids:[103]}],[4,{ids:[119]}],[5,{ids:[120]}],[6,{ids:[132]}],[7,{ids:[133]}],[8,{ids:[134]}],[9,{ids:[136]}],[10,{ids:[138]}],[11,{ids:[646]}],[12,{ids:[189]}],[13,{ids:[112]}],[14,{ids:[582]}]]);getItemTypes(){return this.itemTypes}getItemType(i){let t;return this.itemTypes.forEach((r,n)=>{r.ids.includes(i)&&(t=n)}),t}getLogo(i){return i?this.imageService.mapUrlItemType.get(i)??"":""}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ut=class e{monsterDrops=new p([]);monsterDrops$=this.monsterDrops.asObservable();compressionService=b(oe);load(){return this.compressionService.decompressGzipJson(G+"monstres_drops_gfx.json.gz").pipe(g(i=>{this.monsterDrops.next(i)}),de(1),v(()=>{}))}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var wt=class e{familiers=new p([]);familiers$=this.familiers.asObservable();compressionService=b(oe);load(){return this.compressionService.decompressGzipJson(G+"familiers_stats.json.gz").pipe(g(i=>{this.familiers.next(i)}),de(1),v(()=>{}))}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ii=(S=>(S.POIDS="POIDS",S.MAITRISES="MAITRISES",S.RESISTANCES="RESISTANCES",S.EQUILIBRE="EQUILIBRE",S.PARADE_ARMURE_DONNEE="PARADE_ARMURE_DONNEE",S.POINT_DE_VIE="POINT_DE_VIE",S.TACLE="TACLE",S.ESQUIVE="ESQUIVE",S.TACLE_ESQUIVE="TACLE_ESQUIVE",S.CRITIQUE="CRITIQUE",S.PARADE="PARADE",S.CRITIQUE_PARADE="CRITIQUE_PARADE",S.PA="PA",S.PM="PM",S.PO="PO",S.PW="PW",S))(Ii||{});var Fe=class e extends x{itemTypeServices=b(he);selected=new p([]);selected$=this.selected.asObservable();keyEnum="KEY_ITEM_TYPE";form=new j({deuxMains:new _,uneMain:new _,anneau:new _,bottes:new _,amulette:new _,cape:new _,ceinture:new _,casque:new _,plastron:new _,epaulettes:new _,bouclier:new _,dague:new _,accessoires:new _,familier:new _});constructor(){super(),this.init()}handleChanges(i){let t=[];i.uneMain&&t.push(this.itemTypeServices.getItemTypes().get(2)?.ids),i.deuxMains&&t.push(this.itemTypeServices.getItemTypes().get(1)?.ids),i.anneau&&t.push(this.itemTypeServices.getItemTypes().get(3)?.ids),i.bottes&&t.push(this.itemTypeServices.getItemTypes().get(4)?.ids),i.amulette&&t.push(this.itemTypeServices.getItemTypes().get(5)?.ids),i.cape&&t.push(this.itemTypeServices.getItemTypes().get(6)?.ids),i.ceinture&&t.push(this.itemTypeServices.getItemTypes().get(7)?.ids),i.casque&&t.push(this.itemTypeServices.getItemTypes().get(8)?.ids),i.plastron&&t.push(this.itemTypeServices.getItemTypes().get(9)?.ids),i.epaulettes&&t.push(this.itemTypeServices.getItemTypes().get(10)?.ids),i.bouclier&&t.push(this.itemTypeServices.getItemTypes().get(12)?.ids),i.dague&&t.push(this.itemTypeServices.getItemTypes().get(13)?.ids),i.accessoires&&t.push(this.itemTypeServices.getItemTypes().get(11)?.ids),i.familier&&t.push(this.itemTypeServices.getItemTypes().get(14)?.ids),this.selected.next(t.flat())}setValue(i){this.form.setValue({deuxMains:i?.deuxMains??!1,uneMain:i?.uneMain??!1,anneau:i?.anneau??!1,bottes:i?.bottes??!1,amulette:i?.amulette??!1,cape:i?.cape??!1,ceinture:i?.ceinture??!1,casque:i?.casque??!1,plastron:i?.plastron??!1,epaulettes:i?.epaulettes??!1,bouclier:i?.bouclier??!1,dague:i?.dague??!1,accessoires:i?.accessoires??!1,familier:i?.familier??!1})}setDefaultValue(){this.setItemType()}setItemType(...i){this.form.setValue({deuxMains:i.includes(1),uneMain:i.includes(2),anneau:i.includes(3),bottes:i.includes(4),amulette:i.includes(5),cape:i.includes(6),ceinture:i.includes(7),casque:i.includes(8),plastron:i.includes(9),epaulettes:i.includes(10),bouclier:i.includes(12),dague:i.includes(13),accessoires:i.includes(11),familier:i.includes(14)})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Mt=class e extends x{static DEFAULT_VALUE="MAITRISES";sort=new p(e.DEFAULT_VALUE);sort$=this.sort.asObservable();keyEnum="KEY_SORT_CHOICE";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){this.sort.next(i)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var De=class e extends x{static DEFAULT_VALUE=!1;onlyNoSecondary=new p(!1);onlyNoSecondary$=this.onlyNoSecondary.asObservable();keyEnum="KEY_ONLY_NO_SECONDARY";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){this.onlyNoSecondary.next(i??!1)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ve=class e extends x{idMajor=new p([]);idMajor$=this.idMajor.asObservable();keyEnum="KEY_MAJOR_PRESENT";form=new j({PA:new _,PM:new _,PW:new _,PO:new _,ARMURE_DONNEE:new _,ARMURE_RECUE:new _,CRITIQUE:new _,PARADE:new _,RESISTANCE_DOS:new _,RESISTANCE_CRITIQUE:new _,TACLE:new _,ESQUIVE:new _,PERTE_PA:new _,PERTE_PM:new _,PERTE_PW:new _,PERTE_PO:new _,PERTE_ARMURE_DONNEE:new _,PERTE_ARMURE_RECUE:new _,PERTE_CRITIQUE:new _,PERTE_PARADE:new _,PERTE_RESISTANCE_DOS:new _,PERTE_RESISTANCE_CRITIQUE:new _,PERTE_MAITRISES_MELEE:new _,PERTE_MAITRISES_DISTANCE:new _,PERTE_MAITRISES_CRITIQUE:new _,PERTE_MAITRISES_DOS:new _,PERTE_MAITRISES_SOIN:new _,PERTE_MAITRISES_BERZERK:new _,PERTE_TACLE:new _,PERTE_ESQUIVE:new _});constructor(){super(),this.init()}handleChanges(i){let t=[];i.PA&&t.push({id:31}),i.PM&&t.push({id:41}),i.PW&&t.push({id:191}),i.PO&&t.push({id:160}),i.ARMURE_DONNEE&&t.push({id:39,parameter:120}),i.ARMURE_RECUE&&t.push({id:39,parameter:121}),i.CRITIQUE&&t.push({id:150}),i.PARADE&&t.push({id:875}),i.RESISTANCE_DOS&&t.push({id:71}),i.RESISTANCE_CRITIQUE&&t.push({id:988}),i.TACLE&&t.push({id:173}),i.ESQUIVE&&t.push({id:175}),i.PERTE_PA&&t.push({id:56}),i.PERTE_PM&&t.push({id:57}),i.PERTE_PW&&t.push({id:192}),i.PERTE_PO&&t.push({id:161}),i.PERTE_ARMURE_DONNEE&&t.push({id:40,parameter:120}),i.PERTE_ARMURE_RECUE&&t.push({id:40,parameter:121}),i.PERTE_CRITIQUE&&t.push({id:168}),i.PERTE_PARADE&&t.push({id:876}),i.PERTE_RESISTANCE_DOS&&t.push({id:1063}),i.PERTE_RESISTANCE_CRITIQUE&&t.push({id:1062}),i.PERTE_MAITRISES_MELEE&&t.push({id:1059}),i.PERTE_MAITRISES_DISTANCE&&t.push({id:1060}),i.PERTE_MAITRISES_CRITIQUE&&t.push({id:1056}),i.PERTE_MAITRISES_DOS&&t.push({id:181}),i.PERTE_MAITRISES_SOIN&&t.push({id:-1}),i.PERTE_MAITRISES_BERZERK&&t.push({id:1061}),i.PERTE_TACLE&&t.push({id:174}),i.PERTE_ESQUIVE&&t.push({id:176}),this.idMajor.next(t)}setValue(i){this.form.setValue({PA:i?.PA??!1,PM:i?.PM??!1,PW:i?.PW??!1,PO:i?.PO??!1,ARMURE_DONNEE:i?.ARMURE_DONNEE??!1,ARMURE_RECUE:i?.ARMURE_RECUE??!1,CRITIQUE:i?.CRITIQUE??!1,PARADE:i?.PARADE??!1,RESISTANCE_DOS:i?.RESISTANCE_DOS??!1,RESISTANCE_CRITIQUE:i?.RESISTANCE_CRITIQUE??!1,TACLE:i?.TACLE??!1,ESQUIVE:i?.ESQUIVE??!1,PERTE_PA:i?.PERTE_PA??!1,PERTE_PM:i?.PERTE_PM??!1,PERTE_PW:i?.PERTE_PW??!1,PERTE_PO:i?.PERTE_PO??!1,PERTE_ARMURE_DONNEE:i?.PERTE_ARMURE_DONNEE??!1,PERTE_ARMURE_RECUE:i?.PERTE_ARMURE_RECUE??!1,PERTE_CRITIQUE:i?.PERTE_CRITIQUE??!1,PERTE_PARADE:i?.PERTE_PARADE??!1,PERTE_RESISTANCE_DOS:i?.PERTE_RESISTANCE_DOS??!1,PERTE_RESISTANCE_CRITIQUE:i?.PERTE_RESISTANCE_CRITIQUE??!1,PERTE_MAITRISES_MELEE:i?.PERTE_MAITRISES_MELEE??!1,PERTE_MAITRISES_DISTANCE:i?.PERTE_MAITRISES_DISTANCE??!1,PERTE_MAITRISES_CRITIQUE:i?.PERTE_MAITRISES_CRITIQUE??!1,PERTE_MAITRISES_DOS:i?.PERTE_MAITRISES_DOS??!1,PERTE_MAITRISES_SOIN:i?.PERTE_MAITRISES_SOIN??!1,PERTE_MAITRISES_BERZERK:i?.PERTE_MAITRISES_BERZERK??!1,PERTE_TACLE:i?.PERTE_TACLE??!1,PERTE_ESQUIVE:i?.PERTE_ESQUIVE??!1})}setDefaultValue(){this.setMajor()}setMajor(...i){this.form.setValue({PA:i.some(t=>t.id===31),PM:i.some(t=>t.id===41),PW:i.some(t=>t.id===191),PO:i.some(t=>t.id===160),ARMURE_DONNEE:i.some(t=>t.id===39&&t.parameter===120),ARMURE_RECUE:i.some(t=>t.id===39&&t.parameter===121),CRITIQUE:i.some(t=>t.id===150),PARADE:i.some(t=>t.id===875),RESISTANCE_DOS:i.some(t=>t.id===71),RESISTANCE_CRITIQUE:i.some(t=>t.id===988),TACLE:i.some(t=>t.id===173),ESQUIVE:i.some(t=>t.id===175),PERTE_PA:i.some(t=>t.id===56),PERTE_PM:i.some(t=>t.id===57),PERTE_PW:i.some(t=>t.id===192),PERTE_PO:i.some(t=>t.id===161),PERTE_ARMURE_DONNEE:i.some(t=>t.id===40&&t.parameter===120),PERTE_ARMURE_RECUE:i.some(t=>t.id===40&&t.parameter===121),PERTE_CRITIQUE:i.some(t=>t.id===168),PERTE_PARADE:i.some(t=>t.id===876),PERTE_RESISTANCE_DOS:i.some(t=>t.id===1063),PERTE_RESISTANCE_CRITIQUE:i.some(t=>t.id===1062),PERTE_MAITRISES_MELEE:i.some(t=>t.id===1059),PERTE_MAITRISES_DISTANCE:i.some(t=>t.id===1060),PERTE_MAITRISES_CRITIQUE:i.some(t=>t.id===1056),PERTE_MAITRISES_DOS:i.some(t=>t.id===181),PERTE_MAITRISES_SOIN:i.some(t=>t.id===-1),PERTE_MAITRISES_BERZERK:i.some(t=>t.id===1061),PERTE_TACLE:i.some(t=>t.id===174),PERTE_ESQUIVE:i.some(t=>t.id===176)})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var an=(n=>(n.COEUR_HUPPERMAGE="COEUR_HUPPERMAGE",n.DENOUEMENT="DENOUEMENT",n.DEMESURE="DEMESURE",n.CHAOS="CHAOS",n))(an||{});var ke=class e extends x{static DEFAULT_VALUE=[];multiplicateurElem=new p(1);multiplicateurElem$=this.multiplicateurElem.asObservable();denouement=new p(!1);denouement$=this.denouement.asObservable();demesure=new p(!1);demesure$=this.demesure.asObservable();chaos=new p(!1);chaos$=this.chaos.asObservable();keyEnum="KEY_MODIFIER_MECANISM";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){let t=1;i?.includes("COEUR_HUPPERMAGE".valueOf())&&(t*=1.2),this.multiplicateurElem.next(t),this.denouement.next(i?.includes("DENOUEMENT".valueOf())??!1),this.demesure.next(i?.includes("DEMESURE".valueOf())??!1),this.chaos.next(i?.includes("CHAOS".valueOf())??!1)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Be=class e extends x{static DEFAULT_LEVEL_MIN=200;static DEFAULT_LEVEL_MAX=245;selected=new p([]);selected$=this.selected.asObservable();levelMin=new p(e.DEFAULT_LEVEL_MIN);levelMin$=this.levelMin.asObservable();levelMax=new p(e.DEFAULT_LEVEL_MAX);levelMax$=this.levelMax.asObservable();keyEnum="KEY_ITEM_LEVEL";form=new j({levelMin:new _(e.DEFAULT_LEVEL_MIN,{nonNullable:!0}),levelMax:new _(e.DEFAULT_LEVEL_MAX,{nonNullable:!0})});constructor(){super(),this.init()}handleChanges(i){this.levelMin.next(i.levelMin??e.DEFAULT_LEVEL_MIN),this.levelMax.next(i.levelMax??e.DEFAULT_LEVEL_MAX)}setValue(i){this.form.setValue({levelMin:i?.levelMin??e.DEFAULT_LEVEL_MIN,levelMax:i?.levelMax??e.DEFAULT_LEVEL_MAX})}setDefaultValue(){this.form.setValue({levelMin:e.DEFAULT_LEVEL_MIN,levelMax:e.DEFAULT_LEVEL_MAX})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var $e=class e extends x{selected=new p([]);selected$=this.selected.asObservable();rarity=new p([]);rarity$=this.rarity.asObservable();keyEnum="KEY_RARETE_ITEM";form=new j({normal:new _,rare:new _,mythique:new _,legendaire:new _,souvenir:new _,relique:new _,epique:new _});constructor(){super(),this.init()}handleChanges(i){let t=[];i.normal&&t.push(1),i.rare&&t.push(2),i.mythique&&t.push(3),i.legendaire&&t.push(4),i.relique&&t.push(5),i.souvenir&&t.push(6),i.epique&&t.push(7),this.rarity.next(t)}setValue(i){this.form.setValue({normal:i?.normal??!1,rare:i?.rare??!1,mythique:i?.mythique??!1,legendaire:i?.legendaire??!1,souvenir:i?.souvenir??!1,relique:i?.relique??!1,epique:i?.epique??!1})}setRarity(...i){this.form.setValue({normal:i.includes(1),rare:i.includes(2),mythique:i.includes(3),legendaire:i.includes(4),relique:i.includes(5),souvenir:i.includes(6),epique:i.includes(7)})}setDefaultValue(){this.setRarity()}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Nt=class e extends x{rareteItemFormServices=b($e);itemTypeFormServices=b(Fe);itemTypeService=b(he);itemLevelFormService=b(Be);majorPresentFormService=b(Ve);static DEFAULT_VALUE="";itemName=new p("");itemName$=this.itemName.asObservable();keyEnum="KEY_SEARCH_ITEM_NAME";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){this.itemName.next(i??e.DEFAULT_VALUE)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}setFilter(i){this.rareteItemFormServices.setDefaultValue(),this.majorPresentFormService.setDefaultValue();let t=this.itemTypeService.getItemType(i.itemTypeId);if(t)if(this.itemTypeFormServices.setItemType(t),i.level<=20)this.itemLevelFormService.setValue({levelMin:0,levelMax:20});else{let r=Math.ceil((i.level-20)/15);this.itemLevelFormService.setValue({levelMin:(r-1)*15+20+1,levelMax:r*15+20})}}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var ze=class e extends x{idResistances=new p([]);idResistances$=this.idResistances.asObservable();keyEnum="KEY_RESISTANCES";form=new j({feu:new _,eau:new _,terre:new _,air:new _});mapFormToIdResistances=new Map([["feu",82],["eau",83],["terre",84],["air",85]]);constructor(){super(),this.init()}handleChanges(i){let t=[];i.feu&&t.push(82),i.eau&&t.push(83),i.terre&&t.push(84),i.air&&t.push(85),this.idResistances.next(t)}setValue(i){this.form.setValue({feu:i?.feu??!1,eau:i?.eau??!1,terre:i?.terre??!1,air:i?.air??!1})}setResistances(...i){this.form.setValue({feu:i.includes(82),eau:i.includes(83),terre:i.includes(84),air:i.includes(85)})}setDefaultValue(){this.setResistances()}orderResistances(){let i=[82,83,84,85],t=[],r=[];return i.forEach(n=>{let a=Array.from(this.mapFormToIdResistances.entries()).find(([,o])=>o===n)?.[0];a&&this.form.controls[a].value?t.push(n):r.push(n)}),[...t,...r]}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ze=class e extends x{nbElements=new p(0);nbElements$=this.nbElements.asObservable();idMaitrises=new p([]);idMaitrises$=this.idMaitrises.asObservable();mapFormToIdMaitrisesElementaire=new Map([["feu",122],["eau",124],["terre",123],["air",125]]);keyEnum="KEY_MAITRISES";form=new j({feu:new _,eau:new _,terre:new _,air:new _,critique:new _,dos:new _,melee:new _,distance:new _,soin:new _,berzerk:new _});constructor(){super(),this.init()}handleChanges(i){let t=0,r=[];i.feu&&(t++,r.push(122)),i.eau&&(t++,r.push(124)),i.terre&&(t++,r.push(123)),i.air&&(t++,r.push(125)),this.nbElements.next(t),i.critique&&r.push(149),i.dos&&r.push(180),i.melee&&r.push(1052),i.distance&&r.push(1053),i.soin&&r.push(26),i.berzerk&&r.push(1055),this.idMaitrises.next(r)}setValue(i){this.form.setValue({feu:i?.feu??!1,eau:i?.eau??!1,terre:i?.terre??!1,air:i?.air??!1,critique:i?.critique??!1,dos:i?.dos??!1,melee:i?.melee??!1,distance:i?.distance??!1,soin:i?.soin??!1,berzerk:i?.berzerk??!1})}setDefaultValue(){this.setMaitrises()}setMaitrises(...i){this.form.setValue({feu:i.includes(122),eau:i.includes(124),terre:i.includes(123),air:i.includes(125),critique:i.includes(149),dos:i.includes(180),melee:i.includes(1052),distance:i.includes(1053),soin:i.includes(26),berzerk:i.includes(1055)})}orderMaitrises(){let i=[122,124,123,125],t=[],r=[];return i.forEach(n=>{let a=Array.from(this.mapFormToIdMaitrisesElementaire.entries()).find(([,o])=>o===n)?.[0];a&&this.form.controls[a].value?t.push(n):r.push(n)}),[...t,...r]}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Qe=class e extends x{static DEFAULT_VALUE=!1;onlyNoElem=new p(!1);onlyNoElem$=this.onlyNoElem.asObservable();keyEnum="KEY_ONLY_NO_ELEM";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){this.onlyNoElem.next(i??!1)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ct=class e extends x{static DEFAULT_VALUE=!1;reverse=new p(e.DEFAULT_VALUE);reverse$=this.reverse.asObservable();keyEnum="KEY_REVERSE";form=new _(e.DEFAULT_VALUE,{nonNullable:!0});constructor(){super(),this.init()}handleChanges(i){this.reverse.next(i??e.DEFAULT_VALUE)}setValue(i){this.form.setValue(i??e.DEFAULT_VALUE)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE)}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ot=class e extends x{static DEFAULT_VALUE_DROP=!0;static DEFAULT_VALUE_CRAFTABLE=!0;static DEFAULT_VALUE_BOSS=!0;static DEFAULT_VALUE_ARCHI=!0;static DEFAULT_VALUE_PVP=!0;drop=new p(e.DEFAULT_VALUE_DROP);drop$=this.drop.asObservable();craftable=new p(e.DEFAULT_VALUE_CRAFTABLE);craftable$=this.craftable.asObservable();boss=new p(e.DEFAULT_VALUE_BOSS);boss$=this.boss.asObservable();archi=new p(e.DEFAULT_VALUE_ARCHI);archi$=this.archi.asObservable();pvp=new p(e.DEFAULT_VALUE_PVP);pvp$=this.pvp.asObservable();keyEnum="KEY_OBTENTION";form=new j({DROP:new _,CRAFTABLE:new _,BOSS:new _,ARCHI:new _,PVP:new _});constructor(){super(),this.init()}handleChanges(i){this.drop.next(!i.DROP),this.craftable.next(!i.CRAFTABLE),this.boss.next(!i.BOSS),this.archi.next(!i.ARCHI),this.pvp.next(!i.PVP)}setValue(i){this.form.setValue({DROP:i?.DROP??e.DEFAULT_VALUE_DROP,CRAFTABLE:i?.CRAFTABLE??e.DEFAULT_VALUE_CRAFTABLE,BOSS:i?.BOSS??e.DEFAULT_VALUE_BOSS,ARCHI:i?.ARCHI??e.DEFAULT_VALUE_ARCHI,PVP:i?.PVP??e.DEFAULT_VALUE_PVP})}setDefaultValue(){this.setValue({DROP:e.DEFAULT_VALUE_DROP,CRAFTABLE:e.DEFAULT_VALUE_CRAFTABLE,BOSS:e.DEFAULT_VALUE_BOSS,ARCHI:e.DEFAULT_VALUE_ARCHI,PVP:e.DEFAULT_VALUE_PVP})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var sn=(c=>(c[c.EMBLEME_SHUSHU_1=18670]="EMBLEME_SHUSHU_1",c[c.EMBLEME_SHUSHU_2=18671]="EMBLEME_SHUSHU_2",c[c.EMBLEME_SHUSHU_3=18672]="EMBLEME_SHUSHU_3",c[c.EMBLEME_SHUSHU_4=18673]="EMBLEME_SHUSHU_4",c[c.EMBLEME_SHUSHU_5=18674]="EMBLEME_SHUSHU_5",c[c.EMBLEME_SHUSHU_6=18675]="EMBLEME_SHUSHU_6",c[c.EMBLEME_SHUSHU_7=18676]="EMBLEME_SHUSHU_7",c[c.EMBLEME_SHUSHU_8=18677]="EMBLEME_SHUSHU_8",c[c.EMBLEME_SHUSHU_9=18678]="EMBLEME_SHUSHU_9",c[c.EMBLEME_SHUSHU_10=18679]="EMBLEME_SHUSHU_10",c[c.EMBLEME_SHUSHU_11=18680]="EMBLEME_SHUSHU_11",c[c.EMBLEME_SHUSHU_12=18681]="EMBLEME_SHUSHU_12",c))(sn||{}),ln=e=>Object.values(sn).includes(e);var xt=class e{itemTypeFormServices=b(Fe);translateService=b(yi);onlyNoSecondaryFormService=b(De);sortChoiceFormService=b(Mt);majorPresentFormService=b(Ve);modifierElemMaitrisesFormService=b(ke);searchItemNameFormService=b(Nt);rareteItemFormService=b($e);itemLevelFormService=b(Be);resistanceFormService=b(ze);maitrisesFormService=b(Ze);ankamaCdnFacade=b(yt);onlyNoElemFormService=b(Qe);reverseFormService=b(Ct);obtentionFormService=b(Ot);monsterDropService=b(Ut);familiersService=b(wt);static ARMURE_DONNEE_RECUE_LIST=[39,40];static RESISTANCE_ELEM_IDS=[85,83,84,82];static MALUS_RESIS_ELEM_IDS=[97,96,98];static MAITRISES_ELEM_IDS=[122,123,124,125];static PERTE_MAITRISES_IDS=[130,132];static RESISTANCE_ELEM_IDS_SET=new Set([85,83,84,82]);static MALUS_RESIS_ELEM_IDS_SET=new Set([97,96,98]);static MAITRISES_ELEM_IDS_SET=new Set([122,123,124,125]);static PERTE_MAITRISES_IDS_SET=new Set([130,132]);static EQUILIBRE_RESISTANCE_MULTIPLIER=1.2;static DEFAULT_NB_ELEMENTS=4;idPierresList=[29847,29848,29849,29850,29851];items=[];fullItems$=new p([]);_items$=new p([]);items$=this._items$.asObservable();_itemsFilterByItemName=new p([]);itemsFilterByItemName$=this._itemsFilterByItemName.asObservable();itemsFilters$;recipesByProductId=new Map;itemsByName=new Map;monsterDropsByItemId=new Map;archiIds=new Set;sublimations=new p([]);sublimations$=this.sublimations.asObservable();isLoading=vi(!0);init(){this.initItemsList(),this.initFilter();let i=V([this.itemsFilters$,this.maitrisesFormService.nbElements$,this.maitrisesFormService.idMaitrises$,this.sortChoiceFormService.sort$,this.modifierElemMaitrisesFormService.multiplicateurElem$,this.modifierElemMaitrisesFormService.denouement$,this.resistanceFormService.idResistances$,this.onlyNoElemFormService.onlyNoElem$,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.chaos$]).pipe(g(([t,r,n,a,o,s,f,l,E,h])=>this.fillItemWeightMap(t,r,n,a,o,f,s,l,E,h)),v(([t])=>t));V([i,this.reverseFormService.reverse$]).pipe(v(([t,r])=>{let n=t.sort(this.sortItems());return r?n.reverse():n}),g(()=>this.isLoading.set(!1)),de(1),g(t=>this._items$.next(t))).subscribe()}initFamiliers(){this.familiersService.familiers$.pipe(Vt(1)).subscribe(i=>{let t=new Map;this.items.forEach(r=>{t.set(r.id,r)}),i.forEach(r=>{let n=t.get(r.id);n&&r.statsList.forEach((a,o)=>{o<n.equipEffects.length&&(n.equipEffects[o].params[0]=a)})})})}sortItems(){return(i,t)=>t.weightForSort>i.weightForSort?1:t.weightForSort===i.weightForSort?t.weight-i.weight:-1}isNotWIP(i){return!!i.title}filterObtention(i,t,r,n,a,o){let s=i.isCraftable&&!r;return s=s||i.mobDropable.length>0&&!t,s=s||i.bossDropable.length>0&&!n,s=s||i.archiDropable.length>0&&!a,s=s||i.isPvP&&!o,s=s||i.mobDropable.length===0&&i.bossDropable.length===0&&i.archiDropable.length===0&&!i.isCraftable&&!i.isPvP,s}loadSublimations(){let t=this.items.filter(r=>r.itemTypeId===812).filter(r=>r.enchantement.isEpic||r.enchantement.isRelic||["I","II","III"].includes(r.title.fr.split(" ").pop()||"")).sort((r,n)=>r.title.fr.localeCompare(n.title.fr));this.sublimations.next(t),this.prepareJsonSublimations(t)}prepareJsonSublimations(i){let t=[],r=new Map;i.forEach(n=>{if(n.enchantement.isEpic||n.enchantement.isRelic)r.set(n.title.fr,[n]);else{let a=n.title.fr.replace(/ I{1,3}$| II$| III$/,"").trim();r.has(a)||r.set(a,[]),r.get(a)?.push(n)}}),r.forEach(n=>{let a=[];n.forEach(E=>{if(E.enchantement.isEpic||E.enchantement.isRelic)a.push({id:E.id,level:1});else{let h=E.title.fr.endsWith(" III")?3:E.title.fr.endsWith(" II")?2:1;a.push({id:E.id,level:h})}});let o=0,s=n[0];if(!s.enchantement.isEpic&&!s.enchantement.isRelic){let E=s.description.fr.slice(s.description.fr.length-2,s.description.fr.length-1);o=Number.parseInt(E||"0")}let f=s.enchantement.isEpic||s.enchantement.isRelic,l=[];t.push({linkSublimation:a,title:{fr:f?n[0].title.fr:n[0].title.fr.replace(/ I{1,3}$| II$| III$/,"").trim(),en:f?n[0].title.en:n[0].title.en.replace(/ I{1,3}$| II$| III$/,"").trim(),es:f?n[0].title.es:n[0].title.es.replace(/ I{1,3}$| II$| III$/,"").trim(),pt:f?n[0].title.pt:n[0].title.pt.replace(/ I{1,3}$| II$| III$/,"").trim()},description:{fr:"",en:"",es:"",pt:""},levelMax:o,baseEffect:l,id:a[0].id,gfxId:s.idImage,isEpic:s.enchantement.isEpic,isRelic:s.enchantement.isRelic,slotColorPattern:s.enchantement.slotColorPattern,bossDropable:[],isCraftable:!1})})}initFilter(){this.items=this.items.filter(E=>![480,811,812].includes(E.itemTypeId)).filter(E=>this.isNotWIP(E)),this.initFamiliers(),this.fullItems$.next(this.items);let i=V([this.fullItems$,this.searchItemNameFormService.itemName$]).pipe(v(([E,h])=>E.filter(c=>Bt(c.title[this.translateService.currentLang].toString()).includes(Bt(h)))),g(E=>this._itemsFilterByItemName.next(E))),t=V([i,this.obtentionFormService.drop$,this.obtentionFormService.craftable$,this.obtentionFormService.boss$,this.obtentionFormService.archi$,this.obtentionFormService.pvp$]).pipe(v(([E,h,c,d,u,y])=>E.filter(S=>this.filterObtention(S,h,c,d,u,y)))),r=V([t,this.itemLevelFormService.levelMin$]).pipe(v(([E,h])=>E.filter(c=>c.level>=h||c.itemTypeId===582))),n=V([r,this.itemLevelFormService.levelMax$]).pipe(v(([E,h])=>E.filter(c=>c.level<=h||c.itemTypeId===582))),a=V([n,this.rareteItemFormService.rarity$]).pipe(v(([E,h])=>E.filter(c=>h.length===0||h.includes(c.rarity)||c.itemTypeId===582))),o=V([a,this.onlyNoElemFormService.onlyNoElem$]).pipe(v(([E,h])=>E.filter(c=>!h||!c.equipEffects.find(d=>[122,124,123,125,120,1068].includes(d.actionId))))),s=V([o,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.denouement$,this.onlyNoElemFormService.onlyNoElem$]).pipe(v(([E,h,c,d])=>E.filter(u=>!h||!u.equipEffects.find(y=>[180,1052,1053,26,1055].includes(y.actionId))&&(c&&!d||!u.equipEffects.find(y=>y.actionId===149))))),f=V([s,this.majorPresentFormService.idMajor$]).pipe(v(([E,h])=>E.filter(c=>this.majorIsPresent(h,c)))),l=V([f,this.modifierElemMaitrisesFormService.demesure$]).pipe(v(([E,h])=>E.filter(c=>!h||c.equipEffects.find(d=>[875,150].includes(d.actionId)))));this.itemsFilters$=V([l,this.itemTypeFormServices.selected$]).pipe(v(([E,h])=>E.filter(c=>h.length===0||h.includes(c.itemTypeId))))}fillItemWeightMap(i,t,r,n,a,o,s,f,l,E){let h=0,c=0;i.forEach(d=>{d.resistance=Math.trunc(this.calculResistancesForAnItem(d,o)),d.maitrise=Math.trunc(this.calculMaitrisesForAnItem(d,t,r,a,s,f,l,E)),d.weight=_t(d.resistance,d.maitrise,d.level),d.weightForSort=0}),n==="EQUILIBRE"&&i.length&&(h=Math.max(...i.map(d=>d.maitrise)),c=Math.max(...i.map(d=>d.resistance))),i.forEach(d=>{d.weightForSort=this.calculateWeightForSort(d,n,d.effectsMap,h,c)})}createEffectsMap(i){let t=new Map;return i.equipEffects.forEach(r=>{t.set(r.actionId,r.params[0])}),t}calculateWeightForSort(i,t,r,n,a){switch(t){case"POIDS":return i.weight;case"MAITRISES":return i.maitrise;case"EQUILIBRE":return i.maitrise/n+e.EQUILIBRE_RESISTANCE_MULTIPLIER*(i.resistance/a);case"POINT_DE_VIE":return this.calculateNetEffect(r,20,21);case"PARADE_ARMURE_DONNEE":return this.calculateParadeArmureDonnee(i,r);case"TACLE":return this.calculateNetEffect(r,173,174);case"ESQUIVE":return this.calculateNetEffect(r,175,176);case"TACLE_ESQUIVE":return this.calculateNetEffect(r,173,174)+this.calculateNetEffect(r,175,176);case"CRITIQUE":return this.calculateNetEffect(r,150,168);case"PARADE":return this.calculateNetEffect(r,875,876);case"CRITIQUE_PARADE":return this.calculateNetEffect(r,150,168)+this.calculateNetEffect(r,875,876);case"PA":return this.calculateNetEffect(r,31,56);case"PM":return this.calculateNetEffect(r,41,57);case"PO":return this.calculateNetEffect(r,160,161);case"PW":return this.calculateNetEffect(r,193,194)+this.calculateNetEffect(r,191,192);default:return i.resistance}}calculateParadeArmureDonnee(i,t){let r=t.get(875)??0;return i.equipEffects.forEach(n=>{n.actionId===39&&n.params[4]===120&&(r+=n.params[0])}),r}getEffectValue(i,t){return i.get(t)??0}calculateNetEffect(i,t,r){return this.getEffectValue(i,t)-this.getEffectValue(i,r)}initItemsList(){V([this.ankamaCdnFacade.item$,this.ankamaCdnFacade.recipes$,this.ankamaCdnFacade.idSiouperes$,this.monsterDropService.monsterDrops$]).pipe(Vt(1),g(([i,t,r,n])=>{i.filter(a=>!ln(a.definition.item.id)).forEach(a=>this.items.push({id:a.definition.item.id,level:a.definition.item.level,rarity:a.definition.item.baseParameters.rarity,itemTypeId:a.definition.item.baseParameters.itemTypeId,equipEffects:a.definition.equipEffects.map(o=>({id:o.effect.definition.id,actionId:o.effect.definition.actionId,params:o.effect.definition.params})),title:{fr:a.title.fr.trim(),en:a.title.en.trim(),es:a.title.es.trim(),pt:a.title.pt.trim()},description:a.description,idImage:a.definition.item.graphicParameters.gfxId,weightForSort:0,weight:0,maitrise:0,resistance:0,isCraftable:!1,mobDropable:[],bossDropable:[],archiDropable:[],isPvP:!1,enchantement:{slotColorPattern:a.definition.item.sublimationParameters?.slotColorPattern??[],isEpic:a.definition.item.sublimationParameters?.isEpic??!1,isRelic:a.definition.item.sublimationParameters?.isRelic??!1}})),this.buildIndexes(t,n,r),this.items.forEach(a=>{a.effectsMap=this.createEffectsMap(a),this.calculItemIsCraftable(a),this.calculItemIsDropable(a),this.calculIsItemPvP(a)})})).subscribe()}buildIndexes(i,t,r){for(let n of i)this.recipesByProductId.set(n.productedItemId,n);for(let n of this.items)this.itemsByName.has(n.title.fr)||this.itemsByName.set(n.title.fr,[]),this.itemsByName.get(n.title.fr).push(n);for(let n of t)for(let a of n.idsDrop)this.monsterDropsByItemId.has(a)||this.monsterDropsByItemId.set(a,[]),this.monsterDropsByItemId.get(a).push(n);for(let n of r)this.archiIds.add(n.definition.id)}calculIsItemPvP(i){if(!this.ankamaCdnFacade.isItemPvP(i.id))return;let r=this.itemsByName.get(i.title.fr);r&&r.forEach(n=>n.isPvP=!0)}calculItemIsCraftable(i){if(i.isCraftable||!this.recipesByProductId.get(i.id))return;if(i.rarity===6){i.isCraftable=!0;return}let r=this.itemsByName.get(i.title.fr);if(!(!r||r.some(a=>i.level<=35?a.rarity<i.rarity:a.rarity<i.rarity&&a.level>=35)))for(let a of r)a.isCraftable=!0}calculItemIsDropable(i){if(i.mobDropable.length)return;let t=this.monsterDropsByItemId.get(i.id);if(!t||t.length===0)return;let r=t.filter(o=>o.idsDrop.some(s=>this.idPierresList.includes(s))),n=t.filter(o=>o.idsDrop.some(s=>this.archiIds.has(s))).filter(o=>!r.includes(o));if(t=t.filter(o=>!r.includes(o)&&!n.includes(o)),i.rarity===6){t.length&&(i.mobDropable=t),r.length&&(i.bossDropable=r),n.length&&(i.archiDropable=n);return}let a=this.itemsByName.get(i.title.fr);if(a)for(let o of a)o.rarity!==6&&((o.rarity!==1||o.level<=35)&&o.level>=i.level&&t.length&&(o.mobDropable=t),r.length&&(o.bossDropable=r),n.length&&(o.archiDropable=n))}searchItem(i){return this.fullItems$.pipe(Z(t=>t.length>0),v(t=>t.find(r=>r.id===i)))}getItem(i){return this.fullItems$.value.find(t=>t.id===i)}majorIsPresent(i,t){return!i.find(r=>!e.ARMURE_DONNEE_RECUE_LIST.includes(r.id)&&!t.equipEffects.map(n=>n.actionId).includes(r.id)||r.id===39&&!t.equipEffects.find(n=>n.actionId===39&&n.params[4]===r.parameter)||r.id===40&&!t.equipEffects.find(n=>n.actionId===40&&n.params[4]===r.parameter))}calculResistancesForAnItem(i,t){let r=0,n=t.length===0?e.DEFAULT_NB_ELEMENTS:t.length,a=new Set(t);return i.equipEffects.forEach(o=>{o.actionId===1069&&o.params[2]>=t.length?r+=o.params[0]*Math.min(o.params[2],n):o.actionId===80?r+=o.params[0]*n:o.actionId===90||o.actionId===100?r-=o.params[0]*n:e.RESISTANCE_ELEM_IDS_SET.has(o.actionId)&&(n===e.DEFAULT_NB_ELEMENTS||a.has(o.actionId))?r+=o.params[0]:(n===e.DEFAULT_NB_ELEMENTS&&e.MALUS_RESIS_ELEM_IDS_SET.has(o.actionId)||o.actionId===97&&a.has(82)||o.actionId===96&&a.has(84)||o.actionId===98&&a.has(83))&&(r-=o.params[0])}),r}calculMaitrisesForAnItem(i,t,r,n,a,o,s,f){let l=0,E=new Set(r),h=r.filter(u=>!e.MAITRISES_ELEM_IDS_SET.has(u)),c=new Set(h);i.equipEffects.forEach(u=>{!o&&!f&&(u.actionId===120||u.actionId===1068&&u.params[2]>=t||u.actionId===149&&a)?l+=u.params[0]*n:!s&&c.has(u.actionId)?l+=u.params[0]:(!o&&!f&&e.PERTE_MAITRISES_IDS_SET.has(u.actionId)||!s&&(u.actionId===1056&&E.has(149)||u.actionId===181&&E.has(180)||u.actionId===1059&&E.has(1052)||u.actionId===1060&&E.has(1053)||u.actionId===1061&&E.has(1055)))&&(l-=u.params[0])});let d=i.equipEffects.find(u=>e.MAITRISES_ELEM_IDS_SET.has(u.actionId)&&(t===0||t===1&&E.has(u.actionId)));return!o&&!f&&d&&(l+=d.params[0]*n),l}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Si=(t=>(t.Maitrise="maitrise",t.Resistance="resistance",t))(Si||{});var Pt=class e{mapIdItemToElementsMaitrises=new Map;mapIdItemToElementsResistances=new Map;localStorageService=b(ft);init(){let i=this.localStorageService.getItem("KEY_ELEMENT_SELECTOR_MAITRISE");i&&i.length&&(this.mapIdItemToElementsMaitrises.clear(),i.forEach(([r,n])=>{this.mapIdItemToElementsMaitrises.set(r,n)}));let t=this.localStorageService.getItem("KEY_ELEMENT_SELECTOR_RESISTANCE");t&&t.length&&(this.mapIdItemToElementsResistances.clear(),t.forEach(([r,n])=>{this.mapIdItemToElementsResistances.set(r,n)}))}setElementsForItem(i,t,r){this.getMapByType(r).set(i,t),this.saveToLocalStorage(r)}getElementsForItem(i,t){return this.getMapByType(t).get(i)??[]}deleteItem(i){this.deleteElementsForItem(i,"maitrise"),this.deleteElementsForItem(i,"resistance")}deleteElementsForItem(i,t){this.getMapByType(t).delete(i),this.saveToLocalStorage(t)}getMapByType(i){return i==="maitrise"?this.mapIdItemToElementsMaitrises:this.mapIdItemToElementsResistances}saveToLocalStorage(i){let t=i==="maitrise"?"KEY_ELEMENT_SELECTOR_MAITRISE":"KEY_ELEMENT_SELECTOR_RESISTANCE",r=this.getMapByType(i);this.localStorageService.setItem(t,Array.from(r.entries()))}encodeForBuild(){let i=[];if(this.mapIdItemToElementsMaitrises.size>0){let t=Array.from(this.mapIdItemToElementsMaitrises.entries()).map(([r,n])=>`${r}:${n.join(",")}`);t.length>0&&i.push("M|"+t.join("|"))}if(this.mapIdItemToElementsResistances.size>0){let t=Array.from(this.mapIdItemToElementsResistances.entries()).map(([r,n])=>`${r}:${n.join(",")}`);t.length>0&&i.push("R|"+t.join("|"))}return i.join(";")}decodeAndApplyFromBuild(i){if(i)try{this.mapIdItemToElementsMaitrises.clear(),this.mapIdItemToElementsResistances.clear();let t=i.split(";");for(let r of t){if(!r)continue;let[n,...a]=r.split("|"),o=n==="M"?this.mapIdItemToElementsMaitrises:this.mapIdItemToElementsResistances;for(let s of a){if(!s)continue;let[f,l]=s.split(":");if(!f||!l)continue;let E=parseInt(f,10),h=l.split(",").map(c=>parseInt(c,10));!isNaN(E)&&h.length>0&&h.every(c=>!isNaN(c))&&o.set(E,h)}}this.saveToLocalStorage("maitrise"),this.saveToLocalStorage("resistance")}catch(t){console.error("Error decoding element selector data:",t)}}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var Ft=class e{sublimations=new Map;sublimationsClassique=[];sublimationsEpiqueRelique=[];compressionService=b(oe);load(){return this.compressionService.decompressGzipJson(G+"sublimations.json.gz").pipe(g(i=>{i.forEach(t=>this.sublimations.set(t.title.fr,t)),this.sublimationsClassique.push(...i.filter(t=>!t.isEpic&&!t.isRelic)),this.sublimationsEpiqueRelique.push(...i.filter(t=>t.isEpic||t.isRelic))}),de(1),v(()=>{}))}getSublimations(){return this.sublimationsClassique}getSublimationsEpiqueRelique(){return this.sublimationsEpiqueRelique}getSublimationIdByIdLinkSublimation(i){for(let t of this.sublimations.values())if(t.linkSublimation.find(r=>r.id===i))return t.id}getSublimationById(i){for(let t of this.sublimations.values())if(t.id===i)return t}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};function He(){let e=[];for(let i=0;i<4;i++)e.push({color:-1,lvl:0});return{chasses:e,sublimation:void 0}}function En(e){switch(e){case 1:return 3;case 2:return 6;case 3:return 9;case 4:return 12;case 5:return 15;case 6:return 21;case 7:return 30;case 8:return 39;case 9:return 48;case 10:return 60;case 11:return 66;default:return 0}}function cn(e){switch(e){case 1:return 2;case 2:return 4;case 3:return 6;case 4:return 8;case 5:return 10;case 6:return 14;case 7:return 20;case 8:return 26;case 9:return 32;case 10:return 40;case 11:return 44;default:return 0}}function dn(e){switch(e){case 1:return 4;case 2:return 8;case 3:return 12;case 4:return 16;case 5:return 20;case 6:return 28;case 7:return 40;case 8:return 52;case 9:return 64;case 10:return 80;case 11:return 88;default:return 0}}function fn(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 7;case 7:return 10;case 8:return 13;case 9:return 16;case 10:return 20;case 11:return 22;default:return 0}}var _n=class e extends x{static DEFAULT_VALUE=()=>{let i=[];for(let t=0;t<10;t++)i.push(He());return{chasseCombinaison:i}};recapChassesEffect=new p([]);recapChassesEffect$=this.recapChassesEffect.asObservable();enchantement=new p(e.DEFAULT_VALUE());enchantement$=this.enchantement.asObservable();sublimationsIdToLevel=new p(new Map);sublimationsIdToLevel$=this.sublimationsIdToLevel.asObservable();coutEclatTotal=new p(0);coutEclatTotal$=this.coutEclatTotal.asObservable();keyEnum="KEY_ENCHANTEMENT";form=new _(e.DEFAULT_VALUE(),{nonNullable:!0});sublimationService=b(Ft);isLoadingFromUrl=!1;indexToItemType=new Map([[0,8],[1,5],[2,9],[3,3],[4,3],[5,4],[6,6],[7,10],[8,7],[9,2]]);doubleEffect=new Map([[120,[9,6]],[26,[5,10]],[1052,[8,6]],[1053,[7,2]],[1055,[5,6]],[149,[10,2]],[180,[7,4]],[173,[3,3]],[175,[3,3]],[171,[5,6]],[82,[9,7]],[83,[9,10]],[85,[9,6]],[84,[9,4]],[20,[8,2]]]);constructor(){super(),this.init()}generateCodeBuild(i){let t=[];i.chasseCombinaison.forEach(n=>{let a=[];n.chasses.forEach(s=>{if(s.color===-1)a.push("0");else{let f=s.joker?"1":"0",l=s.idAction||0;a.push(`${s.color}.${s.lvl}.${l}.${f}`)}});let o=a.join("-");n.sublimation&&(o+=`_${n.sublimation.id}.${n.sublimation.level}`),t.push(o)});let r=t.join("|");return i.epique&&(r+=`|E${i.epique.id}`),i.relique&&(r+=`|R${i.relique.id}`),r}decodeAndSaveCodeBuild(i){try{let t={chasseCombinaison:[],epique:void 0,relique:void 0};for(let o=0;o<10;o++)t.chasseCombinaison.push(He());let r=i.split("|"),n=[],a=[];for(let o of r)o.startsWith("E")||o.startsWith("R")?a.push(o):o.trim()&&n.push(o);for(let o=0;o<Math.min(10,n.length);o++){let s=n[o],[f,l]=s.split("_"),E=f.split("-"),h=He();for(let c=0;c<Math.min(4,E.length);c++){let d=E[c];if(d==="0"||!d)continue;let u=d.split(".");if(u.length>=4){let[y,S,L,N]=u.map(m=>parseInt(m,10));h.chasses[c]={color:y,lvl:S,idAction:L,joker:N===1}}}if(l){let[c,d]=l.split(".").map(y=>parseInt(y,10)),u=this.sublimationService.getSublimationById(c);u?h.sublimation={id:c,title:K({},u.title),slotColorPattern:u.slotColorPattern,level:d,isValid:!0}:console.warn(`Sublimation ${c} not found in database`)}t.chasseCombinaison[o]=h}for(let o of a)if(o.startsWith("E")){let s=parseInt(o.substring(1),10),f=this.sublimationService.getSublimationById(s);f&&(t.epique={id:f.id,idImage:f.gfxId,title:K({},f.title),epique:!0,relique:!1})}else if(o.startsWith("R")){let s=parseInt(o.substring(1),10),f=this.sublimationService.getSublimationById(s);f&&(t.relique={id:f.id,idImage:f.gfxId,title:K({},f.title),epique:!1,relique:!0})}this.setValue(t)}catch(t){console.error("Error decoding enchantement from URL:",t)}}equalChasses(i,t){return i.color===t.color&&i.lvl===t.lvl&&i.idAction===t.idAction}removeEpic(){let i=this.getValue();i.epique=void 0,this.setValue(i)}removeRelic(){let i=this.getValue();i.relique=void 0,this.setValue(i)}applySublimationEpicRelic(i){let t=this.getValue();i.epique?(t.epique={id:i.id,idImage:i.idImage,title:K({},i.title),epique:!0,relique:!1},this.setValue(t)):i.relique&&(t.relique={id:i.id,idImage:i.idImage,title:K({},i.title),epique:!1,relique:!0},this.setValue(t))}applySumblimation(i,t){let r=this.getValue(),a=r.chasseCombinaison[i];a.sublimation=t,a.sublimation.isValid=this.canApplySublimation(a,t),this.setValue(r)}removeSublimation(i){let t=this.getValue(),n=t.chasseCombinaison[i];n.sublimation=void 0,this.setValue(t)}applyEffect(i,t,r){let n=this.getValue(),o=n.chasseCombinaison[t];this.equalChasses(o.chasses[i],r)?this.clearEffect(i,t):o.chasses[i]=r,o.sublimation&&(o.sublimation.isValid=this.canApplySublimation(o,o.sublimation)),this.setValue(n)}clearChasseCombinaison(i){let t=this.getValue(),r=t.chasseCombinaison;r[i]=He(),this.setValue(t)}clearEffect(i,t){let r=this.getValue(),a=r.chasseCombinaison[t];a.chasses[i]=He().chasses[0],a.sublimation&&(a.sublimation.isValid=this.canApplySublimation(a,a.sublimation)),this.setValue(r)}changeJokerState(i,t){let r=this.getValue(),n=[...r.chasseCombinaison],a=K({},n[t]),o=[...a.chasses],s=K({},o[i]);s.idAction&&(s.joker=!s.joker,o[i]=s,a.chasses=o,n[t]=a,a.sublimation&&(a.sublimation.isValid=this.canApplySublimation(a,a.sublimation)),this.setValue(Ri(K({},r),{chasseCombinaison:n})))}getChasseEffectValue(i){return i.idAction?[173,175].includes(i.idAction)?En(i.lvl):[171].includes(i.idAction)?cn(i.lvl):[20].includes(i.idAction)?dn(i.lvl):[120].includes(i.idAction)?fn(i.lvl):[26,1052,1053,1055,149,180].includes(i.idAction)?Mi(i.lvl):[82,83,85,84].includes(i.idAction)?Ni(i.lvl):0:0}handleChanges(i){if(this.isLoadingFromUrl)return;let t=[],r=0;i.chasseCombinaison.forEach((o,s)=>{o.chasses.forEach(f=>{if(!f.idAction)return;let l=this.indexToItemType.get(s);if(!l)return;let E=this.doubleEffect.get(f.idAction)?.includes(l)?2:1;t.push({id:f.idAction,value:E*this.getChasseEffectValue(f),params:[]}),r+=Pi(f.lvl)})});let n=i.chasseCombinaison.filter(o=>!!o.sublimation).map(o=>o.sublimation),a=this.calculMaxSublimationLevel(n);i.epique&&a.set(i.epique.id,1),i.relique&&a.set(i.relique.id,1),this.sublimationsIdToLevel.next(a),this.enchantement.next(i),this.recapChassesEffect.next(t),this.coutEclatTotal.next(r)}getCodeBuild(){return this.generateCodeBuild(this.enchantement.getValue())}calculMaxSublimationLevel(i){let t=new Map;return i.forEach(r=>{let n=t.get(r.id);n===void 0?t.set(r.id,r.level):t.set(r.id,n+r.level)}),t.forEach((r,n)=>{let a=this.sublimationService.getSublimationById(n)?.levelMax;a!==void 0&&r>a&&t.set(n,Math.min(r,a))}),t}setValue(i){let t=i??e.DEFAULT_VALUE(),r={chasseCombinaison:t.chasseCombinaison.map(n=>({chasses:[...n.chasses],sublimation:n.sublimation?K({},n.sublimation):void 0})),epique:t.epique?K({},t.epique):void 0,relique:t.relique?K({},t.relique):void 0};this.form.setValue(r,{emitEvent:!this.isLoadingFromUrl}),this.isLoadingFromUrl||this.enchantement.next(r)}setDefaultValue(){this.form.setValue(e.DEFAULT_VALUE())}getValue(){return this.enchantement.getValue()}canApplySublimationWithItem(i,t){return this.canApplySublimation(i,{id:t.id,title:K({},t.title),slotColorPattern:t.slotColorPattern,isValid:!1,level:t.linkSublimation[0].level})}canApplySublimation(i,t){let r=i.chasses,n=t.slotColorPattern;if(n.length>r.length)return!1;if(r.filter(o=>o.color===-1).length>=2)return!0;for(let o=0;o<=r.length-n.length;o++)if(this.matchPattern(r,n,o))return!0;return!1}matchPattern(i,t,r){for(let n=0;n<t.length;n++){let a=i[r+n],o=t[n];if(a.color===-1)return!1;if(!(a.joker&&this.isValidJokerReplacement(o))&&a.color!==o)return!1}return!0}isValidJokerReplacement(i){return i===3||i===1||i===2}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};var un=class e extends wi{itemTypeService=b(he);itemService=b(xt);localStorageService=b(ft);modifierElemMaitrisesFormService=b(ke);resistancesFormService=b(ze);maitrisesFormService=b(Ze);onlyNoElemFormService=b(Qe);onlyNoSecondaryFormService=b(De);elementSelectorService=b(Pt);mapItem=new Map([[2,new p([void 0])],[3,new p([void 0,void 0])],[4,new p([void 0])],[5,new p([void 0])],[6,new p([void 0])],[7,new p([void 0])],[8,new p([void 0])],[9,new p([void 0])],[10,new p([void 0])],[11,new p([void 0])],[12,new p([void 0])],[14,new p([void 0])]]);idItems=new p("");idItems$=this.idItems.asObservable();totalWeight=new p(0);totalWeight$=this.totalWeight.asObservable();listItem=new p([]);listItem$=this.listItem.asObservable();totalMaitrises=new p(0);totalMaitrises$=this.totalMaitrises.asObservable();totalResistances=new p(0);totalResistances$=this.totalResistances.asObservable();indexAnneau=0;constructor(){super(),this.initItemsDirectly(),this.handleCalculTotal()}handleCalculTotal(){V([this.listItem$,this.maitrisesFormService.nbElements$,this.maitrisesFormService.idMaitrises$,this.modifierElemMaitrisesFormService.multiplicateurElem$,this.modifierElemMaitrisesFormService.denouement$,this.resistancesFormService.idResistances$,this.onlyNoElemFormService.onlyNoElem$,this.onlyNoSecondaryFormService.onlyNoSecondary$,this.modifierElemMaitrisesFormService.chaos$]).pipe(kt(this.destroy$),g(([i,t,r,n,a,o,s,f,l])=>this.calculTotal(i,t,r,n,o,a,s,f,l))).subscribe()}updateUrl(){V([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(kt(this.destroy$),v(i=>i.flat()),v(i=>i.filter(t=>t!=null)),g(i=>this.listItem.next([...new Set(i)])),v(i=>i.map(t=>t?.id)),v(i=>i.filter(t=>t).join(",")),Li(),g(i=>this.setIdItems(i))).subscribe(i=>{this.localStorageService.setItem("KEY_BUILD",i)})}initItemsDirectly(){let i=this.localStorageService.getItem("KEY_BUILD")||"";i&&i.trim()!==""&&(this.idItems.next(i),i.split(",").forEach(r=>{let n=parseInt(r);isNaN(n)||this.setItemWithIdItem(n)})),this.updateUrl()}calculTotal(i,t,r,n,a,o,s,f,l){let E=0,h=0,c=0;i.forEach(d=>{let u=this.itemService.calculResistancesForAnItem(d,a),y=this.itemService.calculMaitrisesForAnItem(d,t,r,n,o,s,f,l);h+=u,c+=y,E+=_t(u,y,d.level)}),this.totalWeight.next(Math.trunc(E)),this.totalMaitrises.next(Math.trunc(c)),this.totalResistances.next(Math.trunc(h))}setItemWithIdItem(i){this.itemService.searchItem(i).pipe(se(),Z(t=>t!==void 0)).subscribe(t=>{let r=this.itemTypeService.getItemType(t.itemTypeId);r&&this.setItem(r,t,!1)})}cleanItemChoosen(){this.indexAnneau=0,this.mapItem.forEach((i,t)=>{i.next(t===3?[void 0,void 0]:[void 0])})}setIdItemsFromBuild(i){this.cleanItemChoosen(),this.idItems.next(i);let t=i.split(",");t&&t.forEach(r=>{let n=this.itemService.getItem(parseInt(r));if(!n)return;let a=this.itemTypeService.getItemType(n.itemTypeId);a&&this.setItem(a,n,!1)})}setIdItems(i){this.idItems.next(i)}getIdItems(){return this.idItems.getValue()}getObsItem(i){return this.mapItem.get(i)?.asObservable()??z()}deleteItem(i,t){this.getObsItem(i).pipe(se(),te(r=>Dt(()=>r!==void 0&&!!r[0]?.itemTypeId&&this.itemTypeService.getItemType(r[0]?.itemTypeId)===1,z(r).pipe(g(()=>{this.deleteElementItem(12),this.deleteElementItem(2),this.mapItem.get(12)?.next([void 0]),this.mapItem.get(2)?.next([void 0])})),z(r).pipe(v(n=>(this.deleteElementItem(i,t),n[t]=void 0,n)),g(n=>this.mapItem.get(i)?.next(n)))))).subscribe()}setItem(i,t,r=!0){let n=this.changeElements(t);z(null).pipe(se(),te(()=>Dt(()=>r,this.deleteItemInBuild(n).pipe(Z(a=>!a)),z(null))),te(()=>this.ensureUniqueRelic(n)),te(()=>this.ensureCompatibleWithSecondHand(i,n)),te(()=>this.ensureCompatibleWithFirstHand(i,n)),te(()=>this.handleRings(i,n)),te(()=>this.handleDeuxMains(i,n)),te(()=>this.finalEquip(i,n))).subscribe()}ensureUniqueRelic(i){return[7,5].includes(i.rarity)?this.deleteFirstItemOnRarity(i.rarity):z(null)}ensureCompatibleWithSecondHand(i,t){return[13,12].includes(i)?this.getObsItem(2).pipe(se(),g(()=>{this.deleteElementItem(12),this.mapItem.get(12)?.next([t])}),v(r=>r[0]),Z(r=>r!==void 0&&this.itemTypeService.getItemType(r.itemTypeId)===1),g(()=>{this.deleteElementItem(2),this.mapItem.get(2)?.next([void 0])}),v(()=>null)):z(null)}ensureCompatibleWithFirstHand(i,t){return i!==2?z(null):this.getObsItem(12).pipe(se(),g(()=>{this.deleteElementItem(2),this.mapItem.get(2)?.next([t])}),v(r=>r[0]),Z(r=>r!==void 0&&this.itemTypeService.getItemType(r.itemTypeId)===1),g(()=>{this.deleteElementItem(12),this.mapItem.get(12)?.next([void 0])}),v(()=>null))}handleRings(i,t){return i!==3?z(null):this.getObsItem(3).pipe(se(),te(r=>r.find(n=>n?.title.fr===t.title.fr)?z(null).pipe(g(()=>{let n=this.mapItem.get(3)?.value;this.mapItem.get(3)?.next(n)})):z(r).pipe(v(n=>{let a=[...n];return this.deleteElementItem(3,this.indexAnneau),a[this.indexAnneau]=t,a}),g(n=>this.mapItem.get(3)?.next(n)),g(()=>this.indexAnneau=this.indexAnneau===0?1:0))),v(()=>null))}handleDeuxMains(i,t){return i!==1?z(null):z(null).pipe(g(()=>{this.deleteElementItem(12),this.deleteElementItem(2),this.mapItem.get(12)?.next([t]),this.mapItem.get(2)?.next([t])}))}finalEquip(i,t){return i===3?z(null):z(null).pipe(g(()=>{this.deleteElementItem(i),this.mapItem.get(i)?.next([t])}))}changeElements(i){let t=structuredClone(i);return this.changeElementsMaitrise(t),this.changeElementsResistance(t),t}changeElementsMaitrise(i){let t=i.equipEffects.find(r=>r.actionId===1068);if(t){let r=t.params[2],n=i.equipEffects.indexOf(t);n>-1&&i.equipEffects.splice(n,1);let a=this.elementSelectorService.getElementsForItem(i.id,"maitrise");a.length===0&&(a=this.maitrisesFormService.orderMaitrises());for(let o=0;o<r;o++)i.equipEffects.push({id:Ci,actionId:a[o],params:t.params});this.elementSelectorService.setElementsForItem(i.id,a.slice(0,r),"maitrise")}}changeElementsResistance(i){let t=i.equipEffects.find(r=>r.actionId===1069);if(t){let r=t.params[2],n=i.equipEffects.indexOf(t);n>-1&&i.equipEffects.splice(n,1);let a=this.elementSelectorService.getElementsForItem(i.id,"resistance");a.length===0&&(a=this.resistancesFormService.orderResistances());for(let o=0;o<r;o++)i.equipEffects.push({id:Oi,actionId:a[o],params:t.params});this.elementSelectorService.setElementsForItem(i.id,a.slice(0,r),"resistance")}}deleteFirstItemOnRarity(i){return V([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(se(),v(t=>t.filter(r=>r.find(n=>n?.rarity===i))),g(t=>t.forEach(r=>{let n=r.find(o=>o!==void 0)?.itemTypeId;if(!n)return;let a=this.itemTypeService.getItemType(n);if(a===1){let o=this.mapItem.get(2);this.elementSelectorService.deleteItem(o?.value[0]?.id??0);let s=this.mapItem.get(12);this.elementSelectorService.deleteItem(s?.value[0]?.id??0),this.mapItem.get(2)?.next([void 0]),this.mapItem.get(12)?.next([void 0])}else if(a===13){let o=this.mapItem.get(12);this.elementSelectorService.deleteItem(o?.value[0]?.id??0),this.mapItem.get(12)?.next([void 0])}else if(a===3){let o=r.findIndex(f=>f?.rarity===i);this.indexAnneau=o;let s=r[o]?.id??0;this.elementSelectorService.deleteItem(s),r[o]=void 0,this.mapItem.get(3)?.next(r)}else if(a!==void 0){let o=this.mapItem.get(a);this.elementSelectorService.deleteItem(o?.value[0]?.id??0),this.mapItem.get(a)?.next([void 0])}})),v(()=>null))}deleteElementItem(i,t=0){let r=this.mapItem.get(i);r&&this.elementSelectorService.deleteItem(r?.value[t]?.id??0)}deleteItemInBuild(i){let t=!1;return V([this.getObsItem(2),this.getObsItem(3),this.getObsItem(4),this.getObsItem(5),this.getObsItem(6),this.getObsItem(7),this.getObsItem(8),this.getObsItem(9),this.getObsItem(10),this.getObsItem(11),this.getObsItem(12),this.getObsItem(14)]).pipe(se(),v(r=>r.filter(n=>n.find(a=>a?.id===i.id))),g(r=>r.forEach(n=>{let a=n.find(s=>s!==void 0)?.itemTypeId;if(!a)return;t=!0;let o=this.itemTypeService.getItemType(a);if(o===1)this.deleteElementItem(2),this.deleteElementItem(12),this.mapItem.get(2)?.next([void 0]),this.mapItem.get(12)?.next([void 0]);else if(o===13)this.deleteElementItem(12),this.mapItem.get(12)?.next([void 0]);else if(o===3){let s=n.findIndex(f=>f?.id===i.id);this.deleteElementItem(3,s),n[s]=void 0,this.indexAnneau=s,this.mapItem.get(3)?.next(n)}else o!==void 0&&(this.deleteElementItem(o),this.mapItem.get(o)?.next([void 0]))})),v(()=>t))}static \u0275fac=function(t){return new(t||e)};static \u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"})};export{ls as a,Ci as b,Oi as c,mn as d,G as e,Es as f,cs as g,_t as h,pn as i,Bt as j,ds as k,oe as l,yt as m,Ii as n,he as o,Fe as p,Mt as q,De as r,Ve as s,an as t,ke as u,Be as v,$e as w,Nt as x,ze as y,Ze as z,Qe as A,Ct as B,Ot as C,Ut as D,wt as E,xt as F,Si as G,Pt as H,un as I,He as J,Ft as K,_n as L};
