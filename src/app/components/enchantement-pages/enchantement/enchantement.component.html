<!-- eslint-disable @angular-eslint/template/interactive-supports-focus -->
<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
 <div class="container" 
    [style.cursor]="effectToApply() ? 'url(cursor/' + imageService.getChasseColorUrl(effectToApply()!.chasse) + ') 16 16, auto' : 'default'">
    @if (chasses() && enchantement()) {
        <div class="column">
            <div class="card">
                <div class="header">
                    <span>{{ 'enchantement.chasses' | translate }}</span>
                    <button (click)="chasseFormService.setDefaultValue()">X</button>
                </div>
                <div class="body">
                    <mat-slider min="1" [max]="maxLevel" step="1" showTickMarks discrete >
                        <input matSliderThumb [(ngModel)]="level">
                    </mat-slider>

                    @for (chasse of chasses(); track $index) {
                        @let indexParent = $index;
                        <div class="group-item-chasses"
                            [class.selected]="indexItemTypeSelected() === $index"
                        >
                            <app-image-item
                                [itemType]="displayTypeItem[$index].itemType" 
                                [indexItem]="displayTypeItem[$index].indexItem"
                                [backgroundItemType]="displayTypeItem[$index].background"
                                (level)="setLevelItem($any($event), indexParent)"
                                (click)="selectItemType(displayTypeItem[$index].itemType, $index)"
                            ></app-image-item>
                            @for (c of chasse.chasses; track $index) {
                                <div class="container-image"
                                    (click)="applyEffet($index, indexParent, getLevelItem(indexParent))"
                                    (contextmenu)="$event.preventDefault(); changeJokerState($index, indexParent);"
                                    [style.cursor]="cursorDestructStyle(c, effectToApply())"
                                    >
                                    <img [src]="imageService.getChasseColorUrl(c)" [alt]="">
                                    @if(c.idAction) {
                                        <div class="action-image" (dblclick)="chasseFormService.clearEffect(indexParent, $index)"> 
                                            <span>{{c.lvl}}</span>
                                            <img [src]="imageService.getActionIdUrl(c.idAction)" [alt]="">
                                        </div>
                                    }
                                </div>
                            }
                            <button class="delete" (click)="chasseFormService.clearChasseCombinaison(indexParent)">X</button>
                            <div class="sublimations"
                                [class.invalid]="chasse.sublimation && !chasse.sublimation.isValid"
                                (click)="applySublimation(indexParent)"
                                (contextmenu)="$event.preventDefault();chasseFormService.removeSublimation(indexParent);">
                                <img [src]="imageService.getItemTypeUrl(ItemTypeEnum.SUBLIMATIONS)"
                                        (click)=" selectItemType(displayTypeItem[$index].itemType, $index)" 
                                        (mouseenter)="openTooltip($event, chasse.sublimation, chasse.sublimation?.level || 1)" 
                                        (mouseleave)="onMouseLeave()" alt="">
                                <span>{{ nameSublimation(chasse.sublimation) }}</span>
                            </div>
                        </div>
                    }
                    <div class="epique-relique">
                        <div class="epique" 
                            (click)="chasseFormService.removeEpic()"
                            (contextmenu)="$event.preventDefault();chasseFormService.removeEpic();">
                            @if(enchantement()?.epique) {
                                <img [src]="imageService.getItemUrl(enchantement()!.epique!.idImage)"
                                    (mouseenter)="openTooltip($event, enchantement()?.epique, 1)"
                                    (mouseleave)="onMouseLeave()" alt="">
                                <span>{{ nameSublimationEpicRelic(enchantement()!.epique) }}</span>
                            } @else {
                                <img src="chasses/shardEpique.png" alt="">
                            }
                        </div>
                        <div class="relique"
                            (click)="chasseFormService.removeRelic()"
                            (contextmenu)="$event.preventDefault();chasseFormService.removeRelic();">
                            @if(enchantement()?.relique) {
                                <img [src]="imageService.getItemUrl(enchantement()!.relique!.idImage)"
                                    (mouseenter)="openTooltip($event, enchantement()?.relique, 1)"
                                    (mouseleave)="onMouseLeave()" alt="">
                                <span>{{ nameSublimationEpicRelic(enchantement()!.relique) }}</span>
                            } @else {
                                <img src="chasses/shardRelique.png" alt="">
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="column">
            <div class="card">
                <div class="header">
                    {{ 'enchantement.effets' | translate }}
                </div>
                <div class="body">
                    @for(effet of effetsDescription; track $index) {
                        <button class="effets-description" (click)="chooseEffet(effet)" [class.selected]="effectToApply() && effectToApply()?.id === effet.id"
                            [class.double]="effectIsDouble(effet)">
                            <img [src]="imageService.getChasseColorUrl(effet.chasse)" [alt]="">
                            <span>{{ effet.libelle | translate }}</span>
                            <div class="logos">
                                @for(logo of effet.logos; track $index) {
                                    <img [src]="itemTypeService.getLogo(logo)" [alt]="">
                                }
                            </div>
                        </button>
                    }
                </div>
            </div>
        </div>

        
        <div class="column">
            <div class="card">
                <div class="header">
                    Sublimations
                </div>
                <div class="body">
                    <input matInput [ngModel]="searchSubli()" (ngModelChange)="searchSubli.set($event)" [placeholder]="'enchantement.recherche-sublimation' | translate">

                    <div class="slider-container">
                        @for(sublimation of sublimationsList(); track $index) {
                            <div class="subli-container"
                                [class.selected]="sublimationToApply() && sublimationToApply()!.id === sublimation.id">
                                <span>{{nameItem(sublimation)}}</span>
                                <div class="row">
                                    <div>
                                        @for(chasse of sublimation.slotColorPattern; track $index) {
                                            <img [src]="imageService.getChasseColorUrlById(chasse)" [alt]="">
                                        }
                                    </div>
                                    <div>
                                        @for(linkSublimation of sublimation.linkSublimation; track $index) {
                                            <img class="parchemins" (click)="chooseSublimation(sublimation, linkSublimation.level)"
                                                (mouseenter)="openTooltip($event, sublimation, linkSublimation.level)" 
                                                (mouseleave)="onMouseLeave()"
                                                [src]="getUrlSublimationImage(linkSublimation)" [alt]=""
                                                [class.parchemins-selected]="sublimationToApply() && sublimationToApply()!.id === sublimation.id
                                                    && levelSublimationToApply() === linkSublimation.level">
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="slider-container">
                        @for(sublimation of sublimationsEpiqueReliqueList(); track $index) {
                            <div class="subli-container" (click)="chooseSublimation(sublimation, 1)"
                                [class.selected]="sublimationToApply() && sublimationToApply()!.id === sublimation.id"
                                (click)="applySublimationEpicRelic()">
                                <span>{{nameItem(sublimation)}}</span>
                                <div>
                                    <img
                                        (mouseenter)="openTooltip($event, sublimation, 1)" 
                                        (mouseleave)="onMouseLeave()"
                                     [src]="imageService.getItemUrl(sublimation.gfxId)" [alt]="">
                                </div>
                            </div>
                        }
                    </div>
                    
                </div>
            </div>
        </div>

    }
</div>