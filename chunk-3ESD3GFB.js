import{a as ke,b as Ve}from"./chunk-3R7V6IAG.js";import{a as we,c as Be,d as je}from"./chunk-FFSXMI3B.js";import{a as xe,b as Ne,c as De,d as Ue}from"./chunk-UYAXF2SK.js";import{A as oe,B as $e,e as ie,f as $,g as ae,i as Le,y as ne,z as _e}from"./chunk-7XV3FTFP.js";import{$a as D,Bb as G,Bd as be,Cb as v,D as Ce,Da as Re,Db as Te,Eb as w,Fb as P,Ga as O,Ja as ge,Jb as Ae,Ka as Z,Kb as Pe,Lb as Me,M as X,N as ve,Ob as ye,P as V,Pb as E,Q as h,Qb as f,Rb as Oe,U as R,Vd as Fe,Ya as I,Z as s,_a as S,bb as x,c as Ie,ca as g,cb as N,cc as K,da as T,db as d,eb as m,f as Se,fb as l,g as y,gb as C,hb as de,ib as fe,kb as b,mb as A,o as _,ob as c,oc as Y,p as j,pc as L,qa as he,vd as F,wa as u,wd as ee,xa as r,xd as te,y as ue,yc as J,yd as B,zb as q}from"./chunk-BJQECC5Y.js";import{a as z,b as H}from"./chunk-6MDQTQU3.js";var Qe=class a{isDisplayed=new y(!1);isDisplayed$=this.isDisplayed.asObservable();toggleDisplay(){this.isDisplayed.next(!this.isDisplayed.value)}setDisplay(e){this.isDisplayed.next(e)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var re=class a{condition=new Map;http=s(J);loadPromise;load(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(e=>{this.http.get("/itemConditions.json").pipe(h(t=>t.forEach(i=>this.condition.set(i.id,i))),X(1)).subscribe({next:()=>e(),error:t=>{console.error("Failed to load monster drops:",t),e()}})}),this.loadPromise)}findCondition(e){return this.condition.get(e)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var se=class a{stateDefinitionService=new Map;http=s(J);loadPromise;load(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(e=>{this.http.get("/statesDefinition.json").pipe(h(t=>t.forEach(i=>this.stateDefinitionService.set(i.id,{id:i.id,description:{fr:i.description.fr,en:i.description.en,es:i.description.es,pt:i.description.pt}}))),X(1)).subscribe({next:()=>e(),error:t=>{console.error("Failed to load monster drops:",t),e()}})}),this.loadPromise)}findStatesDefinition(e){return this.stateDefinitionService.get(e)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var k=class a{translateService=s(F);ankamaCdnFacade=s($);static malusActions=new Set([21,40,56,57,90,96,97,98,100,130,132,161,168,172,174,176,181,192,194,876,1056,1059,1060,1061,1062,1063]);static opposedEffects=new Map;static opposedPairs=[[20,21],[39,40,!0],[80,90],[84,96],[82,97],[83,98],[80,100],[120,130],[122,132],[150,168],[171,172],[173,174],[175,176],[180,181],[191,192],[193,194],[875,876],[149,1056],[1052,1059],[1053,1060],[1055,1061],[988,1062],[71,1063],[31,56],[41,57],[160,161]];constructor(){for(let[e,t]of a.opposedPairs)a.opposedEffects.set(e,t),a.opposedEffects.set(t,e)}getEffectById(e){let t=this.ankamaCdnFacade.getActionList().find(i=>i.definition.id===e);return t?`${t.description[this.translateService.currentLang]}`:""}isAMalus(e){return a.malusActions.has(e)}isOpposed(e,t){let i=e.actionId,n=t.actionId;for(let[o,p,U]of a.opposedPairs)if((i===o||n===o)&&(i===p||n===p))return U?e.params[4]===t.params[4]:!0;return!1}getOpposedEffect(e){return a.opposedEffects.get(e)??e}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var Q=class a{ankamaCdnFacade=s($);translateService=s(F);actionService=s(k);transform(e){return j([this.translateService.onLangChange.pipe(ve({lang:this.translateService.currentLang,translations:{}})),this.ankamaCdnFacade.action$]).pipe(_(([,t])=>t),_(t=>this.findAction(t,e)),_(t=>this.getDefinitions(t)),_(t=>this.getDefinitionsComplete(t,e)))}getDefinitionsComplete(e,t){let i=`${e}`;return i=this.replaceValues(i,t),i=this.cleanHeaderDefinition(i),i=this.cleanRecoltEffect(i),i=this.singularOrPlurial(i,t),i=this.atLeastSixParameters(i,t),i=this.armorGivenOrReceived(i,t),i=this.deleteDoubleMinus(i),i}deleteDoubleMinus(e){return e.replace(/--/g,"")}armorGivenOrReceived(e,t){if(t.actionId!==39&&t.actionId!==40)return e;let i=t.params[4]===120?this.translateService.instant("abstract.donnee"):this.translateService.instant("abstract.recue"),n=Math.abs(t.params[0]),o=this.actionService.isAMalus(t.actionId);return(o&&t.params[0]>0||!o&&t.params[0]<0?"-":"")+n+this.translateService.instant("abstract.armure")+i}atLeastSixParameters(e,t){let i=/{\[~3\]\?(.*):(.*)}/,n=e.match(i);return n&&(e=n[t.params.length>=6?1:2]),e}singularOrPlurial(e,t){return e=this.singularOrPlurialWithRegex(e,t,/\{\[>2\]\?([^}]){0,5}:([^}]){0,5}\}/g,2),e=this.singularOrPlurialWithRegex(e,t,/\{\[>1\]\?([^}]){0,5}:([^}]){0,5}\}/g),e}singularOrPlurialWithRegex(e,t,i,n=0){let o=[...e.matchAll(i)];if(o&&t.params.length>n){let p=o.map(U=>U[t.params[n]>=2?1:2]);for(let U=0;U<o.length;U++)e=e.replace(o[U][0],p[U]??"")}return e}cleanDefinition(e,t){let i=e.match(t);return i&&(e=e.replace(i[0],"")),e}cleanRecoltEffect(e){return this.cleanDefinition(e,/{\[~2]?.+}/g)}cleanHeaderDefinition(e){return this.cleanDefinition(e,/(\[#.*\]) /g)}replaceValues(e,t){let i=/(\[#\d\])/g,n=[...e.matchAll(i)].map(o=>o[1]);if(n)for(let o of n){let p=0;switch(o){case"[#1]":p=0;break;case"[#2]":p=2;break;case"[#3]":p=4;break}t.params.length>p&&(e=e.replace(o,t.params[p].toString()))}return e}getDefinitions(e){return e.description[this.translateService.currentLang]}findAction(e,t){return e.filter(i=>i.definition.id===t.actionId)[0]}static \u0275fac=function(t){return new(t||a)};static \u0275pipe=ge({name:"actions",type:a,pure:!0})};var pe=class a{AnkamaCdnFacade=s($);findStates(e){let t=this.AnkamaCdnFacade.getStatesList().find(i=>i.definition.id===e);if(t)return{id:t.definition.id,fr:t.title.fr,en:t.title.en,es:t.title.es,pt:t.title.pt}}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var W=class a{translateService=s(F);itemTypeService=s(Le);itemChooseService=s(oe);actionsService=s(k);statesService=s(pe);imageService=s(be);destroy$=new Se;resistances=0;maitrises=0;IdActionEnum=B;mapSortAction=new Map([[31,0],[56,1],[41,2],[57,3],[193,4],[191,4],[192,5],[184,6],[160,7],[161,8],[20,9],[21,10],[173,11],[175,12],[172,13],[875,14],[174,15],[176,16],[876,17],[120,18],[1068,19],[149,20],[180,21],[26,22],[1055,23],[1053,24],[1052,25],[1056,26],[181,27],[1061,28],[1060,29],[1059,30],[150,31],[39,32],[168,33],[40,34],[988,35],[71,36],[80,37],[1069,38],[82,39],[83,40],[85,41],[84,42],[1062,43],[1063,44],[90,45],[97,46],[98,47],[96,48]]);Math=Math;itemChoosen$=new y([[]]);IdActionsEnum=B;getEffectPng(e){return this.imageService.getActionIdUrl(e.actionId,e.actionId===39&&e.params[4]===121)}initItemChoosen(e){let t=this.itemTypeService.getItemType(e.itemTypeId);if(!t)return;let i=new Ie;t===13?i=this.itemChooseService.getObsItem(12).pipe(_(n=>[n])):t===1?i=j([this.itemChooseService.getObsItem(2),this.itemChooseService.getObsItem(12)]).pipe(_(([n,o])=>[n,o])):i=this.itemChooseService.getObsItem(t).pipe(_(n=>[n])),i.pipe(V(this.destroy$)).subscribe(n=>this.itemChoosen$.next(n))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-item"]],decls:0,vars:0,template:function(t,i){},encapsulation:2})};function Xe(a,e){if(a&1&&(m(0,"div",0)(1,"span"),C(2,"img",7),v(3),E(4,"translate"),l(),m(5,"span"),C(6,"img",8),v(7),E(8,"translate"),l()()),a&2){let t=c();r(),G(t.getBackgroundDifferentsStatsOnValue(t.maitrises)),r(),d("src",t.imageService.getActionIdUrl(t.IdActionEnum.MAITRISES_ELEMENTAIRES),u),r(),P("",f(4,10,"item.maitrises")," ",t.Math.trunc(t.maitrises)),r(2),G(t.getBackgroundDifferentsStatsOnValue(t.resistances)),r(),d("src",t.imageService.getActionIdUrl(t.IdActionEnum.RESISTANCES_ELEMENTAIRE),u),r(),P("",f(8,12,"item.resistances")," ",t.resistances)}}function Ze(a,e){if(a&1&&(m(0,"div",4)(1,"h3"),v(2),l(),C(3,"img",9),l()),a&2){let t=e.$implicit,i=c(2);r(),q("color",i.colorRarityService.mapColors.get(t.rarity)),r(),P("",i.getTitle(t)," (",t.level,")"),r(),d("src",i.imageService.getItemUrl(t.idImage),u)}}function Ke(a,e){a&1&&x(0,Ze,4,5,"div",4,D),a&2&&N(e)}function Ye(a,e){if(a&1&&(C(0,"img",11),v(1),E(2,"actions"),E(3,"async")),a&2){let t=c().$implicit,i=c(2);d("src",i.getEffectPng(t),u),r(),w(" ",f(3,4,f(2,2,t))," ")}}function Je(a,e){if(a&1&&(m(0,"p"),I(1,Ye,4,6),l()),a&2){let t=e.$implicit,i=c(2);G(i.getBackgroundDifferentsStats(t)),r(),S(t.actionId!==i.IdActionEnum.APPLIQUE_ETAT&&t.value!==0?1:-1)}}function et(a,e){a&1&&(m(0,"div"),x(1,Je,2,3,"p",10,D),l()),a&2&&(r(),N(e))}var le=class a extends W{itemService=s(ne);colorRarityService=s(ae);cdr=s(K);item;indexItemChoosen=0;ARMURE_DONNEE_RECUE=[39,40];listDifferentsStatsItem=[];loaded$;weight=0;itemSelected$=this.itemChoosen$.pipe(ue(e=>e.length!==0),_(e=>e.map(t=>t[this.indexItemChoosen])),_(e=>e.length>=2&&e[0]?.id===e[1]?.id?[e.find(t=>t!==void 0)]:e),_(e=>e.filter(t=>t!==void 0)));differentStatsItemList$=this.itemSelected$.pipe(V(this.destroy$),h(e=>{this.listDifferentsStatsItem=[],this.fillListCurrentItem(),e.forEach(t=>t?this.fillMapDifferentStatsItem(t):"")}),_(()=>this.listDifferentsStatsItem.sort((e,t)=>(this.mapSortAction.get(e.actionId)??999)-(this.mapSortAction.get(t.actionId)??999))));constructor(){super()}ngAfterViewInit(){this.item&&(this.item.equipEffects=this.item.equipEffects.sort((e,t)=>(this.mapSortAction.get(e.actionId)??999)-(this.mapSortAction.get(t.actionId)??999)),this.loaded$=this.itemSelected$.pipe(V(this.destroy$),_(e=>(this.resistances=this.item.resistance,this.maitrises=this.item.maitrise,this.weight=this.itemService.calculWeight(this.resistances,this.maitrises,this.item.level),e.forEach(t=>{t&&(this.resistances-=t.resistance,this.maitrises-=t.maitrise,this.weight=this.itemService.calculWeight(this.resistances,this.maitrises,t.level))}),!0))),this.initItemChoosen(this.item),this.cdr.detectChanges())}setItem(e){let t=this.itemTypeService.getItemType(e.itemTypeId);t&&this.itemChooseService.setItem(t,e)}getTitle(e){return e?e.title[this.translateService.currentLang]:""}getBackgroundDifferentsStatsOnValue(e){return e>0?"green":e<0?"red":""}getBackgroundDifferentsStats(e){let t=this.actionsService.isAMalus(e.actionId);return e.value>0&&!t||e.value<0&&t||e.presentOnCurrentItem&&!e.presentOnEquippedItem&&!t?"green":e.value<0&&!t||e.value>0&&t||!e.presentOnCurrentItem&&e.presentOnEquippedItem&&t?"red":""}getByActionId(e,t){return this.listDifferentsStatsItem.find(i=>i.actionId===e&&i.isArmureRecue===t)}pushSetDifferentsStatsItem(e){e&&(this.listDifferentsStatsItem=this.listDifferentsStatsItem.filter(t=>t.actionId!==e.actionId||t.isArmureRecue!==e.isArmureRecue),this.listDifferentsStatsItem.push(e))}fillListCurrentItem(){this.item.equipEffects.forEach(e=>{let t=this.ARMURE_DONNEE_RECUE.includes(e.actionId)&&e.params[4]===121,i=this.getByActionId(e.actionId,t);if(i){let n=i.params;n[0]+=e.params[0],i=H(z({},i),{value:i.value+e.params[0],params:n,presentOnCurrentItem:!0})}else i={value:e.params[0],params:[...e.params],actionId:e.actionId,presentOnCurrentItem:!0,presentOnEquippedItem:!1,isArmureRecue:t};this.pushSetDifferentsStatsItem(i)})}fillMapDifferentStatsItem(e){e.equipEffects.forEach(t=>{let i=this.ARMURE_DONNEE_RECUE.includes(t.actionId)&&t.params[4]===121,n=this.getByActionId(t.actionId,i),o=this.item.equipEffects.find(p=>this.actionsService.isOpposed(p,t));if(o){let p=[...t.params];p[0]=o.params[0]+p[0],n={value:o.params[0]+t.params[0],params:p,actionId:o.actionId,presentOnCurrentItem:!0,presentOnEquippedItem:!0,isArmureRecue:i}}else if(n&&n.isArmureRecue===i){let p=n.params;p[0]-=t.params[0],n=H(z({},n),{value:n.value-t.params[0],params:p,presentOnEquippedItem:!0})}else{let p=[...t.params];p[0]=-p[0],n={value:-t.params[0],params:p,actionId:t.actionId,presentOnCurrentItem:!1,presentOnEquippedItem:!0,isArmureRecue:i}}this.pushSetDifferentsStatsItem(n)}),this.calculDifferenceResistance()}calculDifferenceResistance(){let e=this.getByActionId(80,!1),t=[82,83,85,84];e&&t.find(i=>this.getByActionId(i,!1))&&(t.forEach(i=>{let n=this.getByActionId(i,!1);n?(n.params[0]+=e.params[0],n.value+=e.params[0],n.presentOnCurrentItem=!0,n.presentOnEquippedItem=!0):n=H(z({},e),{actionId:i,presentOnCurrentItem:!0,presentOnEquippedItem:!0}),this.pushSetDifferentsStatsItem(n)}),this.listDifferentsStatsItem=this.listDifferentsStatsItem.filter(i=>i.actionId!==80))}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-item-tooltip"]],inputs:{item:"item",indexItemChoosen:"indexItemChoosen"},features:[Z],decls:17,vars:21,consts:[[1,"header"],[1,"content",3,"click"],[1,"column"],[1,"row"],[1,"title"],["alt","item",3,"src"],["alt","poids",3,"src"],["alt","Maitrises",3,"src"],["alt","Resistances",3,"src"],["appFallback","","alt","items",3,"src"],[3,"class"],["alt","aptitudes",3,"src"]],template:function(t,i){if(t&1&&(I(0,Xe,9,14,"div",0),E(1,"async"),m(2,"div",1),A("click",function(){return i.setItem(i.item)}),m(3,"div",2)(4,"div",3)(5,"div",4)(6,"h3"),v(7),l(),C(8,"img",5),l(),I(9,Ke,2,0),E(10,"async"),l(),m(11,"span"),C(12,"img",6),v(13),E(14,"translate"),l()(),I(15,et,3,0,"div"),E(16,"async"),l()),t&2){let n,o;S(f(1,13,i.loaded$)?0:-1),r(6),q("color",i.colorRarityService.mapColors.get(i.item.rarity)),r(),P("",i.getTitle(i.item)," (",i.item.level,")"),r(),d("src",i.imageService.getItemUrl(i.item.idImage),u),r(),S((n=f(10,15,i.itemSelected$))?9:-1,n),r(2),G(i.getBackgroundDifferentsStatsOnValue(i.weight)+" poids"),r(),d("src","aptitudes/poids.png",u),r(),P("",f(14,17,"item.poids")," ",i.weight," "),r(2),S((o=f(16,19,i.differentStatsItemList$))?15:-1,o)}},dependencies:[L,te,ie,Y,ee,Q],styles:["[_nghost-%COMP%]{background:linear-gradient(145deg,#0d1b2a,#415a77);border-radius:15px;padding:5px;color:#fff;height:fit-content;width:600px;display:flex;flex-direction:column;box-shadow:0 8px 8px #0009;position:relative}[_nghost-%COMP%]   span[_ngcontent-%COMP%]{border-radius:10px;width:200px;display:flex;justify-content:space-around;align-items:center;margin:2px auto}[_nghost-%COMP%]   .green[_ngcontent-%COMP%]{background:linear-gradient(145deg,#4caf50,#00c896)}[_nghost-%COMP%]   .red[_ngcontent-%COMP%]{background:linear-gradient(145deg,#e63946,#ff6b35)}[_nghost-%COMP%]   .green[_ngcontent-%COMP%], [_nghost-%COMP%]   .red[_ngcontent-%COMP%]{color:#0d1b2a}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;border-bottom:3px solid #415A77;margin-bottom:10px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:0 10px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px;cursor:pointer}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{width:50px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:space-around;cursor:pointer}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-around;align-items:center}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-around}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{margin-right:10px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;max-width:30%;flex-direction:column}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;margin:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;margin:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center;margin:2px 0;border-radius:20px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .poids[_ngcontent-%COMP%]{align-items:center;display:flex;text-align:center}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .poids[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px;height:22px;margin:0 10px}[_nghost-%COMP%]   .iconComparator[_ngcontent-%COMP%]{position:absolute;right:10px;bottom:10px;color:#415a77;background-color:#e5e9ea;border-radius:50%;cursor:pointer;border:5px solid #0D1B2A}@media screen and (max-width: 700px){[_nghost-%COMP%]{width:300px;font-size:12px}}@media screen and (max-width: 700px){  .cdk-overlay-pane{transform:none!important}}"]})};function tt(a,e){if(a&1&&C(0,"app-item-tooltip",0),a&2){let t=c().$index,i=c();d("item",i.item)("indexItemChoosen",t)}}function it(a,e){if(a&1&&I(0,tt,1,2,"app-item-tooltip",0),a&2){let t=e.$index,i=c();S(i.itemsChoosen[t]!==void 0?0:-1)}}var me=class a{item;itemsChoosen=[];static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-items-tooltip"]],inputs:{item:"item",itemsChoosen:"itemsChoosen"},decls:2,vars:0,consts:[[3,"item","indexItemChoosen"]],template:function(t,i){t&1&&x(0,it,1,1,null,null,D),t&2&&N(i.itemsChoosen)},dependencies:[L,le],encapsulation:2})};function at(a,e){if(a&1&&(de(0,"div"),v(1),fe()),a&2){let t=c();r(),w(" ",t.definition()," ")}}var Ee=class a{statesDefinitionService=s(se);translateService=s(F);statesDefinitionId=0;nameStates="";definition(){let e=this.statesDefinitionService.findStatesDefinition(this.statesDefinitionId);if(e)return e.description[this.translateService.currentLang]}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-states"]],inputs:{statesDefinitionId:"statesDefinitionId",nameStates:"nameStates"},decls:4,vars:2,consts:[[1,"header"]],template:function(t,i){t&1&&(de(0,"div",0)(1,"span"),v(2),fe()(),I(3,at,2,1,"div")),t&2&&(r(2),Te(i.nameStates),r(),S(i.definition()?3:-1))},dependencies:[L],styles:["[_nghost-%COMP%]{background:linear-gradient(145deg,#0d1b2a,#415a77);border-radius:15px;padding:10px;color:#fff;display:flex;flex-direction:column;box-shadow:0 8px 8px #0009;position:relative}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;border-bottom:3px solid #415A77;margin-bottom:10px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin:auto}"]})};var nt=a=>({ratio:a}),ot=(a,e)=>e.id;function rt(a,e){a&1&&(m(0,"div",7),v(1),l()),a&2&&(r(),w(" [ ",e," ] "))}function st(a,e){if(a&1&&(C(0,"img",19),v(1),E(2,"actions"),E(3,"async")),a&2){let t=c().$implicit,i=c(2);d("src",i.getEffectPng(t),u),r(),w(" ",f(3,4,f(2,2,t))," ")}}function pt(a,e){if(a&1){let t=b();Ae(0),m(1,"span",20),A("mouseenter",function(n){g(t);let o=Me(0),p=c(3);return T(p.openStatesTooltip(n,(o==null?null:o.id)??0,p.getStatesTranslate(o)))})("mouseleave",function(){g(t);let n=c(3);return T(n.stateTooltipService.closeTooltip())}),v(2),l()}if(a&2){let t=c().$implicit,i=c(2),n=Pe(i.statesService.findStates(t.params[0]));r(2),w(" ",i.getStatesTranslate(n)," ")}}function ct(a,e){if(a&1&&(m(0,"p"),I(1,st,4,6)(2,pt,3,2,"span",18),l()),a&2){let t=e.$implicit,i=c(2);r(),S(t.actionId!==i.IdActionEnum.APPLIQUE_ETAT?1:2)}}function lt(a,e){if(a&1){let t=b();m(0,"img",21),E(1,"translate"),A("click",function(){g(t);let n=c(2);return T(n.navigateToCraftku())}),l()}if(a&2){let t=c(2);d("src",t.imageService.getItemUrl(71919810),u)("matTooltip",f(1,2,"item.craftable"))}}function mt(a,e){if(a&1){let t=b();m(0,"img",23),E(1,"translate"),A("click",function(){let n=g(t).$implicit,o=c(3);return T(o.openEncyclopedieForMonster(n.idMob))}),l()}if(a&2){let t=e.$implicit,i=c(3);d("src",i.imageService.getMonsterUrl(t.gfxId),u)("matTooltip",`${f(1,2,"item.droppable")} (${i.nameMonster(t)})`)}}function Et(a,e){if(a&1&&x(0,mt,2,4,"img",22,D),a&2){let t=c(2);N(t.item.mobDropable)}}function dt(a,e){if(a&1){let t=b();m(0,"img",25),E(1,"translate"),A("click",function(){let n=g(t).$implicit,o=c(3);return T(o.openEncyclopedieForMonster(n.idMob))}),l()}if(a&2){let t=e.$implicit,i=c(3);d("src",i.imageService.getMonsterUrl(t.gfxId),u)("matTooltip",`${f(1,2,"item.boss-drop")} (${i.nameMonster(t)})`)}}function ft(a,e){if(a&1&&x(0,dt,2,4,"img",24,D),a&2){let t=c(2);N(t.item.bossDropable)}}function _t(a,e){if(a&1){let t=b();m(0,"img",27),E(1,"translate"),A("click",function(){let n=g(t).$implicit,o=c(3);return T(o.openEncyclopedieForMonster(n.idMob))}),l()}if(a&2){let t=e.$implicit,i=c(3);d("src",i.imageService.getMonsterUrl(t.gfxId),u)("matTooltip",`${f(1,2,"item.archi-drop")} (${i.nameMonster(t)})`)}}function It(a,e){if(a&1&&x(0,_t,2,4,"img",26,D),a&2){let t=c(2);N(t.item.archiDropable)}}function St(a,e){if(a&1&&(C(0,"img",17),E(1,"translate")),a&2){let t=c(2);d("src",t.imageService.getItemUrl(53124705),u)("matTooltip",f(1,2,"item.pvp"))}}function ut(a,e){if(a&1){let t=b();m(0,"div",0)(1,"span",1),E(2,"translate"),A("click",function(){g(t);let n=c();return T(n.copyToClipboard())}),C(3,"mat-icon",2),l(),m(4,"span"),C(5,"img",3),v(6),E(7,"translate"),l(),m(8,"span"),C(9,"img",4),v(10),E(11,"translate"),l(),m(12,"span",5),A("click",function(){g(t);let n=c();return T(n.openEncyclopedie(n.item.id))}),C(13,"img",6),l()(),I(14,rt,2,1,"div",7),E(15,"async"),m(16,"div",8),A("click",function(){g(t);let n=c();return T(n.setItemChoosen())}),m(17,"div",9)(18,"h3"),v(19),C(20,"img",10),l(),C(21,"img",11),m(22,"div",12),E(23,"translate"),C(24,"img",13),v(25),E(26,"translate"),l()(),m(27,"div",14)(28,"div"),x(29,ct,3,1,"p",null,ot),l(),m(31,"div",15),I(32,lt,2,4,"img",16),I(33,Et,2,0),I(34,ft,2,0),I(35,It,2,0),I(36,St,2,4,"img",17),l()()()}if(a&2){let t,i=c();r(),d("matTooltip",f(2,24,"item.copier")),r(4),d("src",i.imageService.getActionIdUrl(i.IdActionEnum.MAITRISES_ELEMENTAIRES),u),r(),P("",f(7,26,"item.maitrises")," ",i.Math.trunc(i.item.maitrise)),r(3),d("src",i.imageService.getActionIdUrl(i.IdActionEnum.RESISTANCES_ELEMENTAIRE),u),r(),P("",f(11,28,"item.resistances")," ",i.item.resistance),r(4),S((t=f(15,30,i.textCondition()))?14:-1,t),r(4),q("color",i.colorRarityService.mapColors.get(i.item.rarity)),r(),P("",i.getTitle()," (",i.item.level,") "),r(),d("src",i.itemTypeService.getLogo(i.itemTypeService.getItemType(i.item.itemTypeId)),u),r(),d("src",i.imageService.getItemUrl(i.item.idImage),u),r(),d("matTooltip",Oe(23,32,"item.poids-infobulle",ye(37,nt,i.itemService.ratioWeightByLevel(i.item.level))))("matTooltipShowDelay",300),r(2),d("src","aptitudes/poids.png",u),r(),P("",f(26,35,"item.poids")," ",i.item.weight),r(4),N(i.item.equipEffects),r(3),S(i.item.isCraftable?32:-1),r(),S(i.item.mobDropable?33:-1),r(),S(i.item.bossDropable?34:-1),r(),S(i.item.archiDropable?35:-1),r(),S(i.item.isPvP?36:-1)}}function Ct(a,e){if(a&1){let t=b();m(0,"mat-icon",29),A("mouseenter",function(n){g(t);let o=c(2);return T(o.openTooltip(n,o.item))})("mouseleave",function(){g(t);let n=c(2);return T(n.tooltipService.closeTooltip())}),l()}}function vt(a,e){if(a&1&&I(0,Ct,1,0,"mat-icon",28),a&2){let t=c();S(t.itemIsPresentAndNotChoosen(e)?0:-1)}}var qe=class a extends W{viewContainerRef=s(Re);el=s(he);itemService=s(ne);colorRarityService=s(ae);tooltipService=s(_e);stateTooltipService=s(_e);cdr=s(K);itemConditionService=s(re);item;condition=new y(void 0);condition$=this.condition.asObservable();constructor(){super()}navigateToCraftku(){window.open("https://craftkfu.waklab.fr/?"+this.item.id,"_blank")}setItemChoosen(){let e=this.itemTypeService.getItemType(this.item.itemTypeId);e&&this.itemChooseService.setItem(e,this.item)}itemIsPresentAndNotChoosen(e){return!!e.find(t=>t.find(i=>i!==void 0)&&!t.find(i=>i?.id===this.item.id))}ngAfterViewInit(){if(this.item){this.item.equipEffects=this.item.equipEffects.sort((t,i)=>(this.mapSortAction.get(t.actionId)??999)-(this.mapSortAction.get(i.actionId)??999)),this.initItemChoosen(this.item);let e=this.itemConditionService.findCondition(this.item.id);e&&this.condition.next(e),this.cdr.detectChanges()}}textCondition(){return this.condition$.pipe(_(e=>e?.description[this.translateService.currentLang]??void 0))}nameMonster(e){return e.name[this.translateService.currentLang]??""}openTooltip(e,t){let i=e.pageX>window.screen.width/2;this.tooltipService.closeTooltip(),this.itemChoosen$.pipe(Ce(1),_(n=>n.find(o=>o.find(p=>p)))).subscribe(n=>{this.tooltipService.openTooltip(this.viewContainerRef,me,e,{item:t,itemsChoosen:n},[{originX:i?"end":"center",originY:"bottom",overlayX:i?"end":"center",overlayY:"bottom",offsetY:0,offsetX:i?-this.el.nativeElement.offsetWidth:340}],!1)})}openEncyclopedie(e){window.open("https://www.wakfu.com/fr/mmorpg/encyclopedie/armures/"+e)}openEncyclopedieForMonster(e){window.open("https://www.wakfu.com/fr/mmorpg/encyclopedie/monstres/"+e)}copyToClipboard(){navigator.clipboard.writeText(this.item.title[this.translateService.currentLang])}getStatesTranslate(e){if(!e)return"";let t=this.translateService.currentLang;return e[t].toString()??""}getTitle(){return this.item.title[this.translateService.currentLang]}openStatesTooltip(e,t,i){this.stateTooltipService.closeTooltip(),this.stateTooltipService.openTooltip(this.viewContainerRef,Ee,e,{statesDefinitionId:t,nameStates:i},[{originX:"center",originY:"top",overlayX:"center",overlayY:"top",offsetY:20,offsetX:0}])}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-item"]],inputs:{item:"item"},features:[Z],decls:3,vars:4,consts:[[1,"header"],[1,"imgContainer","fileCopy",3,"click","matTooltip"],["fontIcon","file_copy"],["alt","Maitrises",3,"src"],["alt","R\xE9sistances",3,"src"],[1,"imgContainer",3,"click"],["src","aptitudes/Encyclop\xE9die.png","alt","Encyclop\xE9die"],[1,"condition"],[1,"content",3,"click"],[1,"title"],["alt","item type logo",3,"src"],["alt","items","appFallback","",3,"src"],[1,"poids",3,"matTooltip","matTooltipShowDelay"],["alt","poids",3,"src"],[1,"effects"],[1,"craftAndDrop"],["alt","craftable",1,"craftable",3,"src","matTooltip"],["alt","pvp",3,"src","matTooltip"],[1,"appliqueEtat"],["alt","aptitudes",3,"src"],[1,"appliqueEtat",3,"mouseenter","mouseleave"],["alt","craftable",1,"craftable",3,"click","src","matTooltip"],["alt","droppable","appFallback","",1,"monster",3,"src","matTooltip"],["alt","droppable","appFallback","",1,"monster",3,"click","src","matTooltip"],["alt","boss drop","appFallback","",1,"monster",3,"src","matTooltip"],["alt","boss drop","appFallback","",1,"monster",3,"click","src","matTooltip"],["alt","archi drop","appFallback","",1,"monster",3,"src","matTooltip"],["alt","archi drop","appFallback","",1,"monster",3,"click","src","matTooltip"],["fontIcon","swap_horiz",1,"iconComparator"],["fontIcon","swap_horiz",1,"iconComparator",3,"mouseenter","mouseleave"]],template:function(t,i){if(t&1&&(I(0,ut,37,39),I(1,vt,1,1),E(2,"async")),t&2){let n;S(i.item?0:-1),r(),S((n=f(2,2,i.itemChoosen$))?1:-1,n)}},dependencies:[L,Ne,xe,te,Ue,De,ie,we,Y,ee,Q],styles:["[_nghost-%COMP%]{background:linear-gradient(145deg,#0d1b2a,#415a77);border-radius:15px;padding:5px;color:#fff;height:100%;width:100%;display:flex;flex-direction:column;box-shadow:0 8px 8px #0009;position:relative}[_nghost-%COMP%]   span[_ngcontent-%COMP%]{border-radius:10px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;border-bottom:3px solid #415A77;margin-bottom:10px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin:auto}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [_nghost-%COMP%]   .header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 5px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:40px;height:40px;cursor:pointer;align-content:center}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{width:50px;height:50px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .imgContainer[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{transform:scale(1.2)}[_nghost-%COMP%]   .condition[_ngcontent-%COMP%]{text-align:center;color:red;font-weight:bolder;margin-bottom:5px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:space-around;cursor:pointer}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{margin-right:10px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;max-width:30%;flex-direction:column}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;margin:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px;min-width:30px;min-height:30px;vertical-align:middle}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:80px;height:80px;min-width:80px;min-height:80px;margin:auto;object-fit:contain;border-radius:8px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .poids[_ngcontent-%COMP%]{align-items:center;display:flex;text-align:center}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .poids[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px;height:22px;min-width:22px;min-height:22px;margin:0 10px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0;border-radius:20px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:10px;width:24px;height:24px;min-width:24px;min-height:24px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .appliqueEtat[_ngcontent-%COMP%]{font-weight:500;text-decoration:underline}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .effects[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .effects[_ngcontent-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-around}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .effects[_ngcontent-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;min-width:80px;min-height:80px;object-fit:contain;flex:0 0 calc(33% - 10px);max-width:calc(33% - 10px)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .effects[_ngcontent-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]   .monster[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .effects[_ngcontent-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]   .craftable[_ngcontent-%COMP%]:hover{transform:scale(1.2)}[_nghost-%COMP%]   .iconComparator[_ngcontent-%COMP%]{position:absolute;right:10px;bottom:10px;color:#415a77;background-color:#e5e9ea;border-radius:50%;cursor:pointer;border:5px solid #0D1B2A}@media screen and (max-width: 900px){[_nghost-%COMP%]{max-width:90%;margin:auto}[_nghost-%COMP%]   .fileCopy[_ngcontent-%COMP%]{display:none!important}[_nghost-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:40px!important;height:40px!important;min-width:40px!important;min-height:40px!important}[_nghost-%COMP%]   .craftAndDrop[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:nth-of-type(n+4){display:none!important}}"]})};var Ge=class a extends Fe{actionService=s(k);itemChooseService=s(oe);aptitudesFormService=s(ke);levelFormService=s(Ve);classeFormService=s(Be);sortFormService=s(je);chasseFormService=s($e);naturalEffects=[{id:31,value:6,params:[]},{id:41,value:3,params:[]},{id:191,value:6,params:[]},{id:150,value:3,params:[]},{id:184,value:1,params:[]}];initialEffectList=[{id:122,value:0,params:[]},{id:124,value:0,params:[]},{id:123,value:0,params:[]},{id:125,value:0,params:[]},{id:1052,value:0,params:[]},{id:1053,value:0,params:[]},{id:149,value:0,params:[]},{id:180,value:0,params:[]},{id:26,value:0,params:[]},{id:1055,value:0,params:[]},{id:150,value:0,params:[]},{id:875,value:0,params:[]},{id:71,value:0,params:[]},{id:988,value:0,params:[]},{id:184,value:0,params:[]},{id:-6,value:0,params:[]},{id:-8,value:0,params:[]},{id:82,value:0,params:[]},{id:83,value:0,params:[]},{id:84,value:0,params:[]},{id:85,value:0,params:[]},{id:31,value:0,params:[]},{id:41,value:0,params:[]},{id:191,value:0,params:[]},{id:160,value:0,params:[]},{id:20,value:0,params:[]},{id:39,parameterMajorAction:120,value:0,params:[]},{id:39,parameterMajorAction:121,value:0,params:[]},{id:175,value:0,params:[]},{id:173,value:0,params:[]},{id:177,value:0,params:[]},{id:171,value:0,params:[]},{id:-9,value:0,params:[]},{id:-7,value:0,params:[]}];recap=new y([...this.initialEffectList]);recap$=this.recap.asObservable();maitrisesTotal=new y(0);maitrisesTotal$=this.maitrisesTotal.asObservable();resistancesTotal=new y(0);resistancesTotal$=this.resistancesTotal.asObservable();constructor(){super(),this.initializeListeners()}initializeListeners(){j([this.itemChooseService.listItem$,this.aptitudesFormService.recapStat$,this.levelFormService.level$,this.chasseFormService.recapChassesEffect$,this.classeFormService.classe$,this.sortFormService.sortPassifs$]).pipe(V(this.destroy$),h(()=>this.resetEffects()),_(([e,t,i,n])=>{let o=this.extractEquipEffects(e),p=this.mapToRecapStats(o);return p.push(...t,...n),{recapStat:p,level:i}}),h(()=>this.applyNatifEffects()),h(()=>this.applyEffectByClass()),h((e=>e.recapStat.forEach(t=>this.applyEffect(t)))),h(()=>this.applyEffectPassif()),h(()=>this.applyPdv()),h(()=>this.emitEffects())).subscribe()}applyPdv(){let e=this.recap.value.find(i=>i.id===20),t=this.recap.value.find(i=>i.id===-7);if(e&&t){let n=50+this.levelFormService.getValue()*10;e.value=Math.floor((n+e.value)*(1+t.value/100))}}applyEffectPassif(){this.applyEffectPassifGenerique(),this.applyEffectPassifClasse()}applyEffectPassifClasse(){switch(this.classeFormService.getValue()){case 1:this.applyEffectPassifFeca();break;case 2:this.applyEffectPassifOsamodas();break;case 4:this.applyEffectPassifSram();break;case 5:this.applyEffectPassifXelor();break;case 7:this.applyEffectPassifEniripsa();break;case 8:this.applyEffectPassifIop();break;case 9:this.applyEffectPassifCra();break;case 10:this.applyEffectPassifSadida();break;case 11:this.applyEffectPassifSacrieur();break;case 12:this.applyEffectPassifPandawa();break;case 14:this.applyEffectPassifZobal();break;case 15:this.applyEffectPassifOuginak();break;case 16:this.applyEffectPassifSteamer();break;case 18:this.applyEffectPassifEliotrope();break;case 19:this.applyEffectPassifHuppermage();break}}applyEffectPassifHuppermage(){this.sortFormService.getSortPassifs().find(t=>t===7193)&&this.applyEffect({id:177,value:20,params:[]})}applyEffectPassifEliotrope(){this.sortFormService.getSortPassifs().find(t=>t===7208)&&this.applyEffect({id:160,value:-1,params:[]})}applyEffectPassifSteamer(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();e.find(i=>i===7181)&&this.applyEffect({id:-8,value:-30,params:[]}),e.find(i=>i===7344)&&this.applyEffect({id:20,value:6*t,params:[]}),e.find(i=>i===2819)&&this.applyEffect({id:41,value:-1,params:[]}),e.find(i=>i===2816)&&this.applyEffect({id:39,value:-30,parameterMajorAction:121,params:[]}),e.find(i=>i===5462)&&this.applyEffect({id:-8,value:-20,params:[]})}applyEffectPassifOuginak(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();e.find(i=>i===6276)&&(this.applyEffect({id:-8,value:50,params:[]}),this.applyEffect({id:160,value:-2,params:[]})),e.find(i=>i===6278)&&this.applyEffect({id:875,value:30,params:[]}),e.find(i=>i===5103)&&this.applyEffect({id:41,value:1,params:[]}),e.find(i=>i===6275)&&this.applyEffect({id:-8,value:-15,params:[]}),e.find(i=>i===7343)&&this.applyEffect({id:191,value:3,params:[]}),e.find(i=>i===7557)&&this.applyEffect({id:191,value:-1,params:[]}),e.find(i=>i===6277)&&(this.applyEffect({id:-6,value:-10,params:[]}),this.applyEffect({id:39,value:30,parameterMajorAction:121,params:[]}),this.applyEffect({id:20,value:4*t,params:[]})),e.find(i=>i===7328)&&this.applyEffect({id:41,value:-1,params:[]}),e.find(i=>i===6272)&&this.applyEffect({id:-8,value:-15,params:[]}),e.find(i=>i===7193)&&(this.applyEffect({id:177,value:20,params:[]}),this.applyEffect({id:-6,value:-10,params:[]})),e.find(i=>i===7596)&&this.applyEffect({id:173,value:3*t,params:[]})}applyEffectPassifZobal(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();if(e.find(i=>i===5359)&&this.applyEffect({id:41,value:1,params:[]}),e.find(i=>i===7093)&&this.applyEffect({id:175,value:2*t,params:[]}),e.find(i=>i===7111)){let i=this.recap.value.find(n=>n.id===175)?.value??0;if(i>=0){let n=Math.min(Math.floor(i/2),2*t);this.applyEffect({id:1053,value:n,params:[]})}}if(e.find(i=>i===7104)&&this.applyEffect({id:-6,value:-25,params:[]}),e.find(i=>i===3356)&&(this.applyEffect({id:-6,value:25,params:[]}),this.applyEffect({id:39,value:-40,parameterMajorAction:121,params:[]}),this.applyEffect({id:39,value:-40,parameterMajorAction:120,params:[]})),e.find(i=>i===3363)){let i=this.recap.value.find(n=>n.id===173)?.value??0;i>=0&&this.applyEffect({id:173,value:i,params:[]}),this.applyEffect({id:41,value:-1,params:[]})}if(e.find(i=>i===7094)){let i=this.recap.value.find(n=>n.id===173)?.value??0;if(i>=0){let n=Math.min(Math.floor(i/2),2*t);this.applyEffect({id:1052,value:n,params:[]})}}e.find(i=>i===7113)&&this.applyEffect({id:177,value:10,params:[]})}applyEffectPassifPandawa(){let e=this.sortFormService.getSortPassifs();e.find(t=>t===7987)&&(this.applyEffect({id:-9,value:20,params:[]}),this.applyEffect({id:-6,value:-10,params:[]})),e.find(t=>t===5149)&&(this.applyEffect({id:-6,value:15,params:[]}),this.applyEffect({id:80,value:-50,params:[]})),e.find(t=>t===5151)&&this.applyEffect({id:-6,value:10,params:[]})}applyEffectPassifSacrieur(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();if(e.find(i=>i===7218)&&this.applyEffect({id:160,value:-2,params:[]}),e.find(i=>i===7213)&&this.applyEffect({id:39,value:-50,parameterMajorAction:121,params:[]}),e.find(i=>i===5192)){let i=this.recap.value.find(n=>n.id===173)?.value??0;i>=0&&this.applyEffect({id:173,value:-i,params:[]})}e.find(i=>i===5051)&&this.applyEffect({id:20,value:8*t,params:[]})}applyEffectPassifSadida(){this.sortFormService.getSortPassifs().find(t=>t===7193)&&this.applyEffect({id:177,value:20,params:[]})}applyEffectPassifCra(){if(this.sortFormService.getSortPassifs().find(t=>t===588)){let t=this.recap.value.find(i=>i.id===175)?.value??0;this.applyEffect({id:175,value:-t,params:[]}),this.applyEffect({id:177,value:20,params:[]})}}applyEffectPassifIop(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();e.find(i=>i===525)&&this.applyEffect({id:20,value:3*t,params:[]}),e.find(i=>i===7111)&&this.applyEffect({id:39,value:-20,parameterMajorAction:121,params:[]})}applyEffectPassifEniripsa(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();e.find(i=>i===5453)&&this.applyEffect({id:20,value:8*t,params:[]})}applyEffectPassifXelor(){let e=this.sortFormService.getSortPassifs();e.find(t=>t===756)&&(this.applyEffect({id:191,value:6,params:[]}),this.applyEffect({id:41,value:-2,params:[]})),e.find(t=>t===7196)&&this.applyEffect({id:191,value:-6,params:[]})}applyEffectPassifSram(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();if(e.find(i=>i===4609)&&this.applyEffect({id:184,value:4,params:[]}),e.find(i=>i===5122)&&this.applyEffect({id:1053,value:Math.floor(t*1.5),params:[]}),e.find(i=>i===5126)&&this.applyEffect({id:177,value:20,params:[]}),e.find(i=>i===2437)){let i=this.recap.value.find(o=>o.id===175)?.value??0;i>=0&&this.applyEffect({id:150,value:Math.min(Math.floor(i/20),15),params:[]});let n=this.recap.value.find(o=>o.id===173)?.value??0;n>=0&&this.applyEffect({id:150,value:Math.min(Math.floor(n/20),15),params:[]})}}applyEffectPassifOsamodas(){let e=this.sortFormService.getSortPassifs();e.find(t=>t===7340)&&this.applyEffect({id:191,value:3,params:[]}),e.find(t=>t===7333)&&this.applyEffect({id:-6,value:25,params:[]}),e.find(t=>t===7331)&&this.applyEffect({id:-6,value:20,params:[]}),e.find(t=>t===7330)&&this.applyEffect({id:160,value:2,params:[]}),e.find(t=>t===7344)&&this.applyEffect({id:80,value:-100,params:[]})}applyEffectPassifFeca(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();if(e.find(i=>i===6997)&&this.applyEffect({id:875,value:30,params:[]}),e.find(i=>i===7004)&&this.applyEffect({id:39,value:100,parameterMajorAction:120,params:[]}),e.find(i=>i===2374)&&this.applyEffect({id:39,value:-100,parameterMajorAction:121,params:[]}),e.find(i=>i===5245)&&this.applyEffect({id:-6,value:10,params:[]}),e.find(i=>i===866)){let i=this.recap.value.find(n=>n.id===875);i&&i.value<=100&&(this.applyEffect({id:39,value:i.value,parameterMajorAction:120,params:[]}),this.applyEffect({id:875,value:-i.value,params:[]}))}e.find(i=>i===2295)&&(this.applyEffect({id:39,value:-100,parameterMajorAction:121,params:[]}),this.applyEffect({id:-6,value:25,params:[]})),e.find(i=>i===6989)&&this.applyEffect({id:160,value:1,params:[]}),e.find(i=>i===7005)&&(this.applyEffect({id:20,value:3*t,params:[]}),this.applyEffect({id:-6,value:-20,params:[]}))}applyEffectPassifGenerique(){let e=this.sortFormService.getSortPassifs(),t=this.levelFormService.getValue();e.find(i=>i===5144)&&(this.applyEffect({id:-6,value:15,params:[]}),this.applyEffect({id:-9,value:-30,params:[]})),e.find(i=>i===4957)&&this.applyEffect({id:175,value:t,params:[]}),e.find(i=>i===4956)&&this.applyEffect({id:171,value:Math.floor(t/2),params:[]}),e.find(i=>i===4958)&&this.applyEffect({id:173,value:t,params:[]}),e.find(i=>i===5146)&&(this.applyEffect({id:-9,value:30,params:[]}),this.applyEffect({id:39,value:25,parameterMajorAction:120,params:[]}),this.applyEffect({id:-6,value:-15,params:[]})),e.find(i=>i===5237)&&(this.applyEffect({id:31,value:1,params:[]}),this.applyEffect({id:-6,value:-20,params:[]}),this.applyEffect({id:177,value:10,params:[]})),e.find(i=>i===5145)&&(this.applyEffect({id:-7,value:60,params:[]}),this.applyEffect({id:-4,value:25,params:[]}),this.applyEffect({id:-6,value:-25,params:[]}),this.applyEffect({id:-9,value:-50,params:[]}))}applyEffectByClass(){let e=this.classeFormService.getValue(),t=this.levelFormService.getValue();switch(e){case 9:this.applyEffect({id:160,value:1,params:[]});break;case 6:this.applyEffect({id:150,value:20,params:[]});break;case 11:this.applyEffect({id:20,value:4*t,params:[]});break;case 4:this.applyEffect({id:180,value:t,params:[]}),this.applyEffect({id:184,value:1,params:[]});break;case 8:this.applyEffect({id:41,value:1,params:[]});break;case 7:this.applyEffect({id:20,value:2*t,params:[]});break;case 18:(this.recap.value.find(i=>i.id===160)?.value??0)>=2&&(this.applyEffect({id:160,value:-2,params:[]}),this.applyEffect({id:41,value:1,params:[]}));break;case 5:this.applyEffect({id:191,value:6,params:[]});break}}applyNatifEffects(){this.naturalEffects.forEach(e=>this.applyEffect(e))}resetEffects(){this.recap.value.forEach(e=>e.value=0)}extractEquipEffects(e){return e.flatMap(t=>t.equipEffects)}mapToRecapStats(e){return e.map(t=>({id:t.actionId,parameterMajorAction:t.actionId!==39?void 0:t.params[4]===120?120:121,value:t.params[0],params:t.params}))}applyEffectResistance(e){if(e.id===80)this.applyEffect({id:82,value:e.value,params:e.params}),this.applyEffect({id:83,value:e.value,params:e.params}),this.applyEffect({id:84,value:e.value,params:e.params}),this.applyEffect({id:85,value:e.value,params:e.params});else if(e.id===90||e.id===100)this.applyEffect({id:82,value:-e.value,params:e.params}),this.applyEffect({id:83,value:-e.value,params:e.params}),this.applyEffect({id:84,value:-e.value,params:e.params}),this.applyEffect({id:85,value:-e.value,params:e.params});else if(e.id===1069){let t=e.params[2];t>=1&&this.applyEffect({id:82,value:e.value,params:e.params}),t>=2&&this.applyEffect({id:83,value:e.value,params:e.params}),t>=3&&this.applyEffect({id:84,value:e.value,params:e.params}),t>=4&&this.applyEffect({id:85,value:e.value,params:e.params})}else e.id===35&&this.applyEffect({id:80,value:50,params:e.params})}applyEffectMaitrisesElementaires(e){if(e.id===120)this.applyEffect({id:122,value:e.value,params:e.params}),this.applyEffect({id:124,value:e.value,params:e.params}),this.applyEffect({id:123,value:e.value,params:e.params}),this.applyEffect({id:125,value:e.value,params:e.params});else if(e.id===130)this.applyEffect({id:122,value:-e.value,params:e.params}),this.applyEffect({id:124,value:-e.value,params:e.params}),this.applyEffect({id:123,value:-e.value,params:e.params}),this.applyEffect({id:125,value:-e.value,params:e.params});else if(e.id===1068){let t=e.params[2];t>=1&&this.applyEffect({id:122,value:e.value,params:e.params}),t>=2&&this.applyEffect({id:124,value:e.value,params:e.params}),t>=3&&this.applyEffect({id:123,value:e.value,params:e.params}),t>=4&&this.applyEffect({id:125,value:e.value,params:e.params})}}applyEffect(e){this.applyEffectResistance(e),this.applyEffectMaitrisesElementaires(e);let t=this.actionService.isAMalus(e.id),i=t?this.actionService.getOpposedEffect(e.id):e.id,n=t?-1:1,o=this.recap.value.find(p=>p.id!==39&&p.id===i||p.id===39&&p.parameterMajorAction===e.parameterMajorAction);o&&(o.value+=n*e.value)}emitEffects(){this.recap.next([...this.recap.value]);let e=this.recap.value.filter(o=>[1052,1053,149,180,26,1055].includes(o.id)).filter(o=>o.value>0).reduce((o,p)=>o+p.value,0),t=Math.max(this.recap.value.find(o=>o.id===122)?.value||0,this.recap.value.find(o=>o.id===124)?.value||0,this.recap.value.find(o=>o.id===123)?.value||0,this.recap.value.find(o=>o.id===125)?.value||0,0),i=e+t;this.maitrisesTotal.next(i);let n=this.recap.value.filter(o=>[82,83,84,85].includes(o.id)).reduce((o,p)=>o+p.value,0);this.resistancesTotal.next(n)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};export{k as a,re as b,se as c,qe as d,Qe as e,Ge as f};
